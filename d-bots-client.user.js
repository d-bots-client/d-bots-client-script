// ==UserScript==
// @name         d-bots-client
// @namespace    http://github.com/d-bots-client/
// @version      0.01
// @description  to be writen
// @author       David
// @license      
// @match        http://agar.io/*
// @require      https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.4/socket.io.min.js
// @grant        none
// @run-at       document-start
// ==/UserScript==

//http://agar.io/img/background.png
var engine = 'CiAgICAoZnVuY3Rpb24gKGMsIGUpIHsKICAgICAgICAKICAgICAgICB2YXIgY291bnQgPSAwOwoKICAgICAgICAKICAgICAgICBmdW5jdGlvbiB1YShhLCBiKSB7CiAgICAgICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlOwogICAgICAgICAgICAgICAgZC5zZXRUaW1lKGQuZ2V0VGltZSgpICsgODY0RTUgKiBiKTsKICAgICAgICAgICAgICAgIGQgPSAiOyBleHBpcmVzPSIgKyBkLnRvR01UU3RyaW5nKCkKICAgICAgICAgICAgfSBlbHNlIGQgPSAiIjsKICAgICAgICAgICAgZG9jdW1lbnQuY29va2llID0gImFnYXJpb19yZWRpcmVjdD0iICsgYSArIGQgKyAiOyBwYXRoPS8iCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0YygpIHsKICAgICAgICAgICAgZm9yICh2YXIgYSA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyIpLCBiID0gMDsgYiA8IGEubGVuZ3RoOyBiKyspIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGQgPSBhW2JdOwogICAgICAgICAgICAgICAgICAgICIgIiA9PSBkLmNoYXJBdCgwKSA7KSBkID0gZC5zdWJzdHJpbmcoMSwgZC5sZW5ndGgpOwogICAgICAgICAgICAgICAgaWYgKDAgPT0gZC5pbmRleE9mKCJhZ2FyaW9fcmVkaXJlY3Q9IikpIHJldHVybiBkLnN1YnN0cmluZygxNiwgZC5sZW5ndGgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIEliKCkgewogICAgICAgICAgICBjLm9ua2V5ZG93biA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAvL0FHQVJCT1RPVkggQ0UgQ09ERSBBIFJBUEFUUklFUiBEQU5TIE5PVFJFS0VZRE9XTgogICAgICAgICAgICAgICAgaWYgKGEua2V5Q29kZSA9PSA2OSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlbWl0IHNwbGl0ICEgd2l0aCBpcDogJyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoYS5rZXlDb2RlID09IDgyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VtaXQgZmVlZCAhd2l0aCBpcDogJyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAzMiAhPSBhLmtleUNvZGUgfHwgdmEgfHwgKCJuaWNrIiAhPSBhLnRhcmdldC5pZCAmJiBhLnByZXZlbnREZWZhdWx0KCksIGViKCksIHZhID0gITApOwogICAgICAgICAgICAgICAgODEgPT0gYS5rZXlDb2RlICYmIChYKDE4KSwgd2EgPSAhMCk7CiAgICAgICAgICAgICAgICA4NyAhPSBhLmtleUNvZGUgfHwgeGEgfHwgKEpiKCksIHhhID0gITApOwogICAgICAgICAgICAgICAgMjcgPT0gYS5rZXlDb2RlICYmIChhLnByZXZlbnREZWZhdWx0KCksIHlhKDMwMCksIGUoIiNvZmVyd2FsbENvbnRhaW5lciIpLmlzKCI6dmlzaWJsZSIpICYmIGMuY2xvc2VPZmZlcndhbGwoKSwgZSgiI3ZpZGVvQ29udGFpbmVyIikuaXMoIjp2aXNpYmxlIikgJiYgYy5jbG9zZVZpZGVvQ29udGFpbmVyKCkpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGMub25rZXl1cCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAzMiA9PSBhLmtleUNvZGUgJiYgKHZhID0gITEpOwogICAgICAgICAgICAgICAgODcgPT0gYS5rZXlDb2RlICYmICh4YSA9ICExKTsKICAgICAgICAgICAgICAgIDgxID09IGEua2V5Q29kZSAmJiB3YSAmJiAoWCgxOSksIHdhID0gITEpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIEtiKGEpIHsKICAgICAgICAgICAgYS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAvLyBBR0FSQk9UT1ZICiAgICAgICAgICAgIFAgKj0gTWF0aC5wb3coLjksIGEud2hlZWxEZWx0YSAvIC0xMjAgfHwgYS5kZXRhaWwgfHwgMCk7CiAgICAgICAgICAgIGlmICgxIDwgUCkKICAgICAgICAgICAgICAgIFAgPSAxOwogICAgICAgICAgICAvKgogICAgICAgICAgICBQICo9IE1hdGgucG93KC45LCBhLndoZWVsRGVsdGEgLyAtMTIwIHx8IGEuZGV0YWlsIHx8IDApOwogICAgICAgICAgICAxID4gUCAmJiAoUCA9IDEpOwogICAgICAgICAgICBQID4gNCAvIGwgJiYgKFAgPSA0IC8gbCkqLwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdWMoKSB7CiAgICAgICAgICAgIGlmICguNCA+IGwpIGlhID0gbnVsbDsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBhID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBiID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBkID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLCBjID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLCBnID0gMDsgZyA8IEEubGVuZ3RoOyBnKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IEFbZ107CiAgICAgICAgICAgICAgICAgICAgIWUuUigpIHx8IGUuViB8fCAyMCA+PSBlLnNpemUgKiBsIHx8IChhID0gTWF0aC5taW4oZS54IC0gZS5zaXplLCBhKSwgYiA9IE1hdGgubWluKGUueSAtIGUuc2l6ZSwgYiksIGQgPSBNYXRoLm1heChlLnggKyBlLnNpemUsIGQpLCBjID0gTWF0aC5tYXgoZS55ICsgZS5zaXplLCBjKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlhID0gdmMuaW5pdCh7CiAgICAgICAgICAgICAgICAgICAgemE6IGEgLSAxMCwKICAgICAgICAgICAgICAgICAgICBBYTogYiAtIDEwLAogICAgICAgICAgICAgICAgICAgIHhhOiBkICsgMTAsCiAgICAgICAgICAgICAgICAgICAgeWE6IGMgKyAxMCwKICAgICAgICAgICAgICAgICAgICBIYTogMiwKICAgICAgICAgICAgICAgICAgICBJYTogNAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBmb3IgKGcgPSAwOyBnIDwgQS5sZW5ndGg7IGcrKykKICAgICAgICAgICAgICAgICAgICBpZiAoZSA9IEFbZ10sIGUuUigpICYmICEoMjAgPj0gZS5zaXplICogbCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCBlLmEubGVuZ3RoOyArK2EpIGIgPSBlLmFbYV0ueCwgZCA9IGUuYVthXS55LCBiIDwgeSAtIHIgLyAyIC8gbCB8fCBkIDwgeiAtIHQgLyAyIC8gbCB8fCBiID4geSArIHIgLyAyIC8gbCB8fCBkID4geiArIHQgLyAyIC8gbCB8fCBpYS50YShlLmFbYV0pCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZiKCkgewogICAgICAgICAgICB6YSA9IChZIC0gciAvIDIpIC8gbCArIHk7CiAgICAgICAgICAgIEFhID0gKFogLSB0IC8gMikgLyBsICsgegogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gTGIoKSB7CiAgICAgICAgICAgIG51bGwgPT0gQmEgJiYgKEJhID0ge30sIGUoIiNyZWdpb24iKS5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGEgPSBlKHRoaXMpLAogICAgICAgICAgICAgICAgICAgIGIgPSBhLnZhbCgpOwogICAgICAgICAgICAgICAgYiAmJiAoQmFbYl0gPSBhLnRleHQoKSkKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBlLmdldChDYSArICJpbmZvIiwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgIHZhciBiID0ge30sCiAgICAgICAgICAgICAgICAgICAgZDsKICAgICAgICAgICAgICAgIGZvciAoZCBpbiBhLnJlZ2lvbnMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGQuc3BsaXQoIjoiKVswXTsKICAgICAgICAgICAgICAgICAgICBiW2NdID0gYltjXSB8fCAwOwogICAgICAgICAgICAgICAgICAgIGJbY10gKz0gYS5yZWdpb25zW2RdLm51bVBsYXllcnMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoZCBpbiBiKSBlKCcjcmVnaW9uIG9wdGlvblt2YWx1ZT0iJyArIGQgKyAnIl0nKS50ZXh0KEJhW2RdICsgIiAoIiArIGJbZF0gKyAiIHBsYXllcnMpIikKICAgICAgICAgICAgfSwgImpzb24iKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gTWIoKSB7CiAgICAgICAgICAgIGUoIiNhZHNCb3R0b20iKS5oaWRlKCk7CiAgICAgICAgICAgIGUoIiNvdmVybGF5cyIpLmhpZGUoKTsKICAgICAgICAgICAgZSgiI3N0YXRzIikuaGlkZSgpOwogICAgICAgICAgICBlKCIjbWFpblBhbmVsIikuaGlkZSgpOwogICAgICAgICAgICBhYSA9IGphID0gITE7CiAgICAgICAgICAgIE5iKCk7CiAgICAgICAgICAgIGMuZGVzdHJveUFkKGMuYWRTbG90cy5hYSk7CiAgICAgICAgICAgIGMuZGVzdHJveUFkKGMuYWRTbG90cy5hYykKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIERhKGEpIHsKICAgICAgICAgICAgYSAmJiAoYSA9PSBHID8gZSgiLmJ0bi1uZWVkcy1zZXJ2ZXIiKS5wcm9wKCJkaXNhYmxlZCIsICExKSA6IChlKCIjcmVnaW9uIikudmFsKCkgIT0gYSAmJiBlKCIjcmVnaW9uIikudmFsKGEpLCBHID0gYy5sb2NhbFN0b3JhZ2UubG9jYXRpb24gPSBhLCBlKCIucmVnaW9uLW1lc3NhZ2UiKS5oaWRlKCksIGUoIi5yZWdpb24tbWVzc2FnZS4iICsgYSkuc2hvdygpLCBlKCIuYnRuLW5lZWRzLXNlcnZlciIpLnByb3AoImRpc2FibGVkIiwgITEpLCBnYiAmJiBRKCkpKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24geWEoYSkgewogICAgICAgICAgICBqYSB8fCBhYSB8fCAoRWEgPyBlKCIuYnRuLXNwZWN0YXRlIikucHJvcCgiZGlzYWJsZWQiLCAhMCkgOiBlKCIuYnRuLXNwZWN0YXRlIikucHJvcCgiZGlzYWJsZWQiLCAhMSksIE4gPSBudWxsLCBoYiB8fCAoZSgiI2Fkc0JvdHRvbSIpLnNob3coKSwgZSgiI2czMDB4MjUwIikuaGlkZSgpLCBlKCIjYTMwMHgyNTAiKS5zaG93KCksIGUoIiNnNzI4eDkwIikuaGlkZSgpLCBlKCIjYTcyOHg5MCIpLnNob3coKSksIGMucmVmcmVzaEFkKGhiID8gYy5hZFNsb3RzLmFjIDogYy5hZFNsb3RzLmFhKSwgaGIgPSAhMSwgMUUzID4gYSAmJiAoQiA9IDEpLCBqYSA9ICEwLCBlKCIjbWFpblBhbmVsIikuc2hvdygpLCAwIDwgYSA/IGUoIiNvdmVybGF5cyIpLmZhZGVJbihhKSA6IGUoIiNvdmVybGF5cyIpLnNob3coKSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGthKGEpIHsKICAgICAgICAgICAgZSgiI2hlbGxvQ29udGFpbmVyIikuYXR0cigiZGF0YS1nYW1lbW9kZSIsIGEpOwogICAgICAgICAgICBsYSA9IGE7CiAgICAgICAgICAgIGUoIiNnYW1lbW9kZSIpLnZhbChhKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gTmIoKSB7CiAgICAgICAgICAgIGUoIiNyZWdpb24iKS52YWwoKSA/IGMubG9jYWxTdG9yYWdlLmxvY2F0aW9uID0gZSgiI3JlZ2lvbiIpLnZhbCgpIDogYy5sb2NhbFN0b3JhZ2UubG9jYXRpb24gJiYgZSgiI3JlZ2lvbiIpLnZhbChjLmxvY2FsU3RvcmFnZS5sb2NhdGlvbik7CiAgICAgICAgICAgIGUoIiNyZWdpb24iKS52YWwoKSA/IGUoIiNsb2NhdGlvbktub3duIikuYXBwZW5kKGUoIiNyZWdpb24iKSkgOiBlKCIjbG9jYXRpb25Vbmtub3duIikuYXBwZW5kKGUoIiNyZWdpb24iKSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGliKGEpIHsKICAgICAgICAgICAgImVudl9sb2NhbCIgaW4gRW52Q29uZmlnID8gInRydWUiID09IEVudkNvbmZpZy5sb2FkX2xvY2FsX2NvbmZpZ3VyYXRpb24gPyBjLk1DLnVwZGF0ZUNvbmZpZ3VyYXRpb25JRCgiYmFzZSIpIDogYy5NQy51cGRhdGVDb25maWd1cmF0aW9uSUQoRW52Q29uZmlnLmNvbmZpZ0lEKSA6IGMuTUMudXBkYXRlQ29uZmlndXJhdGlvbklEKGEpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB3YygpIHsKICAgICAgICAgICAgImNvbmZpZ0lEIiBpbiBEID8gaWIoRC5jb25maWdJRCkgOiBlLmdldChDYSArICJnZXRMYXRlc3RJRCIsIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICBpYihhKTsKICAgICAgICAgICAgICAgIGMubG9jYWxTdG9yYWdlLmxhc3RfY29uZmlnX2lkID0gYQogICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICAgICAgaWYgKGEgPSAibGFzdF9jb25maWdfaWQiIGluIGMubG9jYWxTdG9yYWdlKSBhID0gYy5sb2NhbFN0b3JhZ2UubGFzdF9jb25maWdfaWQsIGEgPSAhKG51bGwgPT0gYSB8fCB2b2lkIDAgPT0gYSB8fCAiIiA9PT0gYSk7CiAgICAgICAgICAgICAgICBhICYmIChhID0gYy5sb2NhbFN0b3JhZ2UubGFzdF9jb25maWdfaWQsIGNvbnNvbGUubG9nKCJGYWxsYmFjayB0byBzdG9yZWQgY29uZmlnSUQ6ICIgKyBhKSwgaWIoYSkpCiAgICAgICAgICAgIH0pCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB4YygpIHsKICAgICAgICAgICAgZS5nZXQoamIgKyAiLy9nYy5hZ2FyLmlvIiwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgIHZhciBiID0gYS5zcGxpdCgiICIpOwogICAgICAgICAgICAgICAgYSA9IGJbMF07CiAgICAgICAgICAgICAgICBiID0gYlsxXSB8fCAiIjsgLTEgPT0gWyJVQSJdLmluZGV4T2YoYSkgJiYgT2IucHVzaCgidXNzciIpOwogICAgICAgICAgICAgICAgbWEuaGFzT3duUHJvcGVydHkoYSkgJiYgKCJzdHJpbmciID09IHR5cGVvZiBtYVthXSA/IEcgfHwgRGEobWFbYV0pIDogbWFbYV0uaGFzT3duUHJvcGVydHkoYikgJiYgKEcgfHwgRGEobWFbYV1bYl0pKSkKICAgICAgICAgICAgfSwgInRleHQiKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gUihhKSB7CiAgICAgICAgICAgIHJldHVybiBjLmkxOG5bYV0gfHwgYy5pMThuX2RpY3QuZW5bYV0gfHwgYQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gUGIoKSB7CiAgICAgICAgICAgIHZhciBhID0gKytrYjsKICAgICAgICAgICAgY29uc29sZS5sb2coIkZpbmQgIiArIEcgKyBsYSk7CiAgICAgICAgICAgIFFiKCk7CiAgICAgICAgICAgIGUuYWpheChDYSArICJmaW5kU2VydmVyIiwgewogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRmFpbGVkIHRvIGdldCBzZXJ2ZXIuIFdpbGwgcmV0cnkgaW4gMzAgc2Vjb25kcyIpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoUGIsIDNFNCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoYikgewogICAgICAgICAgICAgICAgICAgIGlmIChhID09IGtiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuYWxlcnQgJiYgYWxlcnQoYi5hbGVydCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYi5pcDsKICAgICAgICAgICAgICAgICAgICAgICAgImdhbWVfc2VydmVyX3BvcnQiIGluIEVudkNvbmZpZyAmJiAoZCA9IGMubG9jYXRpb24uaG9zdG5hbWUgKyAiOiIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgRW52Q29uZmlnLmdhbWVfc2VydmVyX3BvcnQpOwogICAgICAgICAgICAgICAgICAgICAgICBsYigid3MiICsgKG1iID8gInMiIDogIiIpICsgIjovLyIgKyBkLCBiLnRva2VuKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgICAgICAgICBjYWNoZTogITEsCiAgICAgICAgICAgICAgICBjcm9zc0RvbWFpbjogITAsCiAgICAgICAgICAgICAgICBkYXRhOiAoRyArIGxhIHx8ICI/IikgKyAiXG4xNTQ2Njk2MDMiCiAgICAgICAgICAgIH0pCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBRKCkgewogICAgICAgICAgICBnYiAmJiBHICYmIChlKCIjY29ubmVjdGluZyIpLnNob3coKSwgUGIoKSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFFiKCkgewogICAgICAgICAgICBpZiAodykgewogICAgICAgICAgICAgICAgdy5vbm9wZW4gPSBudWxsOwogICAgICAgICAgICAgICAgdy5vbm1lc3NhZ2UgPSBudWxsOwogICAgICAgICAgICAgICAgdy5vbmNsb3NlID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdy5jbG9zZSgpCiAgICAgICAgICAgICAgICB9IGNhdGNoIChhKSB7IH0KICAgICAgICAgICAgICAgIHcgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGxiKGEsIGIpIHsKICAgICAgICAgICAgUWIoKTsKICAgICAgICAgICAgRC5pcCAmJiAoYSA9ICJ3cyIgKyAobWIgPyAicyIgOiAiIikgKyAiOi8vIiArIEQuaXApOwogICAgICAgICAgICBpZiAobnVsbCAhPSBTKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IFM7CiAgICAgICAgICAgICAgICBTID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGQoYikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobWIgJiYgIUVudkNvbmZpZy5lbnZfZGV2ZWxvcG1lbnQgJiYgIUVudkNvbmZpZy5lbnZfbG9jYWwpIHsKICAgICAgICAgICAgICAgIHZhciBjID0gYS5zcGxpdCgiOiIpOwogICAgICAgICAgICAgICAgYSA9ICJ3c3M6Ly9pcC0iICsgY1sxXS5yZXBsYWNlKC9cLi9nLCAiLSIpLnJlcGxhY2UoL1wvL2csICIiKSArICIudGVjaC5hZ2FyLmlvOiIgKyArY1syXQogICAgICAgICAgICB9CiAgICAgICAgICAgIEUgPSBbXTsKICAgICAgICAgICAgcSA9IFtdOwogICAgICAgICAgICBLID0ge307CiAgICAgICAgICAgIEEgPSBbXTsKICAgICAgICAgICAgYmEgPSBbXTsKICAgICAgICAgICAgQyA9IFtdOwogICAgICAgICAgICBIID0gSSA9IG51bGw7CiAgICAgICAgICAgIFQgPSAwOwogICAgICAgICAgICBuYSA9ICExOwogICAgICAgICAgICBjb25zb2xlLmxvZygiQ29ubmVjdGluZyB0byAiICsgYSk7CiAgICAgICAgICAgIG0uY2FjaGUuc2VudEdhbWVTZXJ2ZXJMb2dpbiA9ICExOwogICAgICAgICAgICB3ID0gbmV3IFdlYlNvY2tldChhKTsKICAgICAgICAgICAgdy5iaW5hcnlUeXBlID0gImFycmF5YnVmZmVyIjsKICAgICAgICAgICAgLy8gQUdBUkJPVE9WSAogICAgICAgICAgICBpcCA9IGE7CiAgICAgICAgICAgIGlmIChiLmxlbmd0aCA8IDYpIHsKICAgICAgICAgICAgICAgYmd6LnNlbmQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICAgICAiYWN0aW9uIiA6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICJzZXJ2ZXIiIDogYQogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgY291bnQgPSAwOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1NFTkRFRCBQQVJUWSAhJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcm9vbSA9IGI7CiAgICAgICAgICAgIGNoYW5nZUdhbWVNb2RlKCk7CiAgICAgICAgICAgIHcub25vcGVuID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGE7CiAgICAgICAgICAgICAgICBGYSA9IHggPSBEYXRlLm5vdygpOwogICAgICAgICAgICAgICAgb2EgPSAxMjA7CiAgICAgICAgICAgICAgICBHYSA9IDA7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygic29ja2V0IG9wZW4iKTsKICAgICAgICAgICAgICAgIGEgPSBVKDUpOwogICAgICAgICAgICAgICAgYS5zZXRVaW50OCgwLCAyNTQpOwogICAgICAgICAgICAgICAgYS5zZXRVaW50MzIoMSwgNSwgITApOwogICAgICAgICAgICAgICAgVihhKTsKICAgICAgICAgICAgICAgIGEgPSBVKDUpOwogICAgICAgICAgICAgICAgYS5zZXRVaW50OCgwLCAyNTUpOwogICAgICAgICAgICAgICAgYS5zZXRVaW50MzIoMSwgMTU0NjY5NjAzLCAhMCk7CiAgICAgICAgICAgICAgICBWKGEpOwogICAgICAgICAgICAgICAgYSA9IFUoMSArIGIubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGEuc2V0VWludDgoMCwgODApOwogICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCBiLmxlbmd0aDsgKytkKSBhLnNldFVpbnQ4KGQgKyAxLCBiLmNoYXJDb2RlQXQoZCkpOwogICAgICAgICAgICAgICAgVihhKTsKICAgICAgICAgICAgICAgIG0uY29yZS5wcm94eS5vblNvY2tldE9wZW4oKQogICAgICAgICAgICB9OwogICAgICAgICAgICB3Lm9ubWVzc2FnZSA9IHljOwogICAgICAgICAgICB3Lm9uY2xvc2UgPSB6YzsKICAgICAgICAgICAgdy5vbmVycm9yID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coSGEuTCgpICsgIiBzb2NrZXQgZXJyb3IiLCBhcmd1bWVudHMpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFUoYSkgewogICAgICAgICAgICByZXR1cm4gbmV3IERhdGFWaWV3KG5ldyBBcnJheUJ1ZmZlcihhKSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFYoYSkgewogICAgICAgICAgICB3LnNlbmQoYS5idWZmZXIpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB6YygpIHsKICAgICAgICAgICAgbmEgJiYgKElhID0gNTAwKTsKICAgICAgICAgICAgbS5jb3JlLnByb3h5Lm9uU29ja2V0Q2xvc2VkKCk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKEhhLkwoKSArICIgc29ja2V0IGNsb3NlIik7CiAgICAgICAgICAgIHNldFRpbWVvdXQoUSwgSWEpOwogICAgICAgICAgICBJYSAqPSAyCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB5YyhhKSB7CiAgICAgICAgICAgIEFjKG5ldyBEYXRhVmlldyhhLmRhdGEpKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gQWMoYSkgewogICAgICAgICAgICBmdW5jdGlvbiBiKCkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgYiA9ICIiOyA7KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLmdldFVpbnQxNihkLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgZCArPSAyOwogICAgICAgICAgICAgICAgICAgIGlmICgwID09IGMpIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgZCA9IDA7CiAgICAgICAgICAgIGlmICgyNDAgPT0gYS5nZXRVaW50OChkKSkgSmEoKTsKICAgICAgICAgICAgZWxzZSBzd2l0Y2ggKGEuZ2V0VWludDgoZCsrKSkgewogICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICBCYyhhLCBkKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgICAgICAgcGEgPSBhLmdldEZsb2F0MzIoZCwgITApOwogICAgICAgICAgICAgICAgICAgIGQgKz0gNDsKICAgICAgICAgICAgICAgICAgICBxYSA9IGEuZ2V0RmxvYXQzMihkLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgZCArPSA0OwogICAgICAgICAgICAgICAgICAgIHJhID0gYS5nZXRGbG9hdDMyKGQsICEwKTsKICAgICAgICAgICAgICAgICAgICBkICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgICAgIEUgPSBbXTsKICAgICAgICAgICAgICAgICAgICBxID0gW107CiAgICAgICAgICAgICAgICAgICAgSyA9IHt9OwogICAgICAgICAgICAgICAgICAgIEEgPSBbXTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgcSA9IFtdOwogICAgICAgICAgICAgICAgICAgIEUgPSBbXTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAgICAgbmIgPSBhLmdldEludDE2KGQsICEwKTsKICAgICAgICAgICAgICAgICAgICBkICs9IDI7CiAgICAgICAgICAgICAgICAgICAgb2IgPSBhLmdldEludDE2KGQsICEwKTsKICAgICAgICAgICAgICAgICAgICBkICs9IDI7CiAgICAgICAgICAgICAgICAgICAgcGIgfHwgKHBiID0gITAsIEthID0gbmIsIExhID0gb2IpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgICAgICAgICBFLnB1c2goYS5nZXRVaW50MzIoZCwgITApKTsKICAgICAgICAgICAgICAgICAgICBkICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDQ5OgogICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IEkpIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIHZhciB1ID0gYS5nZXRVaW50MzIoZCwgITApLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gZCArIDQ7CiAgICAgICAgICAgICAgICAgICAgQyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGcgPSAwOyBnIDwgdTsgKytnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gYS5nZXRVaW50MzIoZCwgITApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGQgKyA0OwogICAgICAgICAgICAgICAgICAgICAgICBDLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBiKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgUmIoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNTA6CiAgICAgICAgICAgICAgICAgICAgSSA9IFtdOwogICAgICAgICAgICAgICAgICAgIHUgPSBhLmdldFVpbnQzMihkLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgZCArPSA0OwogICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IDA7IGcgPCB1OyArK2cpIEkucHVzaChhLmdldEZsb2F0MzIoZCwgITApKSwgZCArPSA0OwogICAgICAgICAgICAgICAgICAgIFJiKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDY0OgogICAgICAgICAgICAgICAgICAgIE1hID0gYS5nZXRGbG9hdDY0KGQsICEwKTsKICAgICAgICAgICAgICAgICAgICBkICs9IDg7CiAgICAgICAgICAgICAgICAgICAgTmEgPSBhLmdldEZsb2F0NjQoZCwgITApOwogICAgICAgICAgICAgICAgICAgIGQgKz0gODsKICAgICAgICAgICAgICAgICAgICBPYSA9IGEuZ2V0RmxvYXQ2NChkLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgZCArPSA4OwogICAgICAgICAgICAgICAgICAgIFBhID0gYS5nZXRGbG9hdDY0KGQsICEwKTsKICAgICAgICAgICAgICAgICAgICBtYXBDb29yZHMoTWEsIE5hLCBPYSwgUGEpOwogICAgICAgICAgICAgICAgICAgIGQgKz0gODsKICAgICAgICAgICAgICAgICAgICBwYSA9IChPYSArIE1hKSAvIDI7CiAgICAgICAgICAgICAgICAgICAgcWEgPSAoUGEgKyBOYSkgLyAyOwogICAgICAgICAgICAgICAgICAgIHJhID0gMTsKICAgICAgICAgICAgICAgICAgICAwID09IHEubGVuZ3RoICYmICh5ID0gcGEsIHogPSBxYSwgbCA9IHJhKTsKICAgICAgICAgICAgICAgICAgICBhLmJ5dGVMZW5ndGggPiBkICYmICh1ID0gYS5nZXRVaW50MzIoZCwgITApLCBkICs9IDQsIHFiID0gISEodSAmIDEpLCByYiA9IGIoKSwgYy5NQy51cGRhdGVTZXJ2ZXJWZXJzaW9uKHJiKSwgY29uc29sZS5sb2coIlNlcnZlciB2ZXJzaW9uICIgKyByYikpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAxMDI6CiAgICAgICAgICAgICAgICAgICAgdSA9IGEuYnVmZmVyLnNsaWNlKGQpOwogICAgICAgICAgICAgICAgICAgIG0uY29yZS5wcm94eS5mb3J3YXJkUHJvdG9NZXNzYWdlKHUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAxMDQ6CiAgICAgICAgICAgICAgICAgICAgYy5sb2dvdXQoKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBCYyhhLCBiKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIGQoKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBkID0gIiI7IDspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEuZ2V0VWludDE2KGIsICEwKTsKICAgICAgICAgICAgICAgICAgICBiICs9IDI7CiAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT0KICAgICAgICAgICAgICAgICAgICAgICAgYykgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZAogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiB1KCkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9ICIiOyA7KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBhLmdldFVpbnQ4KGIrKyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT0gYykgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZAogICAgICAgICAgICB9CiAgICAgICAgICAgIHggPSBEYXRlLm5vdygpOwogICAgICAgICAgICB2YXIgZyA9IHggLSBGYTsKICAgICAgICAgICAgRmEgPSB4OwogICAgICAgICAgICBvYSA9IENjICogb2EgKyBEYyAqIGc7CiAgICAgICAgICAgIEdhID0gRWMgKiBHYSArIEZjICogTWF0aC5hYnMoZyAtIG9hKTsKICAgICAgICAgICAgbS5jb3JlLmRlYnVnICYmIChtLmRlYnVnLnVwZGF0ZUNoYXJ0KCJuZXR3b3JrVXBkYXRlIiwgeCwgZyksIG0uZGVidWcudXBkYXRlQ2hhcnQoInJ0dE1lYW4iLCB4LCBvYSksIG0uZGVidWcudXBkYXRlQ2hhcnQoInJ0dFNEZXYiLCB4LCBHYSkpOwogICAgICAgICAgICBuYSB8fCAobmEgPSAhMCwgZSgiI2Nvbm5lY3RpbmciKS5oaWRlKCksIFNiKCksIFMgJiYgKFMoKSwgUyA9IG51bGwpKTsKICAgICAgICAgICAgc2IgPSAhMTsKICAgICAgICAgICAgZyA9IGEuZ2V0VWludDE2KGIsICEwKTsKICAgICAgICAgICAgYiArPSAyOwogICAgICAgICAgICBmb3IgKHZhciBwID0gMDsgcCA8IGc7ICsrcCkgewogICAgICAgICAgICAgICAgdmFyIEwgPSBLW2EuZ2V0VWludDMyKGIsICEwKV0sCiAgICAgICAgICAgICAgICAgICAgayA9IEtbYS5nZXRVaW50MzIoYiArIDQsICEwKV07CiAgICAgICAgICAgICAgICBiICs9IDg7CiAgICAgICAgICAgICAgICBMICYmIGsgJiYgKGsuY2EoKSwgay5zID0gay54LCBrLnUgPSBrLnksIGsubyA9IGsuc2l6ZSwgay5uYShMLngsIEwueSksIGsuZyA9IGsuc2l6ZSwgay5VID0geCwgR2MoTCwgaykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChwID0gMDsgOykgewogICAgICAgICAgICAgICAgZyA9IGEuZ2V0VWludDMyKGIsICEwKTsKICAgICAgICAgICAgICAgIGIgKz0gNDsKICAgICAgICAgICAgICAgIGlmICgwID09IGcpIGJyZWFrOwogICAgICAgICAgICAgICAgKytwOwogICAgICAgICAgICAgICAgdmFyIHRiLCBMID0gYS5nZXRJbnQzMihiLCAhMCk7CiAgICAgICAgICAgICAgICBiICs9IDQ7CiAgICAgICAgICAgICAgICBrID0gYS5nZXRJbnQzMihiLCAhMCk7CiAgICAgICAgICAgICAgICBiICs9IDQ7CiAgICAgICAgICAgICAgICB0YiA9IGEuZ2V0SW50MTYoYiwgITApOwogICAgICAgICAgICAgICAgYiArPSAyOwogICAgICAgICAgICAgICAgdmFyIG4gPSBhLmdldFVpbnQ4KGIrKyksCiAgICAgICAgICAgICAgICAgICAgZiA9IGEuZ2V0VWludDgoYisrKSwKICAgICAgICAgICAgICAgICAgICBoID0gYS5nZXRVaW50OChiKyspLAogICAgICAgICAgICAgICAgICAgIGYgPSBIYyhuIDw8IDE2IHwgZiA8PCA4IHwgaCksCiAgICAgICAgICAgICAgICAgICAgaCA9IGEuZ2V0VWludDgoYisrKSwKICAgICAgICAgICAgICAgICAgICBsID0gISEoaCAmIDEpLAogICAgICAgICAgICAgICAgICAgIHIgPSAhIShoICYgMTYpLAogICAgICAgICAgICAgICAgICAgIHQgPSBudWxsOwogICAgICAgICAgICAgICAgaCAmIDIgJiYgKGIgKz0gNCArIGEuZ2V0VWludDMyKGIsICEwKSk7CiAgICAgICAgICAgICAgICBoICYgNCAmJiAodCA9IHUoKSk7CiAgICAgICAgICAgICAgICB2YXIgdiA9IGQoKSwKICAgICAgICAgICAgICAgICAgICBuID0gbnVsbDsKICAgICAgICAgICAgICAgIEsuaGFzT3duUHJvcGVydHkoZykgPyAobiA9IEtbZ10sIG4uVCgpLCBuLnMgPSBuLngsIG4udSA9IG4ueSwgbi5vID0gbi5zaXplLCBuLmNvbG9yID0gZikgOiAobiA9IG5ldyBjYShnLCBMLCBrLCB0YiwgZiwgdiksIEEucHVzaChuKSwgS1tnXSA9IG4pOwogICAgICAgICAgICAgICAgbi5jID0gbDsKICAgICAgICAgICAgICAgIG4uaCA9IHI7CiAgICAgICAgICAgICAgICBuLm5hKEwsIGspOwogICAgICAgICAgICAgICAgbi5nID0gdGI7CiAgICAgICAgICAgICAgICBuLlUgPSB4OwogICAgICAgICAgICAgICAgbi5lYSA9IGg7CiAgICAgICAgICAgICAgICB0ICYmIChuLkMgPSB0KTsKICAgICAgICAgICAgICAgIHYgJiYgbi5BKHYpOyAtMSAhPSBFLmluZGV4T2YoZykgJiYgLTEgPT0gcS5pbmRleE9mKG4pICYmIChxLnB1c2gobiksIG4uSSA9ICEwLCAxID09IHEubGVuZ3RoICYmIChuLnVhID0gITAsIHkgPSBuLngsIHogPSBuLnksIFRiKCksIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJvdmVybGF5cyIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSIsIEYgPSBbXSwgdWIgPSAwLCB2YiA9IHFbMF0uY29sb3IsIEVhID0gITAsIFJhID0gRGF0ZS5ub3coKSwgVyA9IHdiID0geGIgPSAwKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBMID0gYS5nZXRVaW50MzIoYiwgITApOwogICAgICAgICAgICBiICs9IDQ7CiAgICAgICAgICAgIGZvciAocCA9IDA7IHAgPCBMOyBwKyspIGcgPSBhLmdldFVpbnQzMihiLCAhMCksIGIgKz0gNCwgbiA9IEtbZ10sIG51bGwgIT0gbiAmJiBuLmNhKCk7CiAgICAgICAgICAgIHNiICYmIDAgPT0gcS5sZW5ndGggJiYgKDAgPT0gYy5NQy5pc1VzZXJMb2dnZWRJbigpID8gSmEoKSA6IFViID0gc2V0VGltZW91dChKYSwgMkUzKSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFNhKCkgewogICAgICAgICAgICBpZiAoZGEoKSkgewogICAgICAgICAgICAgICAgdmFyIGEgPSBZIC0gciAvIDIsCiAgICAgICAgICAgICAgICAgICAgYiA9IFogLSB0IC8gMjsKCiAgICAgICAgICAgICAgICAvLyBBR0FSQk9UT1ZICiAgICAgICAgICAgICAgICBpZiAoNjQgPiBhICogYSArIGIgKiBiIHx8IC4wMSA+IE1hdGguYWJzKFZiIC0gemEpICYmIC4wMSA+IE1hdGguYWJzKFdiIC0gQWEpIHx8IChWYiA9IHphLCBXYiA9IEFhLCBhID0gVSgxMyksIGEuc2V0VWludDgoMCwgMTYpLCBoZXkoYSwgemEsIEFhKSwgeHQpKSB7CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gQUdBUkJPVE9WSAoKICAgICAgICAgICAgICAgIC8qIDY0ID4gYSAqIGEgKyBiICogYiB8fCAuMDEgPiBNYXRoLmFicyhWYiAtCiAgICAgICAgICAgICAgICAgICAgIHphKSAmJiAuMDEgPiBNYXRoLmFicyhXYiAtIEFhKSB8fCAoVmIgPSB6YSwgV2IgPSBBYSwgYSA9IFUoMTMpLCBhLnNldFVpbnQ4KDAsIDE2KSwgYS5zZXRJbnQzMigxLCB6YSwgITApLCBhLnNldEludDMyKDUsIEFhLCAhMCksIGEuc2V0VWludDMyKDksIDAsICEwKSwgVihhKSkKICAgICAgICAgICAgICovCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFNiKCkgewogICAgICAgICAgICBpZiAoZGEoKSAmJiBuYSAmJiBudWxsICE9IE4pIHsKICAgICAgICAgICAgICAgIHZhciBhID0gVSgxICsgMiAqIE4ubGVuZ3RoKTsKICAgICAgICAgICAgICAgIC8vIEFHQVJCT1RPVkgKICAgICAgICAgICAgICAgIHN0b3BNb3ZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGF1dG9GZWVkSW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgYXV0b0ZlZWRJbnRlcnZhbCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJlZnJlc2goKTsKICAgICAgICAgICAgICAgIC8vIEFHQVJCT1RPVkgKICAgICAgICAgICAgICAgIGEuc2V0VWludDgoMCwgMCk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBiID0gMDsgYiA8IE4ubGVuZ3RoOyArK2IpIGEuc2V0VWludDE2KDEgKyAyICogYiwgTi5jaGFyQ29kZUF0KGIpLCAhMCk7CiAgICAgICAgICAgICAgICBWKGEpOwogICAgICAgICAgICAgICAgTiA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZWIoKSB7CiAgICAgICAgICAgIFNhKCk7CiAgICAgICAgICAgIFgoMTcpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBKYigpIHsKICAgICAgICAgICAgU2EoKTsKICAgICAgICAgICAgWCgyMSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRhKCkgewogICAgICAgICAgICByZXR1cm4gbnVsbCAhPSB3ICYmIHcucmVhZHlTdGF0ZSA9PSB3Lk9QRU4KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFgoYSkgewogICAgICAgICAgICBpZiAoZGEoKSkgewogICAgICAgICAgICAgICAgdmFyIGIgPSBVKDEpOwogICAgICAgICAgICAgICAgYi5zZXRVaW50OCgwLCBhKTsKICAgICAgICAgICAgICAgIFYoYikKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gWGIoKSB7CiAgICAgICAgICAgIHIgPSAxICogYy5pbm5lcldpZHRoOwogICAgICAgICAgICB0ID0gMSAqIGMuaW5uZXJIZWlnaHQ7CiAgICAgICAgICAgIHliLndpZHRoID0gTy53aWR0aCA9IHI7CiAgICAgICAgICAgIHliLmhlaWdodCA9IE8uaGVpZ2h0ID0gdDsKICAgICAgICAgICAgdmFyIGEgPSBlKCIjaGVsbG9Db250YWluZXIiKTsKICAgICAgICAgICAgYS5jc3MoInRyYW5zZm9ybSIsICJub25lIik7CiAgICAgICAgICAgIHZhciBiID0gYS5oZWlnaHQoKSwKICAgICAgICAgICAgICAgIGQgPSBjLmlubmVySGVpZ2h0OwogICAgICAgICAgICAwICE9IGIgLyAyICUgMiAmJiAoYisrLCBhLmhlaWdodChiKSk7CiAgICAgICAgICAgIGIgPiBkIC8gMS4xID8gYS5jc3MoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoLTUwJSwgLTUwJSkgc2NhbGUoIiArIGQgLyBiIC8gMS4xICsgIikiKSA6IGEuY3NzKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKC01MCUsIC01MCUpIik7CiAgICAgICAgICAgIFliKCkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFpiKCkgewogICAgICAgICAgICB2YXIgYTsKICAgICAgICAgICAgYSA9IDEgKiBNYXRoLm1heCh0IC8gMTA4MCwgciAvIDE5MjApOwogICAgICAgICAgICByZXR1cm4gYSAqPSBQCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBJYygpIHsKICAgICAgICAgICAgaWYgKDAgIT0gcS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGEgPSAwLCBiID0gMDsgYiA8IHEubGVuZ3RoOyBiKyspIGEgKz0gcVtiXS5zaXplOwogICAgICAgICAgICAgICAgbCA9ICg5ICogbCArIE1hdGgucG93KE1hdGgubWluKDY0IC8gYSwgMSksIC40KSAqIFpiKCkpIC8gMTAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gWWIoKSB7CiAgICAgICAgICAgIHZhciBhLCBiID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgKytKYzsKICAgICAgICAgICAgJGIgJiYgKCsrVGEsIDE4MCA8IFRhICYmIChUYSA9IDApKTsKICAgICAgICAgICAgeCA9CiAgICAgICAgICAgICAgICBiOwogICAgICAgICAgICBpZiAoMCA8IHEubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBJYygpOwogICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9IGEgPSAwLCBjID0gMDsgYyA8IHEubGVuZ3RoOyBjKyspIHFbY10uVCgpLCBhICs9IHFbY10ueCAvIHEubGVuZ3RoLCBkICs9IHFbY10ueSAvIHEubGVuZ3RoOwogICAgICAgICAgICAgICAgcGEgPSBhOwogICAgICAgICAgICAgICAgcWEgPSBkOwogICAgICAgICAgICAgICAgcmEgPSBsOwogICAgICAgICAgICAgICAgeSA9ICh5ICsgYSkgLyAyOwogICAgICAgICAgICAgICAgeiA9ICh6ICsgZCkgLyAyCiAgICAgICAgICAgIH0gZWxzZSB5ID0gKDI5ICogeSArIHBhKSAvIDMwLCB6ID0gKDI5ICogeiArIHFhKSAvIDMwLCBsID0gKDkgKiBsICsgcmEgKiBaYigpKSAvIDEwOwogICAgICAgICAgICB1YygpOwogICAgICAgICAgICBmYigpOwogICAgICAgICAgICB6YiB8fCBmLmNsZWFyUmVjdCgwLCAwLCByLCB0KTsKICAgICAgICAgICAgemIgPyAoZi5maWxsU3R5bGUgPSBlYSA/ICIjMTExMTExIiA6ICIjRjJGQkZGIiwgZi5nbG9iYWxBbHBoYSA9IC4wNSwgZi5maWxsUmVjdCgwLCAwLCByLCB0KSwgZi5nbG9iYWxBbHBoYSA9IDEpIDogS2MoKTsKICAgICAgICAgICAgQS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYS5zaXplID09IGIuc2l6ZSA/IGEuaWQgLSBiLmlkIDogYS5zaXplIC0gYi5zaXplCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBmLnNhdmUoKTsKICAgICAgICAgICAgZi50cmFuc2xhdGUociAvIDIsIHQgLyAyKTsKICAgICAgICAgICAgZi5zY2FsZShsLCBsKTsKICAgICAgICAgICAgZi50cmFuc2xhdGUoLXksIC16KTsKICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGJhLmxlbmd0aDsgYysrKSBiYVtjXS53KGYpOwogICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwKICAgICAgICAgICAgICAgIEEubGVuZ3RoOyBjKyspIEFbY10udyhmKTsKICAgICAgICAgICAgaWYgKHBiKSB7CiAgICAgICAgICAgICAgICBLYSA9ICgzICogS2EgKyBuYikgLyA0OwogICAgICAgICAgICAgICAgTGEgPSAoMyAqIExhICsgb2IpIC8gNDsKICAgICAgICAgICAgICAgIGYuc2F2ZSgpOwogICAgICAgICAgICAgICAgZi5zdHJva2VTdHlsZSA9ICIjRkZBQUFBIjsKICAgICAgICAgICAgICAgIGYubGluZVdpZHRoID0gMTA7CiAgICAgICAgICAgICAgICBmLmxpbmVDYXAgPSAicm91bmQiOwogICAgICAgICAgICAgICAgZi5saW5lSm9pbiA9ICJyb3VuZCI7CiAgICAgICAgICAgICAgICBmLmdsb2JhbEFscGhhID0gLjU7CiAgICAgICAgICAgICAgICBmLmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IHEubGVuZ3RoOyBjKyspIGYubW92ZVRvKHFbY10ueCwgcVtjXS55KSwgZi5saW5lVG8oS2EsIExhKTsKICAgICAgICAgICAgICAgIGYuc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICBmLnJlc3RvcmUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGYucmVzdG9yZSgpOwogICAgICAgICAgICBIICYmIEgud2lkdGggJiYgZi5kcmF3SW1hZ2UoSCwgciAtIEgud2lkdGggLSAxMCwgMTApOwogICAgICAgICAgICBUID0gTWF0aC5tYXgoVCwgYWMoKSk7CiAgICAgICAgICAgIDAgIT0gVCAmJiAobnVsbCA9PSBVYSAmJiAoVWEgPSBuZXcgVmEoMjQsICIjRkZGRkZGIikpLCBVYS5CKFIoInNjb3JlIikgKyAiOiAiICsgfn4oVCAvIDEwMCkpLCBkID0gVWEuTygpLCBhID0gZC53aWR0aCwgZi5nbG9iYWxBbHBoYSA9IC4yLCBmLmZpbGxTdHlsZSA9ICIjMDAwMDAwIiwgZi5maWxsUmVjdCgxMCwgdCAtIDEwIC0gMjQgLSAxMCwgYSArIDEwLCAzNCksCiAgICAgICAgICAgICAgICBmLmdsb2JhbEFscGhhID0gMSwgZi5kcmF3SW1hZ2UoZCwgMTUsIHQgLSAxMCAtIDI0IC0gNSkpOwogICAgICAgICAgICBMYygpOwogICAgICAgICAgICBiID0gRGF0ZS5ub3coKSAtIGI7CiAgICAgICAgICAgIGIgPiAxRTMgLyA2MCA/IE0gLT0gLjAxIDogYiA8IDFFMyAvIDY1ICYmIChNICs9IC4wMSk7CiAgICAgICAgICAgIC40ID4gTSAmJiAoTSA9IC40KTsKICAgICAgICAgICAgMSA8IE0gJiYgKE0gPSAxKTsKICAgICAgICAgICAgYiA9IHggLSBiYzsKICAgICAgICAgICAgIWRhKCkgfHwgamEgfHwgYWEgPyAoQiArPSBiIC8gMkUzLCAxIDwgQiAmJiAoQiA9IDEpKSA6IChCIC09IGIgLyAzMDAsIDAgPiBCICYmIChCID0gMCkpOwogICAgICAgICAgICAwIDwgQiA/IChmLmZpbGxTdHlsZSA9ICIjMDAwMDAwIiwgY2MgPyAoZi5nbG9iYWxBbHBoYSA9IEIsIGYuZmlsbFJlY3QoMCwgMCwgciwgdCksIEouY29tcGxldGUgJiYgSi53aWR0aCAmJiAoSi53aWR0aCAvIEouaGVpZ2h0IDwgciAvIHQgPyAoYiA9IHIsIGEgPSBKLmhlaWdodCAqIHIgLyBKLndpZHRoKSA6IChiID0gSi53aWR0aCAqIHQgLyBKLmhlaWdodCwgYSA9IHQpLCBmLmRyYXdJbWFnZShKLCAociAtIGIpIC8gMiwgKHQgLSBhKSAvIDIsIGIsIGEpLCBmLmdsb2JhbEFscGhhID0gLjUgKiBCLCBmLmZpbGxSZWN0KDAsIDAsIHIsIHQpKSkgOiAoZi5nbG9iYWxBbHBoYSA9IC41ICogQiwgZi5maWxsUmVjdCgwLCAwLCByLCB0KSksIGYuZ2xvYmFsQWxwaGEgPSAxKSA6IGNjID0gITE7CiAgICAgICAgICAgIGJjID0geAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gS2MoKSB7CiAgICAgICAgICAgIGYuZmlsbFN0eWxlID0KICAgICAgICAgICAgICAgIGVhID8gIiMxMTExMTEiIDogIiNGMkZCRkYiOwogICAgICAgICAgICBmLmZpbGxSZWN0KDAsIDAsIHIsIHQpOwogICAgICAgICAgICBmLnNhdmUoKTsKICAgICAgICAgICAgZi5zdHJva2VTdHlsZSA9IGVhID8gIiNBQUFBQUEiIDogIiMwMDAwMDAiOwogICAgICAgICAgICBmLmdsb2JhbEFscGhhID0gLjIgKiBsOwogICAgICAgICAgICBmb3IgKHZhciBhID0gciAvIGwsIGIgPSB0IC8gbCwgZCA9ICgteSArIGEgLyAyKSAlIDUwOyBkIDwgYTsgZCArPSA1MCkgZi5iZWdpblBhdGgoKSwgZi5tb3ZlVG8oZCAqIGwgLSAuNSwgMCksIGYubGluZVRvKGQgKiBsIC0gLjUsIGIgKiBsKSwgZi5zdHJva2UoKTsKICAgICAgICAgICAgZm9yIChkID0gKC16ICsgYiAvIDIpICUgNTA7IGQgPCBiOyBkICs9IDUwKSBmLmJlZ2luUGF0aCgpLCBmLm1vdmVUbygwLCBkICogbCAtIC41KSwgZi5saW5lVG8oYSAqIGwsIGQgKiBsIC0gLjUpLCBmLnN0cm9rZSgpOwogICAgICAgICAgICBmLnJlc3RvcmUoKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gTGMoKSB7CiAgICAgICAgICAgIGlmIChkYyAmJiBBYi53aWR0aCkgewogICAgICAgICAgICAgICAgdmFyIGEgPSByIC8gNTsKICAgICAgICAgICAgICAgIGYuZHJhd0ltYWdlKEFiLCA1LCA1LCBhLCBhKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhYygpIHsKICAgICAgICAgICAgZm9yICh2YXIgYSA9IDAsIGIgPSAwOyBiIDwgcS5sZW5ndGg7IGIrKykgYSArPSBxW2JdLmcgKiBxW2JdLmc7CiAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBSYigpIHsKICAgICAgICAgICAgSCA9IG51bGw7CiAgICAgICAgICAgIGlmIChudWxsICE9IEkgfHwgMCAhPSBDLmxlbmd0aCkKICAgICAgICAgICAgICAgIGlmIChudWxsICE9IEkgfHwgZmEpIHsKICAgICAgICAgICAgICAgICAgICBIID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBILmdldENvbnRleHQoIjJkIiksCiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSA2MCwKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IG51bGwgPT0gSSA/IGIgKyAyNCAqIEMubGVuZ3RoIDogYiArIDE4MCwKICAgICAgICAgICAgICAgICAgICAgICAgZCA9IE1hdGgubWluKDIwMCwgLjMgKiByKSAvIDIwMDsKICAgICAgICAgICAgICAgICAgICBILndpZHRoID0gMjAwICogZDsKICAgICAgICAgICAgICAgICAgICBILmhlaWdodCA9IGIgKiBkOwogICAgICAgICAgICAgICAgICAgIGEuc2NhbGUoZCwgZCk7CiAgICAgICAgICAgICAgICAgICAgYS5nbG9iYWxBbHBoYSA9IC40OwogICAgICAgICAgICAgICAgICAgIGEuZmlsbFN0eWxlID0gIiMwMDAwMDAiOwogICAgICAgICAgICAgICAgICAgIGEuZmlsbFJlY3QoMCwgMCwgMjAwLCBiKTsKICAgICAgICAgICAgICAgICAgICBhLmdsb2JhbEFscGhhID0gMTsKICAgICAgICAgICAgICAgICAgICBhLmZpbGxTdHlsZSA9ICIjRkZGRkZGIjsKICAgICAgICAgICAgICAgICAgICBkID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBkID0gUigibGVhZGVyYm9hcmQiKTsKICAgICAgICAgICAgICAgICAgICBhLmZvbnQgPSAiMzBweCBVYnVudHUiOwogICAgICAgICAgICAgICAgICAgIGEuZmlsbFRleHQoZCwgMTAwIC0gYS5tZWFzdXJlVGV4dChkKS53aWR0aCAvIDIsIDQwKTsKICAgICAgICAgICAgICAgICAgICB2YXIgYywgZTsKICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBJKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGEuZm9udCA9ICIyMHB4IFVidW50dSIsIGIgPSAwOyBiIDwgQy5sZW5ndGg7ICsrYikgZCA9IENbYl0ubmFtZSB8fCBSKCJ1bm5hbWVkX2NlbGwiKSwgZmEgfHwgKGQgPSBSKCJ1bm5hbWVkX2NlbGwiKSksIDEgPT0gQ1tiXS5pZCB8fCAtMSAhPSBFLmluZGV4T2YoQ1tiXS5pZCkgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHFbMF0ubmFtZSAmJiAoZCA9IHFbMF0ubmFtZSksIGEuZmlsbFN0eWxlID0gIiNGRkFBQUEiKSA6IGEuZmlsbFN0eWxlID0gIiNGRkZGRkYiLCBkID0gYiArIDEgKyAiLiAiICsgZCwgZSA9IGEubWVhc3VyZVRleHQoZCkud2lkdGgsIGMgPSA3MCArIDI0ICogYiwgMjAwIDwgZSA/IGEuZmlsbFRleHQoZCwgMTAsIGMpIDogYS5maWxsVGV4dChkLCAoMjAwIC0gZSkgLyAyLCBjKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiA9IGQgPSAwOyBiIDwgSS5sZW5ndGg7ICsrYikgYyA9IGQgKyBJW2JdICogTWF0aC5QSSAqIDIsIGEuZmlsbFN0eWxlID0gTWNbYiArIDFdLCBhLmJlZ2luUGF0aCgpLCBhLm1vdmVUbygxMDAsIDE0MCksIGEuYXJjKDEwMCwgMTQwLCA4MCwgZCwgYywgITEpLCBhLmZpbGwoKSwgZCA9IGMKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIE5jKGEpIHsKICAgICAgICAgICAgaWYgKG51bGwgPT0gYSB8fCAwID09IGEubGVuZ3RoKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKCIlIiA9PSBhWzBdKSB7CiAgICAgICAgICAgICAgICBpZiAoIWMuTUMgfHwgIWMuTUMuZ2V0U2tpbkluZm8pIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgYSA9IGMuTUMuZ2V0U2tpbkluZm8oInNraW5fIiArIGEuc2xpY2UoMSkpOwogICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gYSkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBmb3IgKGEgPSAoK2EuY29sb3IpLnRvU3RyaW5nKDE2KSA7IDYgPgogICAgICAgICAgICAgICAgICAgIGEubGVuZ3RoOykgYSA9ICIwIiArIGE7CiAgICAgICAgICAgICAgICByZXR1cm4gIiMiICsgYQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBlYyhhKSB7CiAgICAgICAgICAgIGlmIChudWxsID09IGEgfHwgMCA9PSBhLmxlbmd0aCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGlmICghc2EuaGFzT3duUHJvcGVydHkoYSkpIHsKICAgICAgICAgICAgICAgIHZhciBiID0gbmV3IEltYWdlOwogICAgICAgICAgICAgICAgaWYgKCI6IiA9PSBhWzBdKSBiLnNyYyA9IGEuc2xpY2UoMSk7CiAgICAgICAgICAgICAgICBlbHNlIGlmICgiJSIgPT0gYVswXSkgewogICAgICAgICAgICAgICAgICAgIGlmICghYy5NQyB8fCAhYy5NQy5nZXRTa2luSW5mbykgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBjLk1DLmdldFNraW5JbmZvKCJza2luXyIgKyBhLnNsaWNlKDEpKTsKICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBkKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICBiLnNyYyA9IGMuQVNTRVRTX1JPT1QgKyBkLnVybAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2FbYV0gPSBiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDAgIT0gc2FbYV0ud2lkdGggJiYgc2FbYV0uY29tcGxldGUgPyBzYVthXSA6IG51bGwKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIEJiKGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICAgICAgdGhpcy4kID0gYTsKICAgICAgICAgICAgdGhpcy54ID0gYjsKICAgICAgICAgICAgdGhpcy55ID0gZDsKICAgICAgICAgICAgdGhpcy5mID0gYzsKICAgICAgICAgICAgdGhpcy5iID0gZQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2EoYSwgYiwgZCwgYywgZSwgcCkgewogICAgICAgICAgICB0aGlzLmlkID0gYTsKICAgICAgICAgICAgdGhpcy5zID0gdGhpcy54ID0gdGhpcy5NID0gdGhpcy5KID0gYjsKICAgICAgICAgICAgdGhpcy51ID0gdGhpcy55ID0gdGhpcy5OID0gdGhpcy5LID0gZDsKICAgICAgICAgICAgdGhpcy5vID0gdGhpcy5zaXplID0gYzsKICAgICAgICAgICAgdGhpcy5jb2xvciA9IGU7CiAgICAgICAgICAgIHRoaXMuYSA9IFtdOwogICAgICAgICAgICB0aGlzLmJhKCk7CiAgICAgICAgICAgIHRoaXMuQShwKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gSGMoYSkgewogICAgICAgICAgICBmb3IgKGEgPSBhLnRvU3RyaW5nKDE2KSA7IDYgPiBhLmxlbmd0aDspIGEgPSAiMCIgKyBhOwogICAgICAgICAgICByZXR1cm4gIiMiICsgYQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gVmEoYSwgYiwgZCwgYykgewogICAgICAgICAgICBhICYmICh0aGlzLnYgPSBhKTsKICAgICAgICAgICAgYiAmJiAodGhpcy5XID0gYik7CiAgICAgICAgICAgIHRoaXMuWSA9ICEhZDsKICAgICAgICAgICAgYyAmJiAodGhpcy5aID0gYykKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIE9jKGEpIHsKICAgICAgICAgICAgZm9yICh2YXIgYiA9IGEubGVuZ3RoLCBkLCBjOyAwIDwgYjspIGMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBiKSwgYi0tLCBkID0gYVtiXSwgYVtiXSA9IGFbY10sIGFbY10gPSBkCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBQYygpIHsKICAgICAgICAgICAgaCA9IFdhCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmYyhhKSB7CiAgICAgICAgICAgIGguY29udGV4dCA9ICJnb29nbGUiID09IGEgPyAiZ29vZ2xlIiA6ICJmYWNlYm9vayI7CiAgICAgICAgICAgIFhhKCkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFhhKCkgewogICAgICAgICAgICBjLmxvY2FsU3RvcmFnZS5zdG9yZU9iamVjdEluZm8gPSBKU09OLnN0cmluZ2lmeShoKTsKICAgICAgICAgICAgaCA9IEpTT04ucGFyc2UoYy5sb2NhbFN0b3JhZ2Uuc3RvcmVPYmplY3RJbmZvKTsKICAgICAgICAgICAgYy5zdG9yYWdlSW5mbyA9IGg7CiAgICAgICAgICAgICJnb29nbGUiID09IGguY29udGV4dCA/IChlKCIjZ1BsdXNTaGFyZSIpLnNob3coKSwgZSgiI2ZiU2hhcmUiKS5oaWRlKCkpIDogKGUoIiNnUGx1c1NoYXJlIikuaGlkZSgpLCBlKCIjZmJTaGFyZSIpLnNob3coKSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdjKGEpIHsKICAgICAgICAgICAgZSgiI2hlbGxvQ29udGFpbmVyIikuYXR0cigiZGF0YS1oYXMtYWNjb3VudC1kYXRhIik7CiAgICAgICAgICAgICIiICE9IGEuZGlzcGxheU5hbWUgJiYgKGEubmFtZSA9IGEuZGlzcGxheU5hbWUpOwogICAgICAgICAgICBpZiAobnVsbCA9PSBhLm5hbWUgfHwgdm9pZCAwID09IGEubmFtZSkgYS5uYW1lID0gIiI7CiAgICAgICAgICAgIHZhciBiID0gYS5uYW1lLmxhc3RJbmRleE9mKCJfIik7IC0xICE9IGIgJiYgKGEubmFtZSA9IGEubmFtZS5zdWJzdHJpbmcoMCwgYikpOwogICAgICAgICAgICBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLWhhcy1hY2NvdW50LWRhdGEiLCAiMSIpOwogICAgICAgICAgICBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLWxvZ2dlZC1pbiIsICIxIik7CiAgICAgICAgICAgIGUoIi5hZ2FyaW8tcHJvZmlsZS1wYW5lbCAucHJvZ3Jlc3MtYmFyLXN0YXIiKS50ZXh0KGEubGV2ZWwpOwogICAgICAgICAgICBlKCIuYWdhcmlvLWV4cC1iYXIgLnByb2dyZXNzLWJhci10ZXh0IikudGV4dChhLnhwICsgIi8iICsgYS54cE5lZWRlZCArICIgWFAiKTsKICAgICAgICAgICAgZSgiLmFnYXJpby1leHAtYmFyIC5wcm9ncmVzcy1iYXIiKS5jc3MoIndpZHRoIiwgKDg4ICogYS54cCAvIGEueHBOZWVkZWQpLnRvRml4ZWQoMikgKyAiJSIpOwogICAgICAgICAgICBlKCIuYWdhcmlvLXByb2ZpbGUtbmFtZSIpLnRleHQoYS5uYW1lKTsKICAgICAgICAgICAgIiIgIT0gYS5waWN0dXJlICYmIGUoIi5hZ2FyaW8tcHJvZmlsZS1waWN0dXJlIikuYXR0cigic3JjIiwgYS5waWN0dXJlKTsKICAgICAgICAgICAgQ2IoKTsKICAgICAgICAgICAgaC51c2VySW5mby5sZXZlbCA9IGEubGV2ZWw7CiAgICAgICAgICAgIGgudXNlckluZm8ueHAgPSBhLnhwOwogICAgICAgICAgICBoLnVzZXJJbmZvLnhwTmVlZGVkID0gYS54cE5lZWRlZDsKICAgICAgICAgICAgaC51c2VySW5mby5kaXNwbGF5TmFtZSA9IGEubmFtZTsKICAgICAgICAgICAgaC51c2VySW5mby5sb2dnZWRJbiA9ICIxIjsKICAgICAgICAgICAgYy51cGRhdGVTdG9yYWdlKCkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdhKGEsIGIpIHsKICAgICAgICAgICAgdmFyIGQgPSBhOwogICAgICAgICAgICBpZiAoaC51c2VySW5mby5sb2dnZWRJbikgewogICAgICAgICAgICAgICAgdmFyIHUgPSBlKCIjaGVsbG9Db250YWluZXIiKS5pcygiOnZpc2libGUiKSAmJiAiMSIgPT0gZSgiI2hlbGxvQ29udGFpbmVyIikuYXR0cigiZGF0YS1oYXMtYWNjb3VudC1kYXRhIik7CiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBkIHx8IHZvaWQgMCA9PSBkKSBkID0gaC51c2VySW5mbzsKICAgICAgICAgICAgICAgIGlmICh1KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSArZSgiLmFnYXJpby1leHAtYmFyIC5wcm9ncmVzcy1iYXItdGV4dCIpLmZpcnN0KCkudGV4dCgpLnNwbGl0KCIvIilbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgIHUgPSArZSgiLmFnYXJpby1leHAtYmFyIC5wcm9ncmVzcy1iYXItdGV4dCIpLmZpcnN0KCkudGV4dCgpLnNwbGl0KCIvIilbMV0uc3BsaXQoIiAiKVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGUoIi5hZ2FyaW8tcHJvZmlsZS1wYW5lbCAucHJvZ3Jlc3MtYmFyLXN0YXIiKS5maXJzdCgpLnRleHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAocCAhPSBkLmxldmVsKSBnYSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHhwOiB1LAogICAgICAgICAgICAgICAgICAgICAgICB4cE5lZWRlZDogdSwKICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IHAKICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIi5hZ2FyaW8tcHJvZmlsZS1wYW5lbCAucHJvZ3Jlc3MtYmFyLXN0YXIiKS50ZXh0KGQubGV2ZWwpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIuYWdhcmlvLWV4cC1iYXIgLnByb2dyZXNzLWJhciIpLmNzcygid2lkdGgiLCAiMTAwJSIpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIucHJvZ3Jlc3MtYmFyLXN0YXIiKS5hZGRDbGFzcygiYW5pbWF0ZWQgdGFkYSIpLm9uZSgid2Via2l0QW5pbWF0aW9uRW5kIG1vekFuaW1hdGlvbkVuZCBNU0FuaW1hdGlvbkVuZCBvYW5pbWF0aW9uZW5kIGFuaW1hdGlvbmVuZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoIi5wcm9ncmVzcy1iYXItc3RhciIpLnJlbW92ZUNsYXNzKCJhbmltYXRlZCB0YWRhIikKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSgiLmFnYXJpby1leHAtYmFyIC5wcm9ncmVzcy1iYXItdGV4dCIpLnRleHQoZC54cE5lZWRlZCArICIvIiArIGQueHBOZWVkZWQgKyAiIFhQIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHA6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHBOZWVkZWQ6IGQueHBOZWVkZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IGQubGV2ZWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYShkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwgMUUzKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IERhdGUubm93KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSAoRGF0ZS5ub3coKSAtIGYpIC8gMUUzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSAwID4gYSA/IDAgOiAxIDwgYSA/IDEgOiBhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBhICogYSAqICgzIC0gMiAqIGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoIi5hZ2FyaW8tZXhwLWJhciAucHJvZ3Jlc3MtYmFyLXRleHQiKS50ZXh0KH5+KGcgKyAoZC54cCAtIGcpICogYSkgKyAiLyIgKyBkLnhwTmVlZGVkICsgIiBYUCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoIi5hZ2FyaW8tZXhwLWJhciAucHJvZ3Jlc3MtYmFyIikuY3NzKCJ3aWR0aCIsICg4OCAqIChnICsgKGQueHAgLSBnKSAqIGEpIC8gZC54cE5lZWRlZCkudG9GaXhlZCgyKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiAmJiBiKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSA+IGEgJiYgYy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGMucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGspCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBDYigpIHsKICAgICAgICAgICAgdmFyIGE7CiAgICAgICAgICAgICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGEgJiYgYSB8fCAibm9uZSIgPT0gZSgiI3NldHRpbmdzIikuY3NzKCJkaXNwbGF5IikgJiYgIm5vbmUiID09IGUoIiNzb2NpYWxMb2dpbkNvbnRhaW5lciIpLmNzcygiZGlzcGxheSIpKSAmJiBlKCIjaW5zdHJ1Y3Rpb25zIikuc2hvdygpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBoYyhhKSB7CiAgICAgICAgICAgIGlmICgiY29ubmVjdGVkIiA9PSBhLnN0YXR1cykgewogICAgICAgICAgICAgICAgdmFyIGIgPSBhLmF1dGhSZXNwb25zZS5hY2Nlc3NUb2tlbjsKICAgICAgICAgICAgICAgIG51bGwgPT0gYiB8fCAidW5kZWZpbmVkIiA9PSBiIHx8ICIiID09IGIgPyAoMyA+IGljICYmIChpYysrLCBjLmZhY2Vib29rUmVsb2dpbigpKSwgYy5sb2dvdXQoKSkgOiAoYy5NQy5kb0xvZ2luV2l0aEZCKGIpLCBtLmNhY2hlLmxvZ2luX2luZm8gPSBbYiwgImZhY2Vib29rIl0sIGMuRkIuYXBpKCIvbWUvcGljdHVyZT93aWR0aD0xODAmaGVpZ2h0PTE4MCIsIGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgICAgICAgICAgaC51c2VySW5mby5waWN0dXJlID0gYi5kYXRhLnVybDsKICAgICAgICAgICAgICAgICAgICBjLnVwZGF0ZVN0b3JhZ2UoKTsKICAgICAgICAgICAgICAgICAgICBlKCIuYWdhcmlvLXByb2ZpbGUtcGljdHVyZSIpLmF0dHIoInNyYyIsIGIuZGF0YS51cmwpOwogICAgICAgICAgICAgICAgICAgIGgudXNlckluZm8uc29jaWFsSWQgPSBhLmF1dGhSZXNwb25zZS51c2VySUQ7CiAgICAgICAgICAgICAgICAgICAgWWEoKQogICAgICAgICAgICAgICAgfSksIGUoIiNoZWxsb0NvbnRhaW5lciIpLmF0dHIoImRhdGEtbG9nZ2VkLWluIiwgIjEiKSwgaC5jb250ZXh0ID0gImZhY2Vib29rIiwgaC5sb2dpbkludGVudCA9ICIxIiwgYy51cGRhdGVTdG9yYWdlKCkpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGpjKGEpIHsKICAgICAgICAgICAga2EoIjpwYXJ0eSIpOwogICAgICAgICAgICBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLXBhcnR5LXN0YXRlIiwgIjQiKTsKICAgICAgICAgICAgYSA9IGRlY29kZVVSSUNvbXBvbmVudChhKS5yZXBsYWNlKC8uKiMvZ2ltLCAiIik7CiAgICAgICAgICAgIERiKCIjIiArIGMuZW5jb2RlVVJJQ29tcG9uZW50KGEpKTsKICAgICAgICAgICAgZS5hamF4KENhICsgImdldFRva2VuIiwgewogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLXBhcnR5LXN0YXRlIiwgIjYiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgICAgICAgICAgYiA9IGIuc3BsaXQoIlxuIik7CiAgICAgICAgICAgICAgICAgICAgZSgiLnBhcnR5VG9rZW4iKS52YWwoImFnYXIuaW8vIyIgKyBjLmVuY29kZVVSSUNvbXBvbmVudChhKSk7CiAgICAgICAgICAgICAgICAgICAgZSgiI2hlbGxvQ29udGFpbmVyIikuYXR0cigiZGF0YS1wYXJ0eS1zdGF0ZSIsICI1Iik7CiAgICAgICAgICAgICAgICAgICAga2EoIjpwYXJ0eSIpOwogICAgICAgICAgICAgICAgICAgIGxiKCJ3czovLyIgKyBiWzBdLCBhKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICAgICAgICAgIGNhY2hlOiAhMSwKICAgICAgICAgICAgICAgIGNyb3NzRG9tYWluOiAhMCwKICAgICAgICAgICAgICAgIGRhdGE6IGEKICAgICAgICAgICAgfSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIERiKGEpIHsKICAgICAgICAgICAgYy5oaXN0b3J5ICYmIGMuaGlzdG9yeS5yZXBsYWNlU3RhdGUgJiYgYy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgYy5kb2N1bWVudC50aXRsZSwgYSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIEphKCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQoVWIpOwogICAgICAgICAgICBudWxsID09IGMuc3RvcmFnZUluZm8gJiYgYy5jcmVhdGVEZWZhdWx0U3RvcmFnZSgpOwogICAgICAgICAgICBFYiA9IERhdGUubm93KCk7CiAgICAgICAgICAgIDAgPj0gUmEgJiYgKFJhID0gRWIpOwogICAgICAgICAgICBFYSA9ICExOwogICAgICAgICAgICBRYygpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBHYyhhLCBiKSB7CiAgICAgICAgICAgIHZhciBkID0gLTEgIT0gRS5pbmRleE9mKGEuaWQpLAogICAgICAgICAgICAgICAgYyA9IC0xICE9IEUuaW5kZXhPZihiLmlkKSwKICAgICAgICAgICAgICAgIGUgPSAzMCA+IGIuc2l6ZTsKICAgICAgICAgICAgZCAmJiBlICYmICsrdWI7CiAgICAgICAgICAgIGUgfHwgIWQgfHwgYyB8fCBiLmVhICYgMzIgfHwgKyt3YgogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24ga2MoYSkgewogICAgICAgICAgICBhID0gfn5hOwogICAgICAgICAgICB2YXIgYiA9IChhICUgNjApLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIGEgPSAofn4oYSAvIDYwKSkudG9TdHJpbmcoKTsKICAgICAgICAgICAgMiA+IGIubGVuZ3RoICYmIChiID0gIjAiICsgYik7CiAgICAgICAgICAgIHJldHVybiBhICsgIjoiICsgYgogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gUmMoKSB7CiAgICAgICAgICAgIGlmIChudWxsID09IEMpIHJldHVybiAwOwogICAgICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IEMubGVuZ3RoOyArK2EpCiAgICAgICAgICAgICAgICBpZiAoLTEgIT0gRS5pbmRleE9mKENbYV0uaWQpKSByZXR1cm4gYSArIDE7CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBTYygpIHsKICAgICAgICAgICAgZSgiLnN0YXRzLWZvb2QtZWF0ZW4iKS50ZXh0KHViKTsKICAgICAgICAgICAgZSgiLnN0YXRzLXRpbWUtYWxpdmUiKS50ZXh0KGtjKChFYiAtIFJhKSAvIDFFMykpOwogICAgICAgICAgICBlKCIuc3RhdHMtbGVhZGVyYm9hcmQtdGltZSIpLnRleHQoa2MoeGIpKTsKICAgICAgICAgICAgZSgiLnN0YXRzLWhpZ2hlc3QtbWFzcyIpLnRleHQofn4oVCAvIDEwMCkpOwogICAgICAgICAgICBlKCIuc3RhdHMtY2VsbHMtZWF0ZW4iKS50ZXh0KHdiKTsKICAgICAgICAgICAgZSgiLnN0YXRzLXRvcC1wb3NpdGlvbiIpLnRleHQoMCA9PSBXID8gIjooIiA6CiAgICAgICAgICAgICAgICBXKTsKICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3RhdHNHcmFwaCIpOwogICAgICAgICAgICBpZiAoYSkgewogICAgICAgICAgICAgICAgdmFyIGIgPSBhLmdldENvbnRleHQoIjJkIiksCiAgICAgICAgICAgICAgICAgICAgZCA9IGEud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgYSA9IGEuaGVpZ2h0OwogICAgICAgICAgICAgICAgYi5jbGVhclJlY3QoMCwgMCwgZCwgYSk7CiAgICAgICAgICAgICAgICBpZiAoMiA8IEYubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IDIwMCwgZyA9IDA7IGcgPCBGLmxlbmd0aDsgZysrKSBjID0gTWF0aC5tYXgoRltnXSwgYyk7CiAgICAgICAgICAgICAgICAgICAgYi5saW5lV2lkdGggPSAzOwogICAgICAgICAgICAgICAgICAgIGIubGluZUNhcCA9ICJyb3VuZCI7CiAgICAgICAgICAgICAgICAgICAgYi5saW5lSm9pbiA9ICJyb3VuZCI7CiAgICAgICAgICAgICAgICAgICAgYi5zdHJva2VTdHlsZSA9IHZiOwogICAgICAgICAgICAgICAgICAgIGIuZmlsbFN0eWxlID0gdmI7CiAgICAgICAgICAgICAgICAgICAgYi5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBiLm1vdmVUbygwLCBhIC0gRlswXSAvIGMgKiAoYSAtIDEwKSArIDEwKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGcgPSAxOyBnIDwgRi5sZW5ndGg7IGcgKz0gTWF0aC5tYXgofn4oRi5sZW5ndGggLyBkKSwgMSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcCA9IGcgLyAoRi5sZW5ndGggLSAxKSAqIGQsIGYgPSBbXSwgayA9IC0yMDsgMjAgPj0gazsgKytrKSAwID4gZyArIGsgfHwgZyArIGsgPj0gRi5sZW5ndGggfHwgZi5wdXNoKEZbZyArIGtdKTsKICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGYucmVkdWNlKGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSArIGIKICAgICAgICAgICAgICAgICAgICAgICAgfSkgLyBmLmxlbmd0aCAvIGM7CiAgICAgICAgICAgICAgICAgICAgICAgIGIubGluZVRvKHAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIC0gZiAqIChhIC0gMTApICsgMTApCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGIuc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICAgICAgYi5nbG9iYWxBbHBoYSA9IC41OwogICAgICAgICAgICAgICAgICAgIGIubGluZVRvKGQsIGEpOwogICAgICAgICAgICAgICAgICAgIGIubGluZVRvKDAsIGEpOwogICAgICAgICAgICAgICAgICAgIGIuZmlsbCgpOwogICAgICAgICAgICAgICAgICAgIGIuZ2xvYmFsQWxwaGEgPSAxCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFFjKCkgewogICAgICAgICAgICBqYSB8fCBhYSB8fCAoWmEgPyAoYy5yZWZyZXNoQWQoYy5hZFNsb3RzLmFiKSwgU2MoKSwgYWEgPSAhMCwgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBlKCIjb3ZlcmxheXMiKS5mYWRlSW4oNTAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgZ2EoKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlKCIjc3RhdHMiKS5zaG93KCk7CiAgICAgICAgICAgICAgICB2YXIgYSA9IGxjKCJnX3BsdXNfc2hhcmVfc3RhdHMiKTsKICAgICAgICAgICAgICAgIGMuZmlsbFNvY2lhbFZhbHVlcyhhLCAiZ1BsdXNTaGFyZSIpCiAgICAgICAgICAgIH0sIDE1MDApKSA6IHlhKDUwMCkpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsYyhhKSB7CiAgICAgICAgICAgIHZhciBiID0gZSgiLnN0YXRzLXRpbWUtYWxpdmUiKS50ZXh0KCk7CiAgICAgICAgICAgIHJldHVybiBjLnBhcnNlU3RyaW5nKGEsICIlQCIsIFtiLnNwbGl0KCI6IilbMF0sIGIuc3BsaXQoIjoiKVsxXSwgZSgiLnN0YXRzLWhpZ2hlc3QtbWFzcyIpLnRleHQoKV0pCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBUYygpIHsKICAgICAgICAgICAgYy5vcGVuKCJodHRwczovL3BsdXMuZ29vZ2xlLmNvbS9zaGFyZT91cmw9d3d3LmFnYXIuaW8maGw9ZW4tVVMiLCAiQWdhci5pbyIsICJ3aWR0aD00ODQsaGVpZ2h0PTU4MCxtZW51YmFyPW5vLHRvb2xiYXI9bm8scmVzaXphYmxlPXllcyxzY3JvbGxiYXJzPW5vLGxlZnQ9IiArIChjLnNjcmVlblggKyBjLmlubmVyV2lkdGggLyAyIC0gMjQyKSArICIsdG9wPSIgKyAoYy5pbm5lckhlaWdodCAtIDU4MCkgLyAyKQogICAgICAgIH0KICAgICAgICB2YXIgbWMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgICAgICBpZiAoInVuZGVmaW5lZCIgPT0gdHlwZW9mIGNvbnNvbGUgfHwgInVuZGVmaW5lZCIgPT0gdHlwZW9mIERhdGFWaWV3IHx8ICJ1bmRlZmluZWQiID09IHR5cGVvZiBXZWJTb2NrZXQgfHwgbnVsbCA9PSBtYyB8fCBudWxsID09IG1jLmdldENvbnRleHQgfHwgbnVsbCA9PSBjLmxvY2FsU3RvcmFnZSkgYWxlcnQoIllvdSBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgdGhpcyBnYW1lLCB3ZSByZWNvbW1lbmQgeW91IHRvIHVzZSBGaXJlZm94IHRvIHBsYXkgdGhpcyIpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgRCA9IHt9OwogICAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGEgPSBjLmxvY2F0aW9uLnNlYXJjaDsKICAgICAgICAgICAgICAgICI/IiA9PSBhLmNoYXJBdCgwKSAmJiAoYSA9CiAgICAgICAgICAgICAgICAgICAgYS5zbGljZSgxKSk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBhID0gYS5zcGxpdCgiJiIpLCBiID0gMDsgYiA8IGEubGVuZ3RoOyBiKyspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGFbYl0uc3BsaXQoIj0iKTsKICAgICAgICAgICAgICAgICAgICBEW2RbMF1dID0gZFsxXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSgpOwogICAgICAgICAgICBjLnF1ZXJ5U3RyaW5nID0gRDsKICAgICAgICAgICAgdmFyIG5jID0gImZiIiBpbiBELAogICAgICAgICAgICAgICAgVWMgPSAibWluaWNsaXAiIGluIEQsCiAgICAgICAgICAgICAgICB2ID0gewogICAgICAgICAgICAgICAgICAgIHNraW5zRW5hYmxlZDogIjAiLAogICAgICAgICAgICAgICAgICAgIG5hbWVzRW5hYmxlZDogIjAiLAogICAgICAgICAgICAgICAgICAgIG5vQ29sb3JzOiAiMCIsCiAgICAgICAgICAgICAgICAgICAgYmxhY2tUaGVtZTogIjAiLAogICAgICAgICAgICAgICAgICAgIHNob3dNYXNzOiAiMCIsCiAgICAgICAgICAgICAgICAgICAgc3RhdHNFbmFibGVkOiAiMCIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBWYyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB1YSgiIiwgLTEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb2MgPSAiaHR0cDoiICE9IGMubG9jYXRpb24ucHJvdG9jb2wsCiAgICAgICAgICAgICAgICBXYyA9ICIxIiA9PSB0YygpLAogICAgICAgICAgICAgICAgcGMgPSAhMTsKICAgICAgICAgICAgbmMgfHwgVWMgfHwgKG9jICYmICFXYyA/ICh1YSgiMSIsIDEpLCBjLmxvY2F0aW9uLmhyZWYgPSAiaHR0cDoiICsgYy5sb2NhdGlvbi5ocmVmLnN1YnN0cmluZyhjLmxvY2F0aW9uLnByb3RvY29sLmxlbmd0aCksIHBjID0gITApIDogdWEoIiIsIC0xKSk7CiAgICAgICAgICAgIG9jIHx8IHVhKCIiLCAtMSk7CiAgICAgICAgICAgIHBjIHx8IHNldFRpbWVvdXQoVmMsIDNFMyk7CiAgICAgICAgICAgIGlmICghYy5hZ2FyaW9Ob0luaXQpIHsKICAgICAgICAgICAgICAgIHZhciBqYiA9IGMubG9jYXRpb24ucHJvdG9jb2wsCiAgICAgICAgICAgICAgICAgICAgbWIgPSAiaHR0cHM6IiA9PSBqYjsKICAgICAgICAgICAgICAgIEQubWFzdGVyICYmIChFbnZDb25maWcubWFzdGVyX3VybCA9IEQubWFzdGVyKTsKICAgICAgICAgICAgICAgIHZhciBDYSA9IGpiICsgIi8vIiArIEVudkNvbmZpZy5tYXN0ZXJfdXJsICsgIi8iLAogICAgICAgICAgICAgICAgICAgICRhID0gYy5uYXZpZ2F0b3IudXNlckFnZW50OwogICAgICAgICAgICAgICAgaWYgKC0xICE9ICRhLmluZGV4T2YoIkFuZHJvaWQiKSkgYy5nYSAmJiBjLmdhKCJzZW5kIiwgImV2ZW50IiwgIk1vYmlsZVJlZGlyZWN0IiwgIlBsYXlTdG9yZSIpLCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjLmxvY2F0aW9uLmhyZWYgPSAiaHR0cHM6Ly9wbGF5Lmdvb2dsZS5jb20vc3RvcmUvYXBwcy9kZXRhaWxzP2lkPWNvbS5taW5pY2xpcC5hZ2FyLmlvIgogICAgICAgICAgICAgICAgfSwgMUUzKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKC0xICE9ICRhLmluZGV4T2YoImlQaG9uZSIpIHx8IC0xICE9ICRhLmluZGV4T2YoImlQYWQiKSB8fCAtMSAhPSAkYS5pbmRleE9mKCJpUG9kIikpIGMuZ2EgJiYgYy5nYSgic2VuZCIsICJldmVudCIsICJNb2JpbGVSZWRpcmVjdCIsICJBcHBTdG9yZSIpLCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjLmxvY2F0aW9uLmhyZWYgPSAiaHR0cHM6Ly9pdHVuZXMuYXBwbGUuY29tL2FwcC9hZ2FyLmlvL2lkOTk1OTk5NzAzP210PTgmYXQ9MWwzdmFqcCIKICAgICAgICAgICAgICAgIH0sIDFFMyk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IHt9OwogICAgICAgICAgICAgICAgICAgIGMuYWdhckFwcCA9IG07CiAgICAgICAgICAgICAgICAgICAgdmFyIHliLCBmLCBPLCByLCB0LCBpYSA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHcgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICB5ID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgeiA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIEUgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgcSA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBLID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgIEEgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgYmEgPSBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgQyA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBZID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgWiA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHphID0gLTEsCiAgICAgICAgICAgICAgICAgICAgICAgIEFhID0gLTEsCiAgICAgICAgICAgICAgICAgICAgICAgIEpjID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgeCA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGJjID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgTiA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIE1hID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgTmEgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBPYSA9IDFFNCwKICAgICAgICAgICAgICAgICAgICAgICAgUGEgPSAxRTQsCiAgICAgICAgICAgICAgICAgICAgICAgIGwgPSAxLAogICAgICAgICAgICAgICAgICAgICAgICBHID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgYWIgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgZmEgPSAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgdGEgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgc2IgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgVCA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGVhID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIGJiID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhID0geSA9IH5+KChNYSArIE9hKSAvIDIpLAogICAgICAgICAgICAgICAgICAgICAgICBxYSA9IHogPSB+figoTmEgKyBQYSkgLyAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgcmEgPSAxLAogICAgICAgICAgICAgICAgICAgICAgICBsYSA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBJID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZ2IgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgcGIgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgbmIgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBvYiA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIEthID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgTGEgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBNYyA9IFsiIzMzMzMzMyIsICIjRkYzMzMzIiwgIiMzM0ZGMzMiLCAiIzMzMzNGRiJdLAogICAgICAgICAgICAgICAgICAgICAgICB6YiA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICBuYSA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICBGYSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIFAgPSAxLAogICAgICAgICAgICAgICAgICAgICAgICBCID0gMSwKICAgICAgICAgICAgICAgICAgICAgICAgamEgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAga2IgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBjYyA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICByYiA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHFiID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIEogPSBuZXcgSW1hZ2U7CiAgICAgICAgICAgICAgICAgICAgSi5zcmMgPSAiL2ltZy9iYWNrZ3JvdW5kLnBuZyI7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRjID0gIm9udG91Y2hzdGFydCIgaW4gYyAmJiAvQW5kcm9pZHx3ZWJPU3xpUGhvbmV8aVBhZHxpUG9kfEJsYWNrQmVycnl8SUVNb2JpbGV8T3BlcmEgTWluaS9pLnRlc3QoYy5uYXZpZ2F0b3IudXNlckFnZW50KSwKICAgICAgICAgICAgICAgICAgICAgICAgQWIgPSBuZXcgSW1hZ2U7CiAgICAgICAgICAgICAgICAgICAgQWIuc3JjID0gIi9pbWcvc3BsaXQucG5nIjsKICAgICAgICAgICAgICAgICAgICB2YXIgdmEgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgd2EgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgeGEgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgY2IgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgRmIsIEdiOwogICAgICAgICAgICAgICAgICAgICJnYW1lcGFkIiBpbiBEICYmIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2IgJiYgKFkgPSBkYi5oYShZLCBGYiksIFogPSBkYi5oYShaLCBHYikpCiAgICAgICAgICAgICAgICAgICAgfSwgMjUpOwogICAgICAgICAgICAgICAgICAgIGMuZ2FtZXBhZEF4aXNVcGRhdGUgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IC4xID4gYiAqIGI7CiAgICAgICAgICAgICAgICAgICAgICAgIDAgPT0gYSAmJiAoZCA/IEZiID0gciAvIDIgOiAoRmIgPSAoYiArIDEpIC8gMiAqIHIsIGNiID0gITApKTsKICAgICAgICAgICAgICAgICAgICAgICAgMSA9PSBhICYmIChkID8gR2IgPSB0IC8gMiA6IChHYiA9IChiICsgMSkgLyAyICogdCwgY2IgPSAhMCkpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLmFnYXJpb0luaXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdiID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgIHhjKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdjKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIG0uY29yZS5pbml0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT0gYy5sb2NhbFN0b3JhZ2Uuc2V0dGluZ3MgJiYgKHYgPSBKU09OLnBhcnNlKGMubG9jYWxTdG9yYWdlLnNldHRpbmdzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJiID0gdi5zaG93TWFzcywgZWEgPSB2LmJsYWNrVGhlbWUsIGZhID0gdi5uYW1lc0VuYWJsZWQsIHRhID0gdi5ub0NvbG9ycywgWmEgPSB2LnN0YXRzRW5hYmxlZCwgYWIgPSB2LnNraW5zRW5hYmxlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNzaG93TWFzcyIpLnByb3AoImNoZWNrZWQiLCB2LnNob3dNYXNzKTsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiI25vU2tpbnMiKS5wcm9wKCJjaGVja2VkIiwgIXYuc2tpbnNFbmFibGVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiI3NraXBTdGF0cyIpLnByb3AoImNoZWNrZWQiLCAhdi5zdGF0c0VuYWJsZWQpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjbm9Db2xvcnMiKS5wcm9wKCJjaGVja2VkIiwgdi5ub0NvbG9ycyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNub05hbWVzIikucHJvcCgiY2hlY2tlZCIsICF2Lm5hbWVzRW5hYmxlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNkYXJrVGhlbWUiKS5wcm9wKCJjaGVja2VkIiwgdi5ibGFja1RoZW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgTGIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoTGIsIDE4RTQpOwogICAgICAgICAgICAgICAgICAgICAgICBPID0geWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2FudmFzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT0gTyAmJiAoZiA9IE8uZ2V0Q29udGV4dCgiMmQiKSwgTy5vbm1vdXNlZG93biA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGEuY2xpZW50WCAtICg1ICsgciAvIDUgLyAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGEuY2xpZW50WSAtICg1ICsgciAvIDUgLyAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5zcXJ0KGIgKiBiICsgZCAqIGQpIDw9IHIgLyA1IC8gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlYigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBZID0gMSAqIGEuY2xpZW50WDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFogPSAxICogYS5jbGllbnRZOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNhKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSwgTy5vbm1vdXNlbW92ZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYiA9ICExOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgWSA9IDEgKiBhLmNsaWVudFg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBaID0gMSAqIGEuY2xpZW50WTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZiKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSwgTy5vbm1vdXNldXAgPSBmdW5jdGlvbiAoKSB7IH0sIC9maXJlZm94L2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSA/IGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTU1vdXNlU2Nyb2xsIiwgS2IsICExKSA6IGRvY3VtZW50LmJvZHkub25tb3VzZXdoZWVsID0gS2IsIGMub25ibHVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgWCgxOSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4YSA9IHdhID0gdmEgPSAhMQogICAgICAgICAgICAgICAgICAgICAgICB9LCBjLm9ucmVzaXplID0gWGIsIGMucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHFjKSwgc2V0SW50ZXJ2YWwoU2EsIDQwKSwgRyAmJiBlKCIjcmVnaW9uIikudmFsKEcpLCBOYigpLCBEYShlKCIjcmVnaW9uIikudmFsKCkpLCAwID09IGtiICYmIEcgJiYgUSgpLCB5YSgwKSwgWGIoKSwgYy5sb2NhdGlvbi5oYXNoICYmIDYgPD0gYy5sb2NhdGlvbi5oYXNoLmxlbmd0aCAmJiBqYyhjLmxvY2F0aW9uLmhhc2gpKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdmFyIEJhID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBjLnNldE5pY2sgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBjLmdhICYmIGMuZ2EoInNlbmQiLCAiZXZlbnQiLCAiTmljayIsIGEudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIE1iKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIE4gPSBhOwogICAgICAgICAgICAgICAgICAgICAgICBTYigpOwogICAgICAgICAgICAgICAgICAgICAgICBUID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgdi5za2luc0VuYWJsZWQgPSBhYjsKICAgICAgICAgICAgICAgICAgICAgICAgdi5uYW1lc0VuYWJsZWQgPSBmYTsKICAgICAgICAgICAgICAgICAgICAgICAgdi5ub0NvbG9ycyA9IHRhOwogICAgICAgICAgICAgICAgICAgICAgICB2LmJsYWNrVGhlbWUgPSBlYTsKICAgICAgICAgICAgICAgICAgICAgICAgdi5zaG93TWFzcyA9IGJiOwogICAgICAgICAgICAgICAgICAgICAgICB2LnN0YXRzRW5hYmxlZCA9IFphOwogICAgICAgICAgICAgICAgICAgICAgICBjLmxvY2FsU3RvcmFnZS5zZXR0aW5ncyA9IEpTT04uc3RyaW5naWZ5KHYpOwogICAgICAgICAgICAgICAgICAgICAgICBJYigpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLnNldFNraW5zID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWIgPSBhCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLnNldE5hbWVzID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmEgPSBhCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLnNldERhcmtUaGVtZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVhID0gYQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5zZXRDb2xvcnMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICB0YSA9IGEKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGMuc2V0U2hvd01hc3MgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBiYiA9IGEKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGMuc3BlY3RhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIE4gPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBJYigpOwogICAgICAgICAgICAgICAgICAgICAgICBYKDEpOwogICAgICAgICAgICAgICAgICAgICAgICBNYigpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLnNldFJlZ2lvbiA9IERhOwogICAgICAgICAgICAgICAgICAgIHZhciBoYiA9ICEwOwogICAgICAgICAgICAgICAgICAgIGMuc2V0R2FtZU1vZGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBhICE9IGxhICYmICgiOnBhcnR5IiA9PSBsYSAmJiBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLXBhcnR5LXN0YXRlIiwgIjAiKSwga2EoYSksICI6cGFydHkiICE9IGEgJiYgUSgpKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5zZXRBY2lkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgemIgPSBhCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB2YXIgWGMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBza2lwRHJhdzogITAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlZGljdGlvbk1vZGlmaWVyOiAxLjEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGEuaW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uYWNjb3VudC5pbml0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmdvb2dsZS52YSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5mYS5pbml0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZCA9ICJkZWJ1ZyIgaW4gYy5xdWVyeVN0cmluZykgJiYgbS5kZWJ1Zy5zaG93RGVidWcoKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLmJpbmQgPSBmdW5jdGlvbiAoYSwgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZShiKS5iaW5kKGEsIGQpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGEudW5iaW5kID0gZnVuY3Rpb24gKGEsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoYikudW5iaW5kKGEsIGQpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGEudHJpZ2dlciA9IGZ1bmN0aW9uIChhLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKGIpLnRyaWdnZXIoYSwgZCkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5fX2RlZmluZUdldHRlcl9fKCJkZWJ1ZyIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBhLl9fZGVmaW5lU2V0dGVyX18oImRlYnVnIiwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkID0gYQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5fX2RlZmluZUdldHRlcl9fKCJwcm94eSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjLk1DCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBhLl9fZGVmaW5lR2V0dGVyX18oImNvbmZpZyIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgICAgIH0oe30pOwogICAgICAgICAgICAgICAgICAgIG0uY29yZSA9IFhjOwogICAgICAgICAgICAgICAgICAgIG0uY2FjaGUgPSB7fTsKICAgICAgICAgICAgICAgICAgICB2YXIgWWMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBiKGEsIGIsIGQsIGMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBhICsgIkNhbnZhcyI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGUoIjxjYW52YXM+IiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuYXBwZW5kKGcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IG5ldyBTbW9vdGhpZUNoYXJ0KGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gMDsgZyA8IGIubGVuZ3RoOyBnKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IGJbZ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBfLmV4dGVuZChoLCBjW2ddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmFkZFRpbWVTZXJpZXModSwgZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuc3RyZWFtVG8oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYSksIDApCiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGQoYSwgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAga1thXSA9IGMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIoYSwgW2tbYV1dLCBkLCBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVN0eWxlOiAicmdiYSgwLCAyNTUsIDAsIDEpIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsU3R5bGU6ICJyZ2JhKDAsIDI1NSwgMCwgMC4yKSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZVdpZHRoOiAyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSkKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVGltZVNlcmllcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2E6ICExCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLCBmID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVN0eWxlOiAicmdiYSgwLCAyNTUsIDAsIDEpIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsU3R5bGU6ICJyZ2JhKDAsIDI1NSwgMCwgMC4yKSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZVdpZHRoOiAyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLnNob3dEZWJ1ZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcgfHwgKHAgPSBlKCIjZGVidWctb3ZlcmxheSIpLCBkKCJuZXR3b3JrVXBkYXRlIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJuZXR3b3JrIHVwZGF0ZXMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pblZhbHVlOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFZhbHVlOiAxMjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBkKCJmcHMiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogImZwcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluVmFsdWU6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4VmFsdWU6IDEyMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGsucnR0U0RldiA9IGMoKSwgay5ydHRNZWFuID0gYygpLCBiKCJydHRNZWFuIiwgW2sucnR0U0Rldiwgay5ydHRNZWFuXSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJydHQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pblZhbHVlOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFZhbHVlOiAxMjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlU3R5bGU6ICJyZ2JhKDI1NSwgMCwgMCwgMSkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxTdHlsZTogInJnYmEoMCwgMjU1LCAwLCAwLjIpIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lV2lkdGg6IDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VTdHlsZTogInJnYmEoMCwgMjU1LCAwLCAxKSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbFN0eWxlOiAicmdiYSgwLCAyNTUsIDAsIDApIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lV2lkdGg6IDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dKSwgZyA9ICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uY29yZS5kZWJ1ZyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5zaG93KCkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5oaWRlRGVidWcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uY29yZS5kZWJ1ZyA9ICExCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGEudXBkYXRlQ2hhcnQgPSBmdW5jdGlvbiAoYSwgYiwgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyAmJiBhIGluIGsgJiYga1thXS5hcHBlbmQoYiwgZCkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5fX2RlZmluZUdldHRlcl9fKCJzaG93UHJlZGljdGlvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBhLl9fZGVmaW5lU2V0dGVyX18oInNob3dQcmVkaWN0aW9uIiwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmID0gYQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICB9KHt9KTsKICAgICAgICAgICAgICAgICAgICBtLmRlYnVnID0gWWM7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1hID0gewogICAgICAgICAgICAgICAgICAgICAgICBBRjogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgQVg6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBBTDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIERaOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQVM6ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBBRDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEFPOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQUk6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgQUc6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgQVI6ICJCUi1CcmF6aWwiLAogICAgICAgICAgICAgICAgICAgICAgICBBTTogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgQVc6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgQVU6ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBBVDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEFaOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBCUzogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBCSDogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgQkQ6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJCOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJZOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQkU6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBCWjogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBCSjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJNOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJUOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBCTzogIkJSLUJyYXppbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJROiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJBOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQlc6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBCUjogIkJSLUJyYXppbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIElPOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBWRzogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBCTjogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgQkc6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBCRjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJJOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgS0g6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIENNOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ0E6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ1Y6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBLWTogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBDRjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFREOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ0w6ICJCUi1CcmF6aWwiLAogICAgICAgICAgICAgICAgICAgICAgICBDTjogIkNOLUNoaW5hIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ1g6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIENDOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBDTzogIkJSLUJyYXppbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIEtNOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ0Q6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBDRzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIENLOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ1I6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ0k6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBIUjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIENVOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIENXOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIENZOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBDWjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIERLOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgREo6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBETTogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBETzogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBFQzogIkJSLUJyYXppbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIEVHOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgU1Y6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgR1E6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBFUjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEVFOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgRVQ6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBGTzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEZLOiAiQlItQnJhemlsIiwKICAgICAgICAgICAgICAgICAgICAgICAgRko6ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBGSTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEZSOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgR0Y6ICJCUi1CcmF6aWwiLAogICAgICAgICAgICAgICAgICAgICAgICBQRjogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdBOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgR006ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBHRTogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgREU6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBHSDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdJOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgR1I6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBHTDogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBHRDogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBHUDogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBHVTogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdUOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdHOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgR046ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBHVzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdZOiAiQlItQnJhemlsIiwKICAgICAgICAgICAgICAgICAgICAgICAgSFQ6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgVkE6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBITjogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBISzogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgSFU6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBJUzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIElOOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBJRDogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgSVI6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIElROiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBJRTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIElNOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgSUw6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIElUOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgSk06ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgSlA6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIEpFOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgSk86ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIEtaOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBLRTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEtJOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgS1A6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIEtSOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBLVzogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgS0c6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIExBOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBMVjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIExCOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBMUzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIExSOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTFk6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBMSTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIExUOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTFU6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBNTzogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgTUs6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBNRzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1XOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTVk6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1WOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBNTDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1UOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTUg6ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBNUTogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBNUjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1VOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgWVQ6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBNWDogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBGTTogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1EOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTUM6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBNTjogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgTUU6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBNUzogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBNQTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1aOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTU06ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIE5BOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTlI6ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBOUDogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgTkw6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBOQzogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIE5aOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgTkk6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgTkU6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBORzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE5VOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgTkY6ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBNUDogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIE5POiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgT006ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBLOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBQVzogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBTOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBQQTogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBQRzogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBZOiAiQlItQnJhemlsIiwKICAgICAgICAgICAgICAgICAgICAgICAgUEU6ICJCUi1CcmF6aWwiLAogICAgICAgICAgICAgICAgICAgICAgICBQSDogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgUE46ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBQTDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBUOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgUFI6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgUUE6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFJFOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgUk86ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBSVTogIlJVLVJ1c3NpYSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFJXOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQkw6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgU0g6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBLTjogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBMQzogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBNRjogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBQTTogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBWQzogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBXUzogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNNOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgU1Q6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBTQTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNOOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgUlM6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBTQzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNMOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgU0c6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNYOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNLOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgU0k6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBTQjogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNPOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgWkE6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBTUzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEVTOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTEs6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNEOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgU1I6ICJCUi1CcmF6aWwiLAogICAgICAgICAgICAgICAgICAgICAgICBTSjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNaOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgU0U6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBDSDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNZOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgVFc6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRKOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBUWjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRIOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBUTDogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgVEc6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBUSzogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRPOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgVFQ6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgVE46ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBUUjogIlRLLVR1cmtleSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRNOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBUQzogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBUVjogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFVHOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgVUE6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBBRTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdCOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgVVM6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgVU06ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBWSTogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBVWTogIkJSLUJyYXppbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFVaOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBWVTogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFZFOiAiQlItQnJhemlsIiwKICAgICAgICAgICAgICAgICAgICAgICAgVk46ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFdGOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgRUg6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBZRTogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgWk06ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBaVzogIkVVLUxvbmRvbiIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBvYSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIEdhID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgUyA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIFViOwogICAgICAgICAgICAgICAgICAgIGMuY29ubmVjdCA9IGxiOwogICAgICAgICAgICAgICAgICAgIHZhciBJYSA9IDUwMCwKICAgICAgICAgICAgICAgICAgICAgICAgQ2MgPSAuODc1LAogICAgICAgICAgICAgICAgICAgICAgICBFYyA9IC43NSwKICAgICAgICAgICAgICAgICAgICAgICAgRmMgPSAuMjUsCiAgICAgICAgICAgICAgICAgICAgICAgIERjID0gLjEyNSwKICAgICAgICAgICAgICAgICAgICAgICAgVmIgPSAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgV2IgPSAtMTsKICAgICAgICAgICAgICAgICAgICBjLnNlbmRNaXRvc2lzID0gZWI7CiAgICAgICAgICAgICAgICAgICAgYy5zZW5kRWplY3QgPSBKYjsKICAgICAgICAgICAgICAgICAgICBtLm5ldHdvcmtpbmcgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBhLmxvZ2luUmVhbG0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBHRzogImdvb2dsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGQjogImZhY2Vib29rIgogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLnNlbmRNZXNzYWdlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBhLmJ5dGVWaWV3OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IFUoMSArIGEubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5zZXRVaW50OCgwLCAxMDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IGQubGVuZ3RoOyArK2MpIGEuc2V0VWludDgoMSArIGMsIGRbY10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHh0ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgZC5sZW5ndGg7ICsrYykgdHh0ICs9ICdbJyArIGMgKyAnLScgKyBkW2NdICsgJ10nICsgU3RyaW5nLmZyb21DaGFyQ29kZShkW2NdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnUEFDS0VUIDEwMicsZC5sZW5ndGgsZC5sZW5ndGgtMzAsZCx0eHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3NlbmRUb2tlbihkKTsvL0FHQVJCT1RPVkgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVihhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICB9KHt9KTsKICAgICAgICAgICAgICAgICAgICB2YXIgSCA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIE0gPSAxLAogICAgICAgICAgICAgICAgICAgICAgICBVYSA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHJjID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgcWMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IERhdGUubm93KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IDFFMyAvIDYwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnJlcXVlc3RBbmltYXRpb25GcmFtZShxYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gZCAtIGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgPiBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBkIC0gZSAlIGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIWRhKCkgfHwgMjQwID4gZyAtIEZhIHx8ICFtLmNvcmUuY29uZmlnLnNraXBEcmF3ID8gWWIoKSA6IGNvbnNvbGUud2FybigiU2tpcHBpbmcgZHJhdyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBaYygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYyA9IDFFMyAvIGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uZGVidWcudXBkYXRlQ2hhcnQoImZwcyIsIGQsIHJjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSgpLAogICAgICAgICAgICAgICAgICAgICAgICBoYSA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBPYiA9ICJwb2xhbmQ7dXNhO2NoaW5hO3J1c3NpYTtjYW5hZGE7YXVzdHJhbGlhO3NwYWluO2JyYXppbDtnZXJtYW55O3VrcmFpbmU7ZnJhbmNlO3N3ZWRlbjtjaGFwbGluO25vcnRoIGtvcmVhO3NvdXRoIGtvcmVhO2phcGFuO3VuaXRlZCBraW5nZG9tO2VhcnRoO2dyZWVjZTtsYXR2aWE7bGl0aHVhbmlhO2VzdG9uaWE7ZmlubGFuZDtub3J3YXk7Y2lhO21hbGRpdmFzO2F1c3RyaWE7bmlnZXJpYTtyZWRkaXQ7eWFyYW5haWthO2NvbmZlZGVyYXRlOzlnYWc7aW5kaWFuYTs0Y2hhbjtpdGFseTtidWxnYXJpYTt0dW1ibHI7MmNoLmhrO2hvbmcga29uZztwb3J0dWdhbDtqYW1haWNhO2dlcm1hbiBlbXBpcmU7bWV4aWNvO3NhbmlrO3N3aXR6ZXJsYW5kO2Nyb2F0aWE7Y2hpbGU7aW5kb25lc2lhO2JhbmdsYWRlc2g7dGhhaWxhbmQ7aXJhbjtpcmFxO3BlcnU7bW9vbjtib3Rzd2FuYTtib3NuaWE7bmV0aGVybGFuZHM7ZXVyb3BlYW4gdW5pb247dGFpd2FuO3Bha2lzdGFuO2h1bmdhcnk7c2F0YW5pc3Q7cWluZyBkeW5hc3R5O21hdHJpYXJjaHk7cGF0cmlhcmNoeTtmZW1pbmlzbTtpcmVsYW5kO3RleGFzO2ZhY2VwdW5jaDtwcm9kb3RhO2NhbWJvZGlhO3N0ZWFtO3BpY2NvbG87ZWE7aW5kaWE7a2M7ZGVubWFyaztxdWViZWM7YXl5IGxtYW87c2VhbGFuZDtiYWl0O3RzYXJpc3QgcnVzc2lhO29yaWdpbjt2aW5lc2F1Y2U7c3RhbGluO2JlbGdpdW07bHV4ZW1ib3VyZztzdHVzc3k7cHJ1c3NpYTs4Y2g7YXJnZW50aW5hO3Njb3RsYW5kO3Npcjtyb21hbmlhO3dvamFrO2RvZ2U7bmFzYTtieXphbnRpdW07aW1wZXJpYWwgamFwYW47ZnJlbmNoIGtpbmdkb207c29tYWxpYTt0dXJrZXk7bWFycztwb2tlcmZhY2U7ODtpcnM7cmVjZWl0YSBmZWRlcmFsO2ZhY2Vib29rO3B1dGluO21lcmtlbDt0c2lwcmFzO29iYW1hO2tpbSBqb25nLXVuO2RpbG1hO2hvbGxhbmRlO2Jlcmx1c2Nvbmk7Y2FtZXJvbjtjbGludG9uO2hpbGxhcnk7dmVuZXp1ZWxhO2JsYXR0ZXI7Y2hhdmV6O2N1YmE7ZmlkZWw7bWVya2VsO3BhbGluO3F1ZWVuO2JvcmlzO2J1c2g7dHJ1bXAiLnNwbGl0KCI7IiksCiAgICAgICAgICAgICAgICAgICAgICAgICRjID0gIjg7bmFzYTtwdXRpbjttZXJrZWw7dHNpcHJhcztvYmFtYTtraW0gam9uZy11bjtkaWxtYTtob2xsYW5kZTtiZXJsdXNjb25pO2NhbWVyb247Y2xpbnRvbjtoaWxsYXJ5O2JsYXR0ZXI7Y2hhdmV6O2ZpZGVsO21lcmtlbDtwYWxpbjtxdWVlbjtib3JpcztidXNoO3RydW1wIi5zcGxpdCgiOyIpLAogICAgICAgICAgICAgICAgICAgICAgICBzYSA9IHt9OwogICAgICAgICAgICAgICAgICAgIEJiLnByb3RvdHlwZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgZjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgYjogMAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdmFyIFRhID0gLTEsCiAgICAgICAgICAgICAgICAgICAgICAgICRiID0gITE7CiAgICAgICAgICAgICAgICAgICAgY2EucHJvdG90eXBlID0gewogICAgICAgICAgICAgICAgICAgICAgICBpZDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgYTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgaTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgUzogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgczogMCwKICAgICAgICAgICAgICAgICAgICAgICAgdTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgbzogMCwKICAgICAgICAgICAgICAgICAgICAgICAgamE6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGthOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBnOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBNOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBOOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBKOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBLOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBlYTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgVTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgcmE6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIEc6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBjOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgaDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIFY6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBkYTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgQzogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgaWE6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHVhOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgSTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCBBLmxlbmd0aDsgYSsrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBW2FdID09IHRoaXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQS5zcGxpY2UoYSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIEtbdGhpcy5pZF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gcS5pbmRleE9mKHRoaXMpOyAtMSAhPSBhICYmIChzYiA9ICEwLCBxLnNwbGljZShhLCAxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gRS5pbmRleE9mKHRoaXMuaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BR0FSQk9UT1ZICiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLTEgIT0gYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUuc3BsaWNlKGEsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZU15QmFsbCh0aGlzLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQUdBUkJPVE9WSAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5HID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwIDwgdGhpcy5kYSAmJiBiYS5wdXNoKHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG06IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heCh+figuMyAqIHRoaXMuc2l6ZSksIDI0KQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBBOiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubmFtZSA9IGEpIG51bGwgPT0gdGhpcy5pID8gdGhpcy5pID0gbmV3IFZhKHRoaXMubSgpLCAiI0ZGRkZGRiIsICEwLCAiIzAwMDAwMCIpIDogdGhpcy5pLlAodGhpcy5tKCkpLCB0aGlzLmkuQih0aGlzLm5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGJhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBhID0gdGhpcy5IKCkgOyB0aGlzLmEubGVuZ3RoID4gYTspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IH5+KE1hdGgucmFuZG9tKCkgKiB0aGlzLmEubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmEuc3BsaWNlKGIsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDAgPT0gdGhpcy5hLmxlbmd0aCAmJiAwIDwgYSAmJiB0aGlzLmEucHVzaChuZXcgQmIodGhpcywgdGhpcy54LCB0aGlzLnksIHRoaXMuc2l6ZSwgTWF0aC5yYW5kb20oKSAtIC41KSkgOyB0aGlzLmEubGVuZ3RoIDwgYTspIGIgPSB+fihNYXRoLnJhbmRvbSgpICogdGhpcy5hLmxlbmd0aCksIGIgPSB0aGlzLmFbYl0sIHRoaXMuYS5wdXNoKG5ldyBCYih0aGlzLCBiLngsIGIueSwgYi5mLCBiLmIpKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBIOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IDEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMjAgPiB0aGlzLnNpemUgJiYgKGEgPSAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYyAmJiAoYSA9IDMwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5zaXplOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jIHx8IChiICo9IGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiAqPSBNOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIH5+TWF0aC5tYXgoYiwgYSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgQmE6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmEoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGEgPSB0aGlzLmEsIGIgPSBhLmxlbmd0aCwgZCA9IHRoaXMsIGMgPSB0aGlzLmMgPyAwIDogKHRoaXMuaWQgLyAxRTMgKyB4IC8gMUU0KSAlICgyICogTWF0aC5QSSksIGUgPSAwLCBwID0gMDsgcCA8IGI7ICsrcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gYVsocCAtIDEgKyBiKSAlIGJdLmIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhWyhwICsgMSkgJSBiXS5iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gYVtwXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLmIgKz0gKE1hdGgucmFuZG9tKCkgLSAuNSkgKiAodGhpcy5oID8gMyA6IDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguYiAqPSAuNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMCA8IGguYiAmJiAoaC5iID0gMTApOyAtMTAgPiBoLmIgJiYgKGguYiA9IC0xMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5iID0gKGYgKyBrICsgOCAqIGguYikgLyAxMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGguZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGFbKHAgLSAxICsgYikgJSBiXS5mLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gYVsocCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxKSAlIGJdLmY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDE1IDwgdGhpcy5zaXplICYmIG51bGwgIT0gaWEgJiYgMjAgPCB0aGlzLnNpemUgKiBsICYmIDAgPCB0aGlzLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBRYSA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGgueCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBoLnk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlhLkVhKG0gLSA1LCBxIC0gNSwgMTAsIDEwLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS4kICE9IGQgJiYgMjUgPiAobSAtIGEueCkgKiAobSAtIGEueCkgKyAocSAtIGEueSkgKiAocSAtIGEueSkgJiYgKFFhID0gITApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhUWEgJiYgKGgueCA8IE1hIHx8IGgueSA8IE5hIHx8IGgueCA+IE9hIHx8IGgueSA+IFBhKSAmJiAoUWEgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFhICYmICgwIDwgaC5iICYmIChoLmIgPSAwKSwgLS1oLmIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gKz0gaC5iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPiBuICYmIChuID0gMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHRoaXMuaCA/ICgxOSAqIG4gKyB0aGlzLnNpemUpIC8gMjAgOiAoMTIgKiBuICsgdGhpcy5zaXplKSAvIDEzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguZiA9IChmICsgayArIDggKiBuKSAvIDEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSAyICogTWF0aC5QSSAvIGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGguZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmMgJiYgMCA9PSBwICUgMiAmJiAoayArPSA1KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLnggPSB0aGlzLnggKyBNYXRoLmNvcyhmICogcCArIGMpICogazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLnkgPSB0aGlzLnkgKyBNYXRoLnNpbihmICogcCArIGMpICogazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gTWF0aC5tYXgoZSwgaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaWEgPSBlCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG5hOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5NID0gYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuTiA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLkogPSBhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5LID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qYSA9IGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmthID0gYgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBUOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA+PSB0aGlzLmlkKSByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gZGIucGEoKHggLSB0aGlzLlUpIC8gMTIwLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLkcgJiYgMSA8PSBhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBiYS5pbmRleE9mKHRoaXMpOyAtMSAhPSBiICYmIGJhLnNwbGljZShiLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy54ID0gYSAqICh0aGlzLmphIC0gdGhpcy5zKSArIHRoaXMuczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueSA9IGEgKiAodGhpcy5rYSAtIHRoaXMudSkgKyB0aGlzLnU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNpemUgPSBhICogKHRoaXMuZyAtIHRoaXMubykgKyB0aGlzLm87CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuMDEgPiBNYXRoLmFicyh0aGlzLnNpemUgLSB0aGlzLmcpICYmICh0aGlzLnNpemUgPSB0aGlzLmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgUjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgPj0gdGhpcy5pZCA/ICEwIDogdGhpcy54ICsgdGhpcy5zaXplICsgNDAgPCB5IC0gciAvIDIgLyBsIHx8IHRoaXMueSArIHRoaXMuc2l6ZSArIDQwIDwgeiAtIHQgLyAyIC8gbCB8fCB0aGlzLnggLSB0aGlzLnNpemUgLSA0MCA+IHkgKyByIC8gMiAvIGwgfHwgdGhpcy55IC0gdGhpcy5zaXplIC0gNDAgPiB6ICsgdCAvIDIgLyBsID8gITEgOiAhMAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBxYTogZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5IKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLm1vdmVUbyh0aGlzLmFbMF0ueCwgdGhpcy5hWzBdLnkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9IDE7IGQgPD0gYjsgKytkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBkICUgYjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmxpbmVUbyh0aGlzLmFbY10ueCwgdGhpcy5hW2NdLnkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNsb3NlUGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5zdHJva2UoKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB3OiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuUigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyt0aGlzLmRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gMCA8IHRoaXMuaWQgJiYgIXRoaXMuYyAmJiAhdGhpcy5oICYmIC40ID4gbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA1ID4gdGhpcy5IKCkgJiYgMCA8IHRoaXMuaWQgJiYgKGIgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuViAmJiAhYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCB0aGlzLmEubGVuZ3RoOyBkKyspIHRoaXMuYVtkXS5mID0gdGhpcy5zaXplOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuViA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yYSA9IHg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMuVCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuRyAmJiAoYS5nbG9iYWxBbHBoYSAqPSAxIC0gZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5saW5lV2lkdGggPSAxMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmxpbmVDYXAgPSAicm91bmQiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEubGluZUpvaW4gPSB0aGlzLmMgPyAibWl0ZXIiIDogInJvdW5kIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMubmFtZS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHRoaXMuY29sb3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmggfHwgIWFiIHx8IHFiIHx8ICgtMSAhPSBPYi5pbmRleE9mKGUpID8gKGhhLmhhc093blByb3BlcnR5KGUpIHx8IChoYVtlXSA9IG5ldyBJbWFnZSwgaGFbZV0uc3JjID0gYy5BU1NFVFNfUk9PVCArICJza2lucy8iICsgZSArICIucG5nIiksIGcgPSAwICE9IGhhW2VdLndpZHRoICYmIGhhW2VdLmNvbXBsZXRlID8gaGFbZV0gOiBudWxsKSA6IGcgPSBudWxsLCBudWxsICE9IGcgPyAtMSAhPSAkYy5pbmRleE9mKGUpICYmIChkID0gITApIDogKHRoaXMuSSAmJiAiJXN0YXJiYWxsIiA9PSB0aGlzLkMgJiYgInNoZW5yb24iID09IGUgJiYgNyA8PSBxLmxlbmd0aCAmJiAoJGIgPSBkID0gITAsIHAgPSBlYygiJXN0YXJiYWxsMSIpKSwgZyA9IGVjKHRoaXMuQyksIG51bGwgIT0gZyAmJiAoaCA9ICEwLCBmID0gTmModGhpcy5DKSB8fCBmKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uY29yZS5kZWJ1ZyAmJiBtLmRlYnVnLnNob3dQcmVkaWN0aW9uICYmIHRoaXMuSSAmJiAoYS5zdHJva2VTdHlsZSA9ICIjMDAwMEZGIiwgYS5iZWdpblBhdGgoKSwgYS5hcmModGhpcy5NLCB0aGlzLk4sIHRoaXMuc2l6ZSArIDUsIDAsIDIgKiBNYXRoLlBJLCAhMSksIGEuY2xvc2VQYXRoKCksIGEuc3Ryb2tlKCksIGEuc3Ryb2tlU3R5bGUgPSAiIzAwRkYwMCIsIGEuYmVnaW5QYXRoKCksIGEuYXJjKHRoaXMuSiwgdGhpcy5LLCB0aGlzLnNpemUgKyA1LCAwLCAyICogTWF0aC5QSSwgITEpLCBhLmNsb3NlUGF0aCgpLCBhLnN0cm9rZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YSAmJiAhcWIgPyAoYS5maWxsU3R5bGUgPSAiI0ZGRkZGRiIsIGEuc3Ryb2tlU3R5bGUgPSAiI0FBQUFBQSIpIDogKGEuZmlsbFN0eWxlID0gZiwgYS5zdHJva2VTdHlsZSA9IGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPyAoYS5iZWdpblBhdGgoKSwgYS5hcmModGhpcy54LCB0aGlzLnksIHRoaXMuc2l6ZSArIDUsIDAsIDIgKiBNYXRoLlBJLCAhMSksIGEuY2xvc2VQYXRoKCkpIDogKHRoaXMuQmEoKSwgdGhpcy5xYShhKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCB8fCBhLmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9IGcgJiYgKHRoaXMubGEoYSwgZyksIG51bGwgIT0gcCAmJiB0aGlzLmxhKGEsIHAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGE6IE1hdGguc2luKC4wMTc0ICogVGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0YSB8fCAxNSA8IHRoaXMuc2l6ZSkgJiYgIWIgJiYgKGEuc3Ryb2tlU3R5bGUgPSAiIzAwMDAwMCIsIGEuZ2xvYmFsQWxwaGEgKj0gLjEsIGEuc3Ryb2tlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAtMSAhPSBxLmluZGV4T2YodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IH5+dGhpcy55OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgIT0gdGhpcy5pZCAmJiAoZmEgfHwgZSkgJiYgdGhpcy5uYW1lICYmIHRoaXMuaSAmJiAhZCAmJiAoZyA9IHRoaXMuaSwgZy5CKHRoaXMubmFtZSksIGcuUCh0aGlzLm0oKSksIGQgPSAwID49IHRoaXMuaWQgPyAxIDogTWF0aC5jZWlsKDEwICogbCkgLyAxMCwgZy5tYShkKSwgZyA9IGcuTygpLCBwID0gTWF0aC5jZWlsKGcud2lkdGggLyBkKSwgZiA9IE1hdGguY2VpbChnLmhlaWdodCAvIGQpLCBhLmRyYXdJbWFnZShnLCB+fnRoaXMueCAtIH5+KHAgLyAyKSwgYiAtIH5+KGYgLyAyKSwgcCwgZiksIGIgKz0gZy5oZWlnaHQgLyAyIC8gZCArIDQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPCB0aGlzLmlkICYmIGJiICYmIChlIHx8IDAgPT0gcS5sZW5ndGggJiYgKCF0aGlzLmMgfHwgdGhpcy5oKSAmJiAyMCA8IHRoaXMuc2l6ZSkgJiYgKG51bGwgPT0gdGhpcy5TICYmICh0aGlzLlMgPSBuZXcgVmEodGhpcy5tKCkgLyAyLCAiI0ZGRkZGRiIsICEwLCAiIzAwMDAwMCIpKSwgZSA9IHRoaXMuUywgZS5QKHRoaXMubSgpIC8gMiksIGUuQih+fih0aGlzLnNpemUgKiB0aGlzLnNpemUgLyAxMDApKSwgZCA9IE1hdGguY2VpbCgxMCAqIGwpIC8gMTAsIGUubWEoZCksIGcgPSBlLk8oKSwgcCA9IE1hdGguY2VpbChnLndpZHRoIC8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCksIGYgPSBNYXRoLmNlaWwoZy5oZWlnaHQgLyBkKSwgYS5kcmF3SW1hZ2UoZywgfn50aGlzLnggLSB+fihwIC8gMiksIGIgLSB+fihmIC8gMiksIHAsIGYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnJlc3RvcmUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBsYTogZnVuY3Rpb24gKGEsIGIsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuc2F2ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jbGlwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IE1hdGgubWF4KHRoaXMuc2l6ZSwgdGhpcy5pYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9IGQgJiYgbnVsbCAhPSBkLmFscGhhICYmIChhLmdsb2JhbEFscGhhID0gZC5hbHBoYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRyYXdJbWFnZShiLCB0aGlzLnggLSBjIC0gNSwgdGhpcy55IC0gYyAtIDUsIDIgKiBjICsgMTAsIDIgKiBjICsgMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5yZXN0b3JlKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdmFyIGRiID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA8IGIgPyBiIDogYSA+IGMgPyBjIDogYQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGEuaGEgPSBmdW5jdGlvbiAoYSwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYiguNSwgMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSArIGUgKiAoYyAtIGEpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGEucGEgPSBiOwogICAgICAgICAgICAgICAgICAgICAgICBhLmZpeGVkID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gTWF0aC5wb3coMTAsIGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIH5+KGEgKiBjKSAvIGMKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICB9KHt9KTsKICAgICAgICAgICAgICAgICAgICBjLk1hdGhzID0gZGI7CiAgICAgICAgICAgICAgICAgICAgdmFyIEhhID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYS5MID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBEYXRlLCBjID0gW2EuZ2V0TW9udGgoKSArIDEsIGEuZ2V0RGF0ZSgpLCBhLmdldEZ1bGxZZWFyKCldLCBhID0gW2EuZ2V0SG91cnMoKSwgYS5nZXRNaW51dGVzKCksIGEuZ2V0U2Vjb25kcygpXSwgZSA9IDE7IDMgPiBlOyBlKyspIDEwID4gYVtlXSAmJiAoYVtlXSA9ICIwIiArIGFbZV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJbIiArIGMuam9pbigiLyIpICsgIiAiICsgYS5qb2luKCI6IikgKyAiXSIKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICB9KHt9KTsKICAgICAgICAgICAgICAgICAgICBjLlV0aWxzID0gSGE7CiAgICAgICAgICAgICAgICAgICAgVmEucHJvdG90eXBlID0gewogICAgICAgICAgICAgICAgICAgICAgICBGOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgVzogIiMwMDAwMDAiLAogICAgICAgICAgICAgICAgICAgICAgICBZOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgWjogIiMwMDAwMDAiLAogICAgICAgICAgICAgICAgICAgICAgICB2OiAxNiwKICAgICAgICAgICAgICAgICAgICAgICAgajogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgWDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgbDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIEQ6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIFA6IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnYgIT0gYSAmJiAodGhpcy52ID0gYSwgdGhpcy5sID0gITApCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG1hOiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5EICE9IGEgJiYgKHRoaXMuRCA9IGEsIHRoaXMubCA9ICEwKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBCOiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSAhPSB0aGlzLkYgJiYgKHRoaXMuRiA9IGEsIHRoaXMubCA9ICEwKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBPOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsID09IHRoaXMuaiAmJiAodGhpcy5qID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIiksIHRoaXMuWCA9IHRoaXMuai5nZXRDb250ZXh0KCIyZCIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmwgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuaiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IHRoaXMuWCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuRiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHRoaXMuRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXMudiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGcgKyAicHggVWJ1bnR1IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmZvbnQgPSBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoID0gfn4oLjIgKiBnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLndpZHRoID0gKGIubWVhc3VyZVRleHQoYykud2lkdGggKyA2KSAqIGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5oZWlnaHQgPSAoZyArIGgpICogZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmZvbnQgPSBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc2NhbGUoZSwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5nbG9iYWxBbHBoYSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5saW5lV2lkdGggPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc3Ryb2tlU3R5bGUgPSB0aGlzLlo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5maWxsU3R5bGUgPSB0aGlzLlc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ZICYmIGIuc3Ryb2tlVGV4dChjLCAzLCBnIC0gaCAvIDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuZmlsbFRleHQoYywgMywgZyAtIGggLyAyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuagogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBEYXRlLm5vdyB8fCAoRGF0ZS5ub3cgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobmV3IERhdGUpLmdldFRpbWUoKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGEgPSBbIm1zIiwgIm1veiIsICJ3ZWJraXQiLCAibyJdLCBiID0gMDsgYiA8IGEubGVuZ3RoICYmICFjLnJlcXVlc3RBbmltYXRpb25GcmFtZTsgKytiKSBjLnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGNbYVtiXSArICJSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiXSwgYy5jYW5jZWxBbmltYXRpb25GcmFtZSA9IGNbYVtiXSArICJDYW5jZWxBbmltYXRpb25GcmFtZSJdIHx8IGNbYVtiXSArICJDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiXTsKICAgICAgICAgICAgICAgICAgICAgICAgYy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgKGMucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGEsIDFFMyAvIDYwKQogICAgICAgICAgICAgICAgICAgICAgICB9LCBjLmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChhKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHZjID0gewogICAgICAgICAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA8IGUgJiYgKGEgPSBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID4gZiAmJiAoYSA9IGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB+figoYSAtIGUpIC8gMzIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYyhhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA8IGcgJiYgKGEgPSBnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID4gaCAmJiAoYSA9IGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB+figoYSAtIGcpIC8gMzIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGEuemEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEuQWEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGEueGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGEueWEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IH5+KChmIC0gZSkgLyAzMikgKyAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSB+figoaCAtIGcpIC8gMzIpICsgMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gQXJyYXkoayAqIG0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YTogZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYihhLngpICsgYyhhLnkpICogazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCA9PSBuW2VdID8gbltlXSA9IGEgOiBBcnJheS5pc0FycmF5KG5bZV0pID8gbltlXS5wdXNoKGEpIDogbltlXSA9IFtuW2VdLCBhXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRWE6IGZ1bmN0aW9uIChhLCBlLCBnLCBmLCBoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwID0gYihhKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBjKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gYihhICsgZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBjKGUgKyBmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPiBwIHx8IHAgPj0gayB8fCAwID4gdSB8fCB1ID49IG0pIGRlYnVnZ2VyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgdSA8PSBlOyArK3UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGYgPSBwOyBmIDw9IGE7ICsrZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZyA9IG5bZiArIHUgKiBrXSwgbnVsbCAhPSBnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGwgPSAwOyBsIDwgZy5sZW5ndGg7IGwrKykgaChnW2xdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBoKGcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgVGIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IG5ldyBjYSgwLCAwLCAwLCAzMiwgIiNFRDFDMjQiLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi53aWR0aCA9IDMyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5oZWlnaHQgPSAzMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYi5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwIDwgcS5sZW5ndGggJiYgKGEuY29sb3IgPSBxWzBdLmNvbG9yLCBhLkEocVswXS5uYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5jbGVhclJlY3QoMCwgMCwgMzIsIDMyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnRyYW5zbGF0ZSgxNiwgMTYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuc2NhbGUoLjQsIC40KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLncoYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5yZXN0b3JlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmF2aWNvbiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gZS5jbG9uZU5vZGUoITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuc2V0QXR0cmlidXRlKCJocmVmIiwgYi50b0RhdGFVUkwoImltYWdlL3BuZyIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGcsIGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0oKTsKICAgICAgICAgICAgICAgICAgICBlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgVGIoKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHZhciBXYSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFByb3ZpZGVyOiAiZmFjZWJvb2siLAogICAgICAgICAgICAgICAgICAgICAgICBsb2dpbkludGVudDogIjAiLAogICAgICAgICAgICAgICAgICAgICAgICB1c2VySW5mbzogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc29jaWFsVG9rZW46IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbkV4cGlyZXM6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHA6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHBOZWVkZWQ6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWN0dXJlOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlZEluOiAiMCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2NpYWxJZDogIiIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBjLmRlZmF1bHRTdCA9IFdhOwogICAgICAgICAgICAgICAgICAgIGMuc3RvcmFnZUluZm8gPSBoOwogICAgICAgICAgICAgICAgICAgIGMuY3JlYXRlRGVmYXVsdFN0b3JhZ2UgPSBQYzsKICAgICAgICAgICAgICAgICAgICBjLnVwZGF0ZVN0b3JhZ2UgPSBYYTsKICAgICAgICAgICAgICAgICAgICBlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBjLmxvY2FsU3RvcmFnZS5zdG9yZU9iamVjdEluZm8gJiYgKGggPSBKU09OLnBhcnNlKGMubG9jYWxTdG9yYWdlLnN0b3JlT2JqZWN0SW5mbykpOwogICAgICAgICAgICAgICAgICAgICAgICAiMSIgPT0gaC5sb2dpbkludGVudCAmJiBmYyhoLmNvbnRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAiIiA9PSBoLnVzZXJJbmZvLm5hbWUgJiYgIiIgPT0gaC51c2VySW5mby5kaXNwbGF5TmFtZSB8fCBnYyhoLnVzZXJJbmZvKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGMuY2hlY2tMb2dpblN0YXR1cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIjEiID09IGgubG9naW5JbnRlbnQgJiYgKFlhKCksIGZjKGguY29udGV4dCkpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB2YXIgWWEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuTUMuc2V0UHJvZmlsZVBpY3R1cmUoaC51c2VySW5mby5waWN0dXJlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYy5NQy5zZXRTb2NpYWxJZChoLnVzZXJJbmZvLnNvY2lhbElkKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBXYTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGMubG9jYWxTdG9yYWdlLnN0b3JlT2JqZWN0SW5mbzsKICAgICAgICAgICAgICAgICAgICAgICAgYy5sb2NhbFN0b3JhZ2Uuc3RvcmVPYmplY3RJbmZvID0gSlNPTi5zdHJpbmdpZnkoV2EpOwogICAgICAgICAgICAgICAgICAgICAgICBYYSgpOwogICAgICAgICAgICAgICAgICAgICAgICBzYygpOwogICAgICAgICAgICAgICAgICAgICAgICBtLmNhY2hlLnNlbnRHYW1lU2VydmVyTG9naW4gPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG0uY2FjaGUubG9naW5faW5mbzsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiI2hlbGxvQ29udGFpbmVyIikuYXR0cigiZGF0YS1sb2dnZWQtaW4iLCAiMCIpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLWhhcy1hY2NvdW50LWRhdGEiLCAiMCIpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIudGltZXIiKS50ZXh0KCIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiI2dQbHVzU2hhcmUiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNmYlNoYXJlIikuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjdXNlci1pZC10YWciKS50ZXh0KCIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgUSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjLk1DLmRvTG9nb3V0KCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGMudG9nZ2xlU29jaWFsTG9naW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNzb2NpYWxMb2dpbkNvbnRhaW5lciIpLnRvZ2dsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjc2V0dGluZ3MiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNpbnN0cnVjdGlvbnMiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIENiKCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGMudG9nZ2xlU2V0dGluZ3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNzZXR0aW5ncyIpLnRvZ2dsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjc29jaWFsTG9naW5Db250YWluZXIiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNpbnN0cnVjdGlvbnMiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIENiKCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIG0uYWNjb3VudCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGIoKSB7IH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGQoYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coSGEuTCgpICsgIiBnb3QgdXNlciBsb2dpbiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gZiB8fCBmLmlkICE9IGIuaWQpIGYgPSBiLCBudWxsICE9IGMuc3NhX2pzb24gJiYgKGMuc3NhX2pzb24uYXBwbGljYXRpb25Vc2VySWQgPSAiIiArIGIuaWQsIGMuc3NhX2pzb24uY3VzdG9tX3VzZXJfaWQgPSAiIiArIGIuaWQpLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgU1NBX0NPUkUgJiYgU1NBX0NPUkUuc3RhcnQoKSwgZSgiI29mZmVyd2FsbElmcmFtZSIpLmF0dHIoInNyYyIsICJodHRwOi8vd3d3LnN1cGVyc29uaWNhZHMuY29tL2RlbGl2ZXJ5L3BhbmVsLnBocD9hcHBsaWNhdGlvbktleT0iICsgRW52Q29uZmlnLnN1cGVyc29uaWNfYXBwX2tleSArICImYXBwbGljYXRpb25Vc2VySWQ9IiArIGIuaWQgKyAiJmN1c3RvbV91c2VyX2lkPSIgKyBiLmlkICsgIiZhcHBsaWNhdGlvblVzZXJJZFNpZ25hdHVyZT1vcHRpb25hbCIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBhLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmNvcmUuYmluZCgidXNlcl9sb2dpbiIsIGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5jb3JlLmJpbmQoInVzZXJfbG9nb3V0IiwgYikKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5zZXRVc2VyRGF0YSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYyhhKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLnNldEFjY291bnREYXRhID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gZSgiI2hlbGxvQ29udGFpbmVyIikuYXR0cigiZGF0YS1oYXMtYWNjb3VudC1kYXRhIiwgIjEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgudXNlckluZm8ueHAgPSBhLnhwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaC51c2VySW5mby54cE5lZWRlZCA9IGEueHBOZWVkZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLnVzZXJJbmZvLmxldmVsID0gYS5sZXZlbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhhKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjICYmIGIgPyBnYShhKSA6IChlKCIuYWdhcmlvLXByb2ZpbGUtcGFuZWwgLnByb2dyZXNzLWJhci1zdGFyIikudGV4dChhLmxldmVsKSwgZSgiLmFnYXJpby1leHAtYmFyIC5wcm9ncmVzcy1iYXItdGV4dCIpLnRleHQoYS54cCArICIvIiArIGEueHBOZWVkZWQgKyAiIFhQIiksIGUoIi5hZ2FyaW8tZXhwLWJhciAucHJvZ3Jlc3MtYmFyIikuY3NzKCJ3aWR0aCIsICg4OCAqIGEueHAgLyBhLnhwTmVlZGVkKS50b0ZpeGVkKDIpICsgIiUiKSkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5HYSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYShhKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgICAgIH0oe30pOwogICAgICAgICAgICAgICAgICAgIHZhciBpYyA9IDA7CiAgICAgICAgICAgICAgICAgICAgYy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgPT0gYy5GQiA/IGFsZXJ0KCJZb3Ugc2VlbSB0byBoYXZlIHNvbWV0aGluZyBibG9ja2luZyBGYWNlYm9vayBvbiB5b3VyIGJyb3dzZXIsIHBsZWFzZSBjaGVjayBmb3IgYW55IGV4dGVuc2lvbnMiKSA6IChoLmxvZ2luSW50ZW50ID0gIjEiLCBjLnVwZGF0ZVN0b3JhZ2UoKSwgYy5GQi5sb2dpbihmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhjKGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICJwdWJsaWNfcHJvZmlsZSwgZW1haWwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjLkZCLmluaXQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwSWQ6IEVudkNvbmZpZy5mYl9hcHBfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWU6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeGZibWw6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246ICJ2Mi4yIgogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgKCIxIiA9PSBjLnN0b3JhZ2VJbmZvLmxvZ2luSW50ZW50ICYmICJmYWNlYm9vayIgPT0gYy5zdG9yYWdlSW5mby5jb250ZXh0IHx8IG5jKSAmJiBjLkZCLmdldExvZ2luU3RhdHVzKGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY29ubmVjdGVkIiA9PT0gYi5zdGF0dXMgPyBoYyhiKSA6ICJub3RfYXV0aG9yaXplZCIgPT09IGIuc3RhdHVzID8gKGMubG9nb3V0KCksIGEoKSkgOiBjLmxvZ291dCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjLmZhY2Vib29rUmVsb2dpbiA9IGE7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuZmFjZWJvb2tMb2dpbiA9IGEKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHZhciBIYiA9ICExOwogICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBiKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEudHlwZSA9ICJ0ZXh0L2phdmFzY3JpcHQiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5hc3luYyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5zcmMgPSAiLy9hcGlzLmdvb2dsZS5jb20vanMvY2xpZW50OnBsYXRmb3JtLmpzP29ubG9hZD1nYXBpQXN5bmNJbml0IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSAhMAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuZ2FwaUFzeW5jSW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoZCkudHJpZ2dlcigiaW5pdGlhbGl6ZWQiKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLmdvb2dsZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2E6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5nYXBpLmNsaWVudC5sb2FkKCJwbHVzIiwgInYxIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZmV0Y2hpbmcgbWUgcHJvZmlsZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYXBpLmNsaWVudC5wbHVzLnBlb3BsZS5nZXQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiAibWUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmV4ZWN1dGUoZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIoYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLkRhID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgfHwgYigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnYXBpID8gYSgpIDogZShkKS5iaW5kKCJpbml0aWFsaXplZCIsIGEpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICAgICAgfSkobSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLk1DLmRvTG9naW5XaXRoR1BsdXMoYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmNhY2hlLmxvZ2luX2luZm8gPSBbYSwgImdvb2dsZSJdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGQoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaC51c2VySW5mby5waWN0dXJlID0gYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoIi5hZ2FyaW8tcHJvZmlsZS1waWN0dXJlIikuYXR0cigic3JjIiwgYSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudF9pZDogRW52Q29uZmlnLmdwbHVzX2NsaWVudF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfcG9saWN5OiAic2luZ2xlX2hvc3Rfb3JpZ2luIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZTogInByb2ZpbGUgZW1haWwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLmZhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2E6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBoICYmICIxIiA9PSBoLmxvZ2luSW50ZW50ICYmICJnb29nbGUiID09IGguY29udGV4dDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLkRhKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5nYXBpLnl0c3Vic2NyaWJlLmdvKCJhZ2FyWW91dHViZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmdhcGkubG9hZCgiYXV0aDIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYy5nYXBpLmF1dGgyLmluaXQoZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmF0dGFjaENsaWNrSGFuZGxlcihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ3BsdXNMb2dpbiIpLCB7fSwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZ29vZ2xlVXNlciA6ICIgKyBhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZmFpbGVkIHRvIGxvZ2luIGluIGdvb2dsZSBwbHVzOiAiLCBKU09OLnN0cmluZ2lmeShhLCB2b2lkIDAsIDIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmN1cnJlbnRVc2VyLmxpc3RlbihfLmJpbmQoYS5DYSwgYSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiAmJiAxID09IGYuaXNTaWduZWRJbi5nZXQoKSAmJiBmLnNpZ25JbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYTogZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZiAmJiBhICYmIGYuaXNTaWduZWRJbi5nZXQoKSAmJiAhSGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGIgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5sb2dpbkludGVudCA9ICIxIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBhLmdldEF1dGhSZXNwb25zZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGUuYWNjZXNzX3Rva2VuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLm9hID0gZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImxvZ2dlZEluIHdpdGggRyshIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsID0gYS5nZXRCYXNpY1Byb2ZpbGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGwuZ2V0SW1hZ2VVcmwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAwID09IGEgPyBtLmdvb2dsZS5zYShlLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5yZXN1bHQuaXNQbHVzVXNlciA/IChhICYmIGQoYS5pbWFnZS51cmwpLCBiKGcpLCBhICYmIChoLnVzZXJJbmZvLnBpY3R1cmUgPSBhLmltYWdlLnVybCksIGgudXNlckluZm8uc29jaWFsSWQgPSBsLmdldElkKCksIFlhKCkpIDogKGFsZXJ0KCJQbGVhc2UgYWRkIEdvb2dsZSsgdG8geW91ciBHb29nbGUgYWNjb3VudCBhbmQgdHJ5IGFnYWluLlxuT3IgeW91IGNhbiBsb2dpbiB3aXRoIGFub3RoZXIgYWNjb3VudC4iKSwgYy5sb2dvdXQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiAoZChhKSwgaC51c2VySW5mby5waWN0dXJlID0gYSwgaC51c2VySW5mby5zb2NpYWxJZCA9IGwuZ2V0SWQoKSwgWWEoKSwgYihnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguY29udGV4dCA9ICJnb29nbGUiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnVwZGF0ZVN0b3JhZ2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgJiYgKGYuc2lnbk91dCgpLCBIYiA9ICExKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgICAgIH0obSk7CiAgICAgICAgICAgICAgICAgICAgYy5ncGx1c01vZHVsZSA9IGFkOwogICAgICAgICAgICAgICAgICAgIHZhciBzYyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbS5mYS53YSgpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLmxvZ291dEdvb2dsZVBsdXMgPSBzYzsKICAgICAgICAgICAgICAgICAgICB2YXIgWmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGEoYSwgYiwgYywgZCwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBiLmdldENvbnRleHQoIjJkIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGIud2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gYi5oZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbG9yID0gZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuQShjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuc2l6ZSA9IGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYudHJhbnNsYXRlKGcgLyAyLCBiIC8gMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLncoZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLnJlc3RvcmUoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSBuZXcgY2EoLTEsIDAsIDAsIDMyLCAiIzViYzBkZSIsICIiKSwgYyA9IG5ldyBjYSgtMSwgMCwgMCwgMzIsICIjNWJjMGRlIiwgIiIpLCBmID0gIiMwNzkxZmYgIzVhMDdmZiAjZmYwN2ZlICNmZmE1MDcgI2ZmMDc3NCAjMDc3ZmZmICMzYWZmMDcgI2ZmMDdlZCAjMDdhOGZmICNmZjA3NmUgIzNmZmYwNyAjZmYwNzM0ICMwN2ZmMjAgI2ZmMDdhMiAjZmY4MjA3ICMwN2ZmMGUiLnNwbGl0KCIgIiksIGcgPSBbXSwgaCA9IDA7IGggPCBmLmxlbmd0aDsgKytoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IGggLyBmLmxlbmd0aCAqIDEyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAzMCAqIE1hdGguc3FydChoIC8gZi5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5wdXNoKG5ldyBjYSgtMSwgTWF0aC5jb3MobCkgKiBrLCBNYXRoLnNpbihsKSAqIGssIDEwLCBmW2hdLCAiIikpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgT2MoZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIG0uZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbS53aWR0aCA9IG0uaGVpZ2h0ID0gNzA7CiAgICAgICAgICAgICAgICAgICAgICAgIGEoYywgbSwgIiIsIDI2LCAiI2ViYzBkZSIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSgiLmNlbGwtc3Bpbm5lciIpLmZpbHRlcigiOnZpc2libGUiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGUodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gdGhpcy53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXMuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gdGhpcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguY2xlYXJSZWN0KDAsIDAsIGYsIGcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguc2F2ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgudHJhbnNsYXRlKGYgLyAyLCBnIC8gMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IDEwID4gazsgKytrKSBoLmRyYXdJbWFnZShtLCAoLjEgKiBkICsgODAgKiBrKSAlIChmICsgMTQwKSAtIGYgLyAyIC0gNzAgLSAzNSwgZyAvIDIgKiBNYXRoLnNpbigoLjAwMSAqIGQgKyBrKSAlIE1hdGguUEkgKiAyKSAtIDM1LCA3MCwgNzApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgucmVzdG9yZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjID0gYy5hdHRyKCJkYXRhLWl0ciIpKSAmJiAoYyA9IFIoYykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYiwgdGhpcywgYyB8fCAiIiwgK2UodGhpcykuYXR0cigiZGF0YS1zaXplIiksICIjNWJjMGRlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSgiI3N0YXRzUGVsbGV0cyIpLmZpbHRlcigiOnZpc2libGUiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q29udGV4dCgiMmQiKS5jbGVhclJlY3QoMCwgMCwgYiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IGcubGVuZ3RoOyBiKyspIGEoZ1tiXSwgdGhpcywgIiIsIGdbYl0uc2l6ZSwgZ1tiXS5jb2xvcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KCk7CiAgICAgICAgICAgICAgICAgICAgYy5jcmVhdGVQYXJ0eSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAga2EoIjpwYXJ0eSIpOwogICAgICAgICAgICAgICAgICAgICAgICBTID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERiKCIvIyIgKyBjLmVuY29kZVVSSUNvbXBvbmVudChhKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKCIucGFydHlUb2tlbiIpLnZhbCgiYWdhci5pby8jIiArIGMuZW5jb2RlVVJJQ29tcG9uZW50KGEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNoZWxsb0NvbnRhaW5lciIpLmF0dHIoImRhdGEtcGFydHktc3RhdGUiLCAiMSIpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIFEoKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5qb2luUGFydHkgPSBqYzsKICAgICAgICAgICAgICAgICAgICBjLmNhbmNlbFBhcnR5ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBEYigiLyIpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLXBhcnR5LXN0YXRlIiwgIjAiKTsKICAgICAgICAgICAgICAgICAgICAgICAga2EoIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBRKCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHZhciBGID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIHViID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgdmIgPSAiIzAwMDAwMCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFhID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIEVhID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIFJhID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgRWIgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICB4YiA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHdiID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgVyA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIFphID0gITA7CiAgICAgICAgICAgICAgICAgICAgYy5vblBsYXllckRlYXRoID0gSmE7CiAgICAgICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBFYSAmJiBGLnB1c2goYWMoKSAvIDEwMCkKICAgICAgICAgICAgICAgICAgICB9LCAxRTMgLyA2MCk7CiAgICAgICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IFJjKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIDAgIT0gYSAmJiAoKyt4YiwgMCA9PSBXICYmIChXID0gYSksIFcgPSBNYXRoLm1pbihXLCBhKSkKICAgICAgICAgICAgICAgICAgICB9LCAxRTMpOwogICAgICAgICAgICAgICAgICAgIGMuY2xvc2VTdGF0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWEgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiI3N0YXRzIikuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjLmRlc3Ryb3lBZChjLmFkU2xvdHMuYWIpOwogICAgICAgICAgICAgICAgICAgICAgICB5YSgwKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5zZXRTa2lwU3RhdHMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBaYSA9ICFhCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLmdldFN0YXRzU3RyaW5nID0gbGM7CiAgICAgICAgICAgICAgICAgICAgYy5nUGx1c1NoYXJlID0gVGM7CiAgICAgICAgICAgICAgICAgICAgYy50d2l0dGVyU2hhcmVTdGF0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBjLmdldFN0YXRzU3RyaW5nKCJ0dF9zaGFyZV9zdGF0cyIpOwogICAgICAgICAgICAgICAgICAgICAgICBjLm9wZW4oImh0dHBzOi8vdHdpdHRlci5jb20vaW50ZW50L3R3ZWV0P3RleHQ9IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLCAiQWdhci5pbyIsICJ3aWR0aD02NjAsaGVpZ2h0PTMxMCxtZW51YmFyPW5vLHRvb2xiYXI9bm8scmVzaXphYmxlPXllcyxzY3JvbGxiYXJzPW5vLGxlZnQ9IiArIChjLnNjcmVlblggKyBjLmlubmVyV2lkdGggLyAyIC0gMzMwKSArICIsdG9wPSIgKyAoYy5pbm5lckhlaWdodCAtIDMxMCkgLyAyKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5mYlNoYXJlU3RhdHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gYy5nZXRTdGF0c1N0cmluZygiZmJfbWF0Y2hyZXN1bHRzX3N1YnRpdGxlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuRkIudWkoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAiZmVlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAiaWZyYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFIoImZiX21hdGNocmVzdWx0c190aXRsZSIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbjogUigiZmJfbWF0Y2hyZXN1bHRzX2Rlc2NyaXB0aW9uIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6ICJodHRwOi8vYWdhci5pbyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKYTogImh0dHA6Ly9zdGF0aWMyLm1pbmljbGlwY2RuLmNvbS9tb2JpbGUvYWdhci9BZ2FyLmlvX21hdGNocmVzdWx0c19mYl8xMjAweDYzMC5wbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAicGxheSBub3chIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rOiAiaHR0cDovL2FnYXIuaW8iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLmZpbGxTb2NpYWxWYWx1ZXMgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAxID09IGMuaXNDaHJvbWUgJiYgImdvb2dsZSIgPT0gYy5zdG9yYWdlSW5mby5jb250ZXh0ICYmIGMuZ2FwaS5pbnRlcmFjdGl2ZXBvc3QucmVuZGVyKGIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnR1cmw6IEVudkNvbmZpZy5nYW1lX3VybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudGlkOiBFbnZDb25maWcuZ3BsdXNfY2xpZW50X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llcG9saWN5OiAiaHR0cDovL2FnYXIuaW8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlZmlsbHRleHQ6IGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsdG9hY3Rpb25sYWJlbDogIkJFQVQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbHRvYWN0aW9udXJsOiBFbnZDb25maWcuZ2FtZV91cmwKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAiTUFzeW5jSW5pdCIgaW4gYyAmJiBjLk1Bc3luY0luaXQoKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE9SSUdJTkFMIFNDUklQVAogICAgICAgICAgICB2YXIgd2luZG8gPSBjOwogICAgICAgICAgICB2YXIgbWZnaCA9IGZhbHNlOwogICAgICAgICAgICB2YXIgc3RvcE1vdmUgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIGF1dG9GZWVkSW50ZXJ2YWwgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHZhciBhdXRvU3BsaXRJbnRlcnZhbCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIHNlbmRCdWZmZXIgPSBWOwogICAgICAgICAgICB2YXIgc2VuZFZhbCA9IFg7CiAgICAgICAgICAgIC8vQUdBUkJPVE9WSCBtb2RpZiBJYiBwb3VyIGxhIG3pdGhvZGUgcXVpIGZhaXQgbGVzIG9ua2V5dXAgb25rZXlkb3duCiAgICAgICAgICAgIEliID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgd2luZG8ub25rZXl1cCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgMzIgPT0gYS5rZXlDb2RlICYmICh2YSA9ICExKTsKICAgICAgICAgICAgICAgICAgICA4NyA9PSBhLmtleUNvZGUgJiYgKHhhID0gITEpOwogICAgICAgICAgICAgICAgICAgIDgxID09IGEua2V5Q29kZSAmJiB3YSAmJiAoWCgxOSksIHdhID0gITEpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aW5kby5vbmtleWRvd24gPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdrZXlEb3duJywgYSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEua2V5Q29kZSA9PSA2OSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZW1pdCBzcGxpdCAhJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJnei5zZW5kKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhY3Rpb24iIDogMgogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChhLmtleUNvZGUgPT0gODIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VtaXQgZmVlZCAhJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJnei5zZW5kKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhY3Rpb24iIDogMwogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoYS5rZXlDb2RlID09IDg0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1mZ2ggPSAhbWZnaDsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vdXNlX29mZicpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobWZnaCkgeyBiLmlubmVySFRNTCA9ICdPTic7IGIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ2dyZWVuJzsgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1mZ2gpIHsgYi5pbm5lckhUTUwgPSAnT0ZGJzsgYi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAncmVkJzsgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAzMiAhPSBhLmtleUNvZGUgfHwgdmEgfHwgKCJuaWNrIiAhPSBhLnRhcmdldC5pZCAmJiBhLnByZXZlbnREZWZhdWx0KCksIGViKCksIHZhID0gITApOwogICAgICAgICAgICAgICAgICAgIDgxID09IGEua2V5Q29kZSAmJiAoWCgxOCksIHdhID0gITApOwogICAgICAgICAgICAgICAgICAgIDg3ICE9IGEua2V5Q29kZSB8fCB4YSB8fCAoSmIoKSwgeGEgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgMjcgPT0gYS5rZXlDb2RlICYmIChhLnByZXZlbnREZWZhdWx0KCksIHlhKDMwMCksIGUoIiNvZmVyd2FsbENvbnRhaW5lciIpLmlzKCI6dmlzaWJsZSIpICYmIGMuY2xvc2VPZmZlcndhbGwoKSwgZSgiI3ZpZGVvQ29udGFpbmVyIikuaXMoIjp2aXNpYmxlIikgJiYgYy5jbG9zZVZpZGVvQ29udGFpbmVyKCkpCiAgICAgICAgICAgICAgICAgICAgIGlmIChhLmtleUNvZGUgPT0gODMgJiYgIm5pY2siICE9IGEudGFyZ2V0LmlkKSB7Ly8gcwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncycpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXV0b0ZlZWRJbnRlcnZhbCA9PSB1bmRlZmluZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvRmVlZEludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRWYWwoMjEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGF1dG9GZWVkSW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b0ZlZWRJbnRlcnZhbCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhLmtleUNvZGUgPT0gMzIgJiYgYS5zaGlmdEtleSAmJiAibmljayIgIT0gYS50YXJnZXQuaWQpIHsvLyBzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdzcGFjZScpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbnVtYmVyID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dG9TcGxpdEludGVydmFsID09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9TcGxpdEludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRWYWwoMTcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlcisrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudW1iZXIgPT0gNykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGF1dG9TcGxpdEludGVydmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b1NwbGl0SW50ZXJ2YWwgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlciA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGF1dG9TcGxpdEludGVydmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9TcGxpdEludGVydmFsID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2goKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGEua2V5Q29kZSA9PSA2OCAmJiAibmljayIgIT0gYS50YXJnZXQuaWQpIHsvLyBECiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3BNb3ZlID0gIXN0b3BNb3ZlOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZlX29mZicpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RvcE1vdmUpIHsgaS5pbm5lckhUTUwgPSAnT04nOyBpLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdncmVlbic7IH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdG9wTW92ZSkgeyBpLmlubmVySFRNTCA9ICdPRkYnOyBpLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdyZWQnOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ1NUT1BNT1ZFJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIGNvbnNvbGUubG9nKCdMdCcsTHQpOyBjb25zb2xlLmxvZygnRXQnLEV0KTsgY29uc29sZS5sb2coJ1R0JyxUdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAqIGNvbnNvbGUubG9nKCd3dCcsd3QpOyBjb25zb2xlLmxvZygnUHQnLFB0KTsgY29uc29sZS5sb2coJ0N0JyxDdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoKCk7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBjb25uZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHZhciBidCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIGlwID0gdW5kZWZpbmVkOwogICAgICAgICAgICB2YXIgcm9vbSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIGJneiA9IG5ldyBXZWJTb2NrZXQoJ3dzOi8vMTI3LjAuMC4xOjgwODEnLCAnZC1ib3RzLXByb3RvY29sJyk7CiAgICAgICAgICAgIHZhciBtaW4gPSAwLAogICAgICAgICAgICAgICAgaG91ciA9IDAsCiAgICAgICAgICAgICAgICBkYXlzID0gMDsKICAgICAgICAgICAgZnVuY3Rpb24gc3RhcnRUaW1lcl90aW1lX2xlZnQoKSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHZhciBhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVfbGVmdCcpOwogICAgICAgICAgICAgICAgeG1oID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChtaW4gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1pbi0tOwogICAgICAgICAgICAgICAgICAgICAgICBhLmlubmVySFRNTCA9IGRheXMgKyAnZCAnICsgaG91ciArICdoICcgKyBtaW4gKyAnbWluJzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaG91ciA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IDYwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91ci0tOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5pbm5lckhUTUwgPSBkYXlzICsgJ2QgJyArIGhvdXIgKyAnaCAnICsgbWluICsgJ21pbic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF5cyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VyID0gMjM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluID0gNjA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5cy0tOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuaW5uZXJIVE1MID0gZGF5cyArICdkICcgKyBob3VyICsgJ2ggJyArIG1pbiArICdtaW4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmlubmVySFRNTCA9ICdObyBUaW1lIGxlZnQgISc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0sIDYwMDAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgYmd6Lm9uY2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRGlzY29ubmVjdGVkIGZyb20gdGhlIHNlcnZlciAhJyk7CiAgICAgICAgICAgICAgICBjb25uZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBiZ3oub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQ29ubmVjdGlvbiBlcnJvciAhJyArIGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJnei5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtc2cpOwogICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKG1zZy5kYXRhKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpOwogICAgICAgICAgICAgICAgaWYgKGRhdGEuYWN0aW9uID09IDEpIHsgLy8gdGltZSBsZWZ0ICAgCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1RpbWUgYWN0aW9uICEhJyk7CiAgICAgICAgICAgICAgICAgICAgbWluID0gZGF0YS5taW51dGVzOwogICAgICAgICAgICAgICAgICAgIGhvdXIgPSBkYXRhLmhvdXJzOwogICAgICAgICAgICAgICAgICAgIGRheXMgPSBkYXRhLmRheXM7CiAgICAgICAgICAgICAgICAgICAgdmZnID0gc2V0SW50ZXJ2YWwoIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5jb250YWlucyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZV9sZWZ0JykpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aW1lX2xlZnQnKS5pbm5lckhUTUwgPSBkYXlzICsgJ2QgJyArIGhvdXIgKyAnaCAnICsgbWluICsgJ21pbic7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZXJfdGltZV9sZWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodmZnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgMjAwKTsKCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuYWN0aW9uID09IDIpIHsgLy8gYm90IGNvdW50KysKICAgICAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICAgICAgICAgIHZhciBjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JvdF9jb3VudCcpLmlubmVySFRNTCA9IGNvdW50OwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLmFjdGlvbiA9PSAzKSB7IC8vIGJvdCBjb3VudC0tCiAgICAgICAgICAgICAgICAgICAgY291bnQtLTsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib3RfY291bnQnKS5pbm5lckhUTUwgPSBjb3VudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBiZ3oub25vcGVuID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29ubmVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHZkciA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuY29udGFpbnMoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVfbGVmdCcpKSkgeyAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aW1lX2xlZnQnKS5pbm5lckhUTUwgPSAnTm8gVGltZSBsZWZ0ICEnOyAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHZkcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMjAwKTsKICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAKICAgICAgICAgICAgdmFyIGNoYW5nZUdhbWVNb2RlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZWZyZXNoKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHh0ID0gZmFsc2U7CgogICAgICAgICAgICB2YXIgc2V0VHh0ID0gZnVuY3Rpb24gKGluZm9zLCBhZykgewogICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtaW5pb25zIikgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygndGltZW91dCcsaW5mb3MpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRUeHQoaW5mb3MsIGFnKTsKICAgICAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtaW5pb25zIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiLnN0eWxlLmNzc1RleHQuaW5jbHVkZXMoJ2ZvbnQtc2l6ZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmlubmVySFRNTCA9IGluZm9zLnR4dDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc3R5bGUuY3NzVGV4dC5yZXBsYWNlKCdjb2xvciA6IHJlZCcsICdjb2xvcjogZ3JlZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc3R5bGUuY3NzVGV4dCArPSAiZm9udC1zaXplIDogMTUwJTsiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5pbm5lckhUTUwgPSBpbmZvcy50eHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBiLmlubmVySFRNTCA9IGluZm9zLnR4dDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKCiAgICAgICAgICAgIHZhciBzZXRJbmZvcyA9IGZ1bmN0aW9uICh0eHQsIGNsb3NlTWVzcykgewogICAgICAgICAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInR4dCIpOwogICAgICAgICAgICAgICAgaWYgKGVsID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgICAgIGVsLmlkID0gJ3R4dCc7CiAgICAgICAgICAgICAgICAgICAgZWwuc3R5bGUuY3NzVGV4dCA9ICJkaXNwbGF5Om5vbmU7IjsKICAgICAgICAgICAgICAgICAgICBlbC5pbm5lclRleHQgPSBKU09OLnN0cmluZ2lmeSh7IHR4dDogJycsIGNsb3NlTWVzczogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBvYmogPSBKU09OLnBhcnNlKGVsLmlubmVyVGV4dCk7CiAgICAgICAgICAgICAgICBpZiAodHh0ICE9IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICBvYmoudHh0ID0gdHh0OwogICAgICAgICAgICAgICAgaWYgKGNsb3NlTWVzcyAhPSB1bmRlZmluZWQpCiAgICAgICAgICAgICAgICAgICAgb2JqLmNsb3NlTWVzcyA9IGNsb3NlTWVzczsKICAgICAgICAgICAgICAgIGVsLmlubmVyVGV4dCA9IEpTT04uc3RyaW5naWZ5KG9iaik7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBnZXRJbmZvcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0eHQiKTsKICAgICAgICAgICAgICAgIGlmIChlbCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgICAgICBlbC5pZCA9ICd0eHQnOwogICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlLmNzc1RleHQgPSAiZGlzcGxheTpub25lOyI7CiAgICAgICAgICAgICAgICAgICAgZWwuaW5uZXJUZXh0ID0gSlNPTi5zdHJpbmdpZnkoeyB0eHQ6ICcnLCBjbG9zZU1lc3M6IHRydWUgfSk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlbC5pbm5lclRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZWwuaW5uZXJUZXh0KTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIHJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IHdpbmRvdy5sYXN0TWVzc2FnZTsKICAgICAgICAgICAgICAgIGlmICh0ID09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAocm9vbSAhPSB1bmRlZmluZWQgJiYgcm9vbS5sZW5ndGggPiAxMCkgewogICAgICAgICAgICAgICAgICAgICQoJyNtc2d0eHQnKS5odG1sKCdCT1RTIE9OTFkgV09SSyBJTiBQQVJUWSBNT0RFJyk7CiAgICAgICAgICAgICAgICAgICAgc2hvd1JlbWFpbmluZygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0Lm5vcGUpIHsKICAgICAgICAgICAgICAgICAgICAkKCcjbXNndHh0JykuaHRtbCgnPGEgaHJlZj0iaHR0cDovL2FnYXJib3Qub3ZoIiB0YXJnZXQ9Il9ibGFuYyI+Tm8gcGxhbiBhY3RpdmUgJmd0OyBhZ2FyYm90Lm92aCAoZGlkIHlvdSByZWZyZXNoIElQID8pPC9hPicpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0LmFscmVhZHlDb25uZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAkKCcjbXNndHh0JykuaHRtbCgnQWxyZWFkeSBvbiBhbm90aGVyIGdhbWUgKHJlZnJlc2ggcGFnZSknKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC5zcGVjaWFsICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdzZXR0aW5nIHNwZWNpYWwnKTsKICAgICAgICAgICAgICAgICAgICAkKCcjbXNndHh0JykuaHRtbCh0LnNwZWNpYWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvYWRpbmdzZXQgPT0gdW5kZWZpbmVkICYmIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZ2FyYm90X2xlZnRib3gnKSAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FnYXJib3RfbGVmdGJveCcpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2hvdGtleXMnKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vJCgiLmFnYXJib3RvdmhfcHJvZ3Jlc3MtYmFyIikubG9hZGluZygpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9hZGluZ3NldCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICQoJyNtc2d0eHQnKS5odG1sKCcnKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZXhwaXJlID0gdC5leHBpcmU7CiAgICAgICAgICAgICAgICAgICAgdmFyIGV4cGlyZSA9IG5ldyBEYXRlKHQuZXhwaXJlKTsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnZXhwaXJlICcsdC5leHBpcmUpOwogICAgICAgICAgICAgICAgICAgIHZhciBib3RzQXZhaWxhYmxlID0gdC5ib3RzQXZhaWxhYmxlOwogICAgICAgICAgICAgICAgICAgIGlmICghYm90c0F2YWlsYWJsZSkKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI21zZ3R4dCcpLmh0bWwoJ05vIGJvdHMgYXZhaWxhYmxlLi4uIHJldHJ5aW5nJyk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZCBGRjMzMzMKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ3JlZW4gMzNGRjMzCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5qb2luZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eHQgPSAnQm90cyAnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuY3VycmVudEJvdHMgPT0gdC5tYXhCb3RzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSAnPHNwYW4gc3R5bGU9ImNvbG9yOiMzM0ZGMzMiPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9ICc8c3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9IHQuY3VycmVudEJvdHMgKyAiIC8gIiArIHQubWF4Qm90cyArICc8L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNib3RzJykuaHRtbCh0eHQpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNtc2d0eHQnKS5odG1sKCdXYWl0aW5nIGZvciB5b3UgdG8gY2xpY2sgcGxheScpOwoKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3BpbmcnKS5odG1sKHdpbmRvdy5waW5nIHx8ICc/Jyk7CgoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dG9GZWVkSW50ZXJ2YWwgPT0gdW5kZWZpbmVkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2F1dG9mZWVkJykucmVtb3ZlQ2xhc3MoJ2FnYXJib3RvdmhfZ3JlZW4nKS5hZGRDbGFzcygnYWdhcmJvdG92aF9yZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2F1dG9mZWVkJykuYWRkQ2xhc3MoJ2FnYXJib3RvdmhfZ3JlZW4nKS5yZW1vdmVDbGFzcygnYWdhcmJvdG92aF9yZWQnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdG9wTW92ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzdG9wbW92ZScpLmFkZENsYXNzKCdhZ2FyYm90b3ZoX2dyZWVuJykucmVtb3ZlQ2xhc3MoJ2FnYXJib3RvdmhfcmVkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzdG9wbW92ZScpLnJlbW92ZUNsYXNzKCdhZ2FyYm90b3ZoX2dyZWVuJykuYWRkQ2xhc3MoJ2FnYXJib3RvdmhfcmVkJyk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5hbGdvID09IDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWxnbycpLmh0bWwoJzxzcGFuIHN0eWxlPSJjb2xvcjojMkU5QkJGIj5FQVQgUEVMTEVUUzwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodC5hbGdvID09IDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWxnbycpLmh0bWwoJzxzcGFuIHN0eWxlPSJjb2xvcjojRTg2NkU4Ij5SVU48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHQuYWxnbyA9PSAzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FsZ28nKS5odG1sKCc8c3BhbiBzdHlsZT0iY29sb3I6IzQzREUyRiI+Q09NRSBUTyBNRUg8L3NwYW4+Jyk7CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGVyY2VudCA9ICh0LmVhdHMgLyB0LnNwYXducyAqIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihwZXJjZW50KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnQgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2VmZmljaWVuY3knKS5odG1sKCdFZmZpY2llbmN5IDogPHNwYW4gdGl0bGU9ImVhdGVuL3NwYXduZWQ9ZWZmaWNpZW5jeSUiPicgKyB0LmVhdHMgKyAnLycgKyB0LnNwYXducyArICcgID0gJyArIHBlcmNlbnQudG9GaXhlZCgyKSArICclPC9zcGFuPicpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQucGFydHlGdWxsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI21zZ3R4dCcpLmh0bWwoJ1BhcnR5IHByb2JhYmx5IGZ1bGwnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdC5qb2luZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eHQgPSAnSm9pbiB0aGUgZ2FtZSBhbmQgdGhlIGJvdHMgd2lsbCBjb25uZWN0ICgnOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb29tID09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eHQgKz0gJz8/Pyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9IChyb29tLmxlbmd0aCA8IDEwID8gJ1BBUlRZJyA6ICdGRkEgTk9UIFdPUktJTkcnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eHQgKz0gJyknOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI21zZ3R4dCcpLmh0bWwodHh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNob3dSZW1haW5pbmcoKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIF9zZWNvbmQgPSAxMDAwOwogICAgICAgICAgICB2YXIgX21pbnV0ZSA9IF9zZWNvbmQgKiA2MDsKICAgICAgICAgICAgdmFyIF9ob3VyID0gX21pbnV0ZSAqIDYwOwogICAgICAgICAgICB2YXIgX2RheSA9IF9ob3VyICogMjQ7CiAgICAgICAgICAgIGZ1bmN0aW9uIHNob3dSZW1haW5pbmcoKSB7CiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvdW50ZG93bicpID09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmV4cGlyZSA9PSB1bmRlZmluZWQgfHwgd2luZG93LmV4cGlyZSA9PSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gbmV3IERhdGUod2luZG93LmV4cGlyZSkgLSBub3c7CiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy9jbGVhckludGVydmFsKHRpbWVyKTsKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdTRU5EIFRISVMgVE8gTkVFTCcsbmV3IERhdGUoKSxub3csbmV3IERhdGUod2luZG93LmV4cGlyZSksZGlzdGFuY2UpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb3VudGRvd24nKS5pbm5lckhUTUwgPSAnRVhQSVJFRCEnOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBkYXlzID0gTWF0aC5mbG9vcihkaXN0YW5jZSAvIF9kYXkpOwogICAgICAgICAgICAgICAgdmFyIGhvdXJzID0gTWF0aC5mbG9vcigoZGlzdGFuY2UgJSBfZGF5KSAvIF9ob3VyKTsKICAgICAgICAgICAgICAgIHZhciBtaW51dGVzID0gTWF0aC5mbG9vcigoZGlzdGFuY2UgJSBfaG91cikgLyBfbWludXRlKTsKICAgICAgICAgICAgICAgIHZhciBzZWNvbmRzID0gTWF0aC5mbG9vcigoZGlzdGFuY2UgJSBfbWludXRlKSAvIF9zZWNvbmQpOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb3VudGRvd24nKS5pbm5lckhUTUwgPSBkYXlzICsgJ2RheXMgJzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb3VudGRvd24nKS5pbm5lckhUTUwgKz0gaG91cnMgKyAnaHJzICc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY291bnRkb3duJykuaW5uZXJIVE1MICs9IG1pbnV0ZXMgKyAnbWlucyAnOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvdW50ZG93bicpLmlubmVySFRNTCArPSBzZWNvbmRzICsgJ3NlY3MnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB0aW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsvLyBBR0FSQk9UT1ZICiAgICAgICAgICAgICAgICBzaG93UmVtYWluaW5nKCk7CiAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICBmdW5jdGlvbiBnb3ROZXdCYWxsKGlkKSB7CiAgICAgICAgICAgICAgICB2YXIgYmFsbCA9IG51bGw7CiAgICAgICAgICAgICAgICBmb3IgKGluZGV4IGluIHEpIHsvL0FHQVJCT1RPVkggcGFzIG91YmxpZXIgbW9kaWYgcQogICAgICAgICAgICAgICAgICAgIHZhciBiID0gcVtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGIuaWQgPT0gaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYmFsbCA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoeHQpCiAgICAgICAgICAgICAgICAgICAgYnQuc2VuZChKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICdpZCc6IGlkLAogICAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTkVXQkFMTCcsIGlkLCBiYWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gaGV4VG9SZ2IoaGV4KSB7CiAgICAgICAgICAgICAgICAvLyBFeHBhbmQgc2hvcnRoYW5kIGZvcm0gKGUuZy4gIjAzRiIpIHRvIGZ1bGwgZm9ybSAoZS5nLiAiMDAzM0ZGIikKICAgICAgICAgICAgICAgIHZhciBzaG9ydGhhbmRSZWdleCA9IC9eIz8oW2EtZlxkXSkoW2EtZlxkXSkoW2EtZlxkXSkkL2k7CiAgICAgICAgICAgICAgICBoZXggPSBoZXgucmVwbGFjZShzaG9ydGhhbmRSZWdleCwgZnVuY3Rpb24gKG0sIHIsIGcsIGIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gciArIHIgKyBnICsgZyArIGIgKyBiOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IC9eIz8oW2EtZlxkXXsyfSkoW2EtZlxkXXsyfSkoW2EtZlxkXXsyfSkkL2kuZXhlYyhoZXgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCA/IHsKICAgICAgICAgICAgICAgICAgICByOiBwYXJzZUludChyZXN1bHRbMV0sIDE2KSwKICAgICAgICAgICAgICAgICAgICBnOiBwYXJzZUludChyZXN1bHRbMl0sIDE2KSwKICAgICAgICAgICAgICAgICAgICBiOiBwYXJzZUludChyZXN1bHRbM10sIDE2KQogICAgICAgICAgICAgICAgfSA6IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHZhciBvZmZzZXRYID0gMDsKICAgICAgICAgICAgdmFyIG9mZnNldFkgPSAwOwogICAgICAgICAgICBmdW5jdGlvbiBtYXBDb29yZHMobWluX3gsIG1pbl95LCBtYXhfeCwgbWF4X3kpIHsKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ21hcCcsbWF4X3gtbWluX3gpOwogICAgICAgICAgICAgICAgaWYgKG1heF94IC0gbWluX3ggPiAxNDAwMCkgewogICAgICAgICAgICAgICAgICAgIG9mZnNldFggPSBtaW5feDsKICAgICAgICAgICAgICAgICAgICBvZmZzZXRZID0gbWluX3k7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaGV5KGJ1ZiwgeCwgeSkgewogICAgICAgICAgICAgICAgaWYgKHN0b3BNb3ZlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1pZFggPSAwOwogICAgICAgICAgICAgICAgICAgIHZhciBtaWRZID0gMDsKICAgICAgICAgICAgICAgICAgICB2YXIgbWluWCA9IDA7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1pblkgPSAwOwogICAgICAgICAgICAgICAgICAgIHZhciBtYXhYID0gMDsKICAgICAgICAgICAgICAgICAgICB2YXIgbWF4WSA9IDA7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpbmRleCBpbiBxKSB7Ly9BR0FSQk9UT1ZIIHBhcyBvdWJsaWVyIG1vZGlmIHEKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJhbGwgPSBxW2luZGV4XTsvL0FHQVJCT1RPVkggcGFzIG91YmxpZXIgbW9kaWYgcQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4WCA9IGJhbGwueDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pblggPSBiYWxsLng7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhZID0gYmFsbC55OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluWSA9IGJhbGwueTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFggPSBNYXRoLm1heChtYXhYLCBiYWxsLngpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluWCA9IE1hdGgubWluKG1pblgsIGJhbGwueCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhZID0gTWF0aC5tYXgobWF4WSwgYmFsbC55KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pblkgPSBNYXRoLm1pbihtaW5ZLCBiYWxsLnkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG1pZFggPSAobWluWCArIG1heFgpIC8gMjsKICAgICAgICAgICAgICAgICAgICBtaWRZID0gKG1pblkgKyBtYXhZKSAvIDI7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ3JlcGxhY2UnLHgseSwgJ3BhciAnLG1pZFgsbWlkWSk7CgogICAgICAgICAgICAgICAgICAgIGJ1Zi5zZXRJbnQzMigxLCBtaWRYLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgYnVmLnNldEludDMyKDUsIG1pZFksICEwKTsKICAgICAgICAgICAgICAgICAgICBidWYuc2V0VWludDMyKDksIDAsICEwKTsKICAgICAgICAgICAgICAgICAgICBzZW5kQnVmZmVyKGJ1Zik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBidWYuc2V0SW50MzIoMSwgeCwgITApOwogICAgICAgICAgICAgICAgICAgIGJ1Zi5zZXRJbnQzMig1LCB5LCAhMCk7CiAgICAgICAgICAgICAgICAgICAgYnVmLnNldFVpbnQzMig5LCAwLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgc2VuZEJ1ZmZlcihidWYpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9BR0FSQk9UT1ZIIGNoYW5nZXIgYXVzc2kg52Egc2kgbWVwIGRlIHNjcmlwdAogICAgICAgICAgICAgICAgLy94IC8gdmEgPSAoWCAtIHQgLyAyKSAvIGwgKyB5OwogICAgICAgICAgICAgICAgLy95IC8gd2EgPSAoWSAtIHUgLyAyKSAvIGwgKyB6CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdDQUxDVUwgWCA9ICcsWCx0LGwseSwndGVzdCcsKFggLSB0IC8gMikgLyBsKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAobWZnaCkgewogICAgICAgICAgICAgICAgICAgIGJnei5zZW5kKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgImFjdGlvbiIgOiA3LAogICAgICAgICAgICAgICAgICAgICAgICAieCIgOiB4IC0gb2Zmc2V0WCwKICAgICAgICAgICAgICAgICAgICAgICAgInkiIDogeSAtIG9mZnNldFkKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFtZmdoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGJhbGwgPSBxWzBdOwogICAgICAgICAgICAgICAgICAgIGlmIChiYWxsICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYmd6LnNlbmQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImFjdGlvbiIgOiA3LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIngiIDogYmFsbC54IC0gb2Zmc2V0WCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ5IiA6IGJhbGwueSAtIG9mZnNldFkKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdtb3VzZSBpbiAnLHgseSwndGVzdCcseC13aW5kb3cubWFwLm1pblgseS13aW5kb3cubWFwLm1pblksJ21hcCcsd2luZG93Lm1hcCk7CgogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgdmFyIGJhc2VTZXROaWNrID0gd2luZG8uc2V0TmljazsKICAgICAgICAgICAgd2luZG8uc2V0TmljayA9IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgICBiYXNlU2V0TmljayhuKTsKICAgICAgICAgICAgICAgIGlmICh4dCkgewogICAgICAgICAgICAgICAgICAgIHZhciBlID0ge307CiAgICAgICAgICAgICAgICAgICAgZS5hY3Rpb24gPSAzOwogICAgICAgICAgICAgICAgICAgIGUucGxheWVyTmFtZSA9IG47CiAgICAgICAgICAgICAgICAgICAgYnQuc2VuZChKU09OLnN0cmluZ2lmeShlKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gRU5EIENVU1RPTQogICAgICAgIH0KICAgIH0pKHdpbmRvdywgd2luZG93LmpRdWVyeSk7Cg==';

var removed = false;

var d = function(a) {
	if (a.src.indexOf('main_out.js') >= 0) {
		window.ok = true;
		a.parentNode.removeChild(a);
		removed = true;
		console.log('AGARBOT - removed their script');
		var b = document.createElement('script');
		b.innerHTML = window.atob(engine);
		document.head.appendChild(b)
		console.log('AGARBOTDEBUG - added ours');
	}
};
var observer = new window.WebKitMutationObserver(function(b) {
	b.forEach(function(a) {
		for (var i = 0; i < a.addedNodes.length; ++i) {
			try {
				d(a.addedNodes[i]);
			} catch (e) {
			}
		}
	});
});
observer.observe(window.document, {
	subtree : true,
	childList : true,
	attribute : false
});
var x = false;
window.onload = function() {
	$("span[data-itr=option_show_mass]").prev()[0].checked = true;
	// setShowMass(true);
	var a = document.getElementById('gamemode').getElementsByTagName('option');
	if (a.length > 0) {
		for (var i = 0; i < a.length; i++) {
			if (a[i].getAttribute('data-itr') != 'party') {
				a[i].innerHTML += ' (Bots not working)';
			}
		}
	}
	if (!document.contains(document.getElementById('minions'))) {
		var b = document.createElement('div');
		b.id = 'minions';
		b.style.cssText = "position: absolute;top: 10px;left: 10px;padding: 0 8px;font-family: 'Ubuntu'; color: white;  background-color: rgba(0, 0, 0, 0.65);width: 220px; height: 160px; ";
		if (window.infos == undefined)
			window.infos = 'D-Bots.com : connecting... (try to refresh your page)';
		//b.innerHTML = window.infos;
        var a = document.createElement('div');
        var c = document.createElement('div');
        var d = document.createElement('div');
        var e = document.createElement('div');
        var f = document.createElement('div');
        var g = document.createElement('div');
        var h = document.createElement('div');
        var i = document.createElement('div');
        var j = document.createElement('div');
        
        
        var w = window.innerWidth - 220;
       
        
        a.style.cssText = "position: absolute;top: 100px;left: 10px;padding: 0 8px;font-family: 'Ubuntu'; color: white;  ";
        c.style.cssText = "position: absolute;top: 75px;left: 10px;padding: 0 8px;font-family: 'Ubuntu'; color: white;  ";
        d.style.cssText = "position: absolute;top: 75px;right: " + w + "px;padding: 0 8px;background-color: blue; font-family: 'Ubuntu'; color: white; ";
        e.style.cssText = "position: absolute;top: 100px;right: " + w + "px;padding: 0 8px;font-family: 'Ubuntu';background-color: yellow;  ";
        f.style.cssText = "position: absolute;top: 125px;left: 10px;padding: 0 8px;font-family: 'Ubuntu'; color: white;  ";
        g.style.cssText = "position: absolute;top: 150px;left: 10px;padding: 0 8px;font-family: 'Ubuntu'; color: white;  ";
        h.style.cssText = "position: absolute;top: 125px;right: " + w + "px;padding: 0 8px;font-family: 'Ubuntu'; color: white;  background-color: red";
        i.style.cssText = "position: absolute;top: 150px;right: " + w + "px;padding: 0 8px;font-family: 'Ubuntu'; color: white; background-color:red ";
        j.style.cssText = "position: absolute;top: 30px;left: 65px;padding: 0 8px;font-family: 'Ubuntu'; color: white;  text-decoration: underline; font-size: 120% ";
       
        
        a.id = 'bots';
        f.id = 'mouse';
        g.id = 'move';
        c.id = 'time';
        d.id = 'time_left';
        e.id = 'bot_count';
        h.id = 'mouse_off';
        i.id = 'move_off';
        j.id = 'd-bots-header';
        
        a.innerHTML = 'Bots:';
        c.innerHTML = 'Time left:';
        d.innerHTML = 'Not Connected';
        e.innerHTML = '0';
        f.innerHTML = 'Mouse Control:';
        g.innerHTML = 'Stop Move:';
        h.innerHTML = 'OFF';
        i.innerHTML = 'OFF';
        j.innerHTML = 'D-Bots.com';
        
        document.body.appendChild(b);
        document.body.appendChild(a);
        document.body.appendChild(d);
        document.body.appendChild(e);
        document.body.appendChild(c);
        document.body.appendChild(f);
        document.body.appendChild(g);
        document.body.appendChild(i);
        document.body.appendChild(h);
        document.body.appendChild(j);
        
		/*
		 * setTimeout(function(){ b.innerHTML = ''; },15000);
		 */
	}
    
    var key = localStorage.getItem('key');
    
   
    
	$("span[data-itr=instructions_w]")
			.append(
					'<br /><span style="font-size=xx-large;color:red;font-weight:bold">BOT INFO:</span><br />No plan active ? Check that you have correctly updated your IP ?<br />Press <b>T</b> to togle mouse movement<br />Press <b>R</b> to eject mass from your bot<br />Press <b>E</b> to split your bot (<b>Shift+E</b> fastSplit bots)<br />Press <b>D</b> to stop moving<br />Press <b>Shift+space</b> to fast split<br />Features : Infinite zoom<br />')
			.append(
					'<span style="color:red">FFA WITH BOTS IS NOT WORKING</span><br />You need to enter the game for the bots to connect,if the bot isn\'t working try to refresh the page<br /><br /><a href="http://d-bots.com">D-Bots.com</a> Disclaimer : <br />Remember that we have no link of any sort with agar.io and the bots can suddenly stop working if agar.io update its game. We will try our best to have our bot solution working and we won\'t refund you if its not.');
	$('#openfl-overlay').remove()
};

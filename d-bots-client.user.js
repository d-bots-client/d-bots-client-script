// ==UserScript==
// @name         d-bots-client
// @namespace    http://github.com/d-bots-client/
// @version      0.01
// @description  to be writen
// @author       David
// @license      
// @match        http://agar.io/*
// @require      https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.4/socket.io.min.js
// @grant        none
// @run-at       document-start
// ==/UserScript==

//http://agar.io/img/background.png

var engine = 'CiAgICAoZnVuY3Rpb24gKGMsIGUpIHsKICAgICAgICB2YXIgZmlyc3QgPSB0cnVlOwogICAgICAgIHZhciB3cyA9IG51bGw7CiAgICAgICAgdmFyIGxhc3Rfd3MgPSBudWxsOwogICAgICAgIGZ1bmN0aW9uIHVhKGEsIGIpIHsKICAgICAgICAgICAgaWYgKGIpIHsKICAgICAgICAgICAgICAgIHZhciBkID0gbmV3IERhdGU7CiAgICAgICAgICAgICAgICBkLnNldFRpbWUoZC5nZXRUaW1lKCkgKyA4NjRFNSAqIGIpOwogICAgICAgICAgICAgICAgZCA9ICI7IGV4cGlyZXM9IiArIGQudG9HTVRTdHJpbmcoKQogICAgICAgICAgICB9IGVsc2UgZCA9ICIiOwogICAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiYWdhcmlvX3JlZGlyZWN0PSIgKyBhICsgZCArICI7IHBhdGg9LyIKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRjKCkgewogICAgICAgICAgICBmb3IgKHZhciBhID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCI7IiksIGIgPSAwOyBiIDwgYS5sZW5ndGg7IGIrKykgewogICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9IGFbYl07CiAgICAgICAgICAgICAgICAgICAgIiAiID09IGQuY2hhckF0KDApIDspIGQgPSBkLnN1YnN0cmluZygxLCBkLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBpZiAoMCA9PSBkLmluZGV4T2YoImFnYXJpb19yZWRpcmVjdD0iKSkgcmV0dXJuIGQuc3Vic3RyaW5nKDE2LCBkLmxlbmd0aCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gSWIoKSB7CiAgICAgICAgICAgIGMub25rZXlkb3duID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgIC8vQUdBUkJPVE9WSCBDRSBDT0RFIEEgUkFQQVRSSUVSIERBTlMgTk9UUkVLRVlET1dOCiAgICAgICAgICAgICAgICBpZiAoYS5rZXlDb2RlID09IDY5KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VtaXQgc3BsaXQgISB3aXRoIGlwOiAnKTsKICAgICAgICAgICAgICAgICAgICBzb2NrZXQuZW1pdCgnc3BsaXQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJjbGllbnRfdXVpZCI6IDEwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoYS5rZXlDb2RlID09IDgyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VtaXQgZmVlZCAhd2l0aCBpcDogJyk7CiAgICAgICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2ZlZWQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJjbGllbnRfdXVpZCI6IDEwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgMzIgIT0gYS5rZXlDb2RlIHx8IHZhIHx8ICgibmljayIgIT0gYS50YXJnZXQuaWQgJiYgYS5wcmV2ZW50RGVmYXVsdCgpLCBlYigpLCB2YSA9ICEwKTsKICAgICAgICAgICAgICAgIDgxID09IGEua2V5Q29kZSAmJiAoWCgxOCksIHdhID0gITApOwogICAgICAgICAgICAgICAgODcgIT0gYS5rZXlDb2RlIHx8IHhhIHx8IChKYigpLCB4YSA9ICEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAyNyA9PSBhLmtleUNvZGUgJiYgKGEucHJldmVudERlZmF1bHQoKSwgeWEoMzAwKSwgZSgiI29mZXJ3YWxsQ29udGFpbmVyIikuaXMoIjp2aXNpYmxlIikgJiYgYy5jbG9zZU9mZmVyd2FsbCgpLCBlKCIjdmlkZW9Db250YWluZXIiKS5pcygiOnZpc2libGUiKSAmJiBjLmNsb3NlVmlkZW9Db250YWluZXIoKSkKICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYy5vbmtleXVwID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgIDMyID09IGEua2V5Q29kZSAmJiAodmEgPSAhMSk7CiAgICAgICAgICAgICAgICA4NyA9PSBhLmtleUNvZGUgJiYgKHhhID0gITEpOwogICAgICAgICAgICAgICAgODEgPT0gYS5rZXlDb2RlICYmIHdhICYmIChYKDE5KSwgd2EgPSAhMSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gS2IoYSkgewogICAgICAgICAgICBhLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIC8vIEFHQVJCT1RPVkgKICAgICAgICAgICAgUCAqPSBNYXRoLnBvdyguOSwgYS53aGVlbERlbHRhIC8gLTEyMCB8fCBhLmRldGFpbCB8fCAwKTsKICAgICAgICAgICAgaWYgKDEgPCBQKQogICAgICAgICAgICAgICAgUCA9IDE7CiAgICAgICAgICAgIC8qCiAgICAgICAgICAgIFAgKj0gTWF0aC5wb3coLjksIGEud2hlZWxEZWx0YSAvIC0xMjAgfHwgYS5kZXRhaWwgfHwgMCk7CiAgICAgICAgICAgIDEgPiBQICYmIChQID0gMSk7CiAgICAgICAgICAgIFAgPiA0IC8gbCAmJiAoUCA9IDQgLyBsKSovCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB1YygpIHsKICAgICAgICAgICAgaWYgKC40ID4gbCkgaWEgPSBudWxsOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGEgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIGIgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIGQgPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIGMgPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIGcgPSAwOyBnIDwgQS5sZW5ndGg7IGcrKykgewogICAgICAgICAgICAgICAgICAgIHZhciBlID0gQVtnXTsKICAgICAgICAgICAgICAgICAgICAhZS5SKCkgfHwgZS5WIHx8IDIwID49IGUuc2l6ZSAqIGwgfHwgKGEgPSBNYXRoLm1pbihlLnggLSBlLnNpemUsIGEpLCBiID0gTWF0aC5taW4oZS55IC0gZS5zaXplLCBiKSwgZCA9IE1hdGgubWF4KGUueCArIGUuc2l6ZSwgZCksIGMgPSBNYXRoLm1heChlLnkgKyBlLnNpemUsIGMpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWEgPSB2Yy5pbml0KHsKICAgICAgICAgICAgICAgICAgICB6YTogYSAtIDEwLAogICAgICAgICAgICAgICAgICAgIEFhOiBiIC0gMTAsCiAgICAgICAgICAgICAgICAgICAgeGE6IGQgKyAxMCwKICAgICAgICAgICAgICAgICAgICB5YTogYyArIDEwLAogICAgICAgICAgICAgICAgICAgIEhhOiAyLAogICAgICAgICAgICAgICAgICAgIElhOiA0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGZvciAoZyA9IDA7IGcgPCBBLmxlbmd0aDsgZysrKQogICAgICAgICAgICAgICAgICAgIGlmIChlID0gQVtnXSwgZS5SKCkgJiYgISgyMCA+PSBlLnNpemUgKiBsKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChhID0gMDsgYSA8IGUuYS5sZW5ndGg7ICsrYSkgYiA9IGUuYVthXS54LCBkID0gZS5hW2FdLnksIGIgPCB5IC0gciAvIDIgLyBsIHx8IGQgPCB6IC0gdCAvIDIgLyBsIHx8IGIgPiB5ICsgciAvIDIgLyBsIHx8IGQgPiB6ICsgdCAvIDIgLyBsIHx8IGlhLnRhKGUuYVthXSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZmIoKSB7CiAgICAgICAgICAgIHphID0gKFkgLSByIC8gMikgLyBsICsgeTsKICAgICAgICAgICAgQWEgPSAoWiAtIHQgLyAyKSAvIGwgKyB6CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBMYigpIHsKICAgICAgICAgICAgbnVsbCA9PSBCYSAmJiAoQmEgPSB7fSwgZSgiI3JlZ2lvbiIpLmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IGUodGhpcyksCiAgICAgICAgICAgICAgICAgICAgYiA9IGEudmFsKCk7CiAgICAgICAgICAgICAgICBiICYmIChCYVtiXSA9IGEudGV4dCgpKQogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGUuZ2V0KENhICsgImluZm8iLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgdmFyIGIgPSB7fSwKICAgICAgICAgICAgICAgICAgICBkOwogICAgICAgICAgICAgICAgZm9yIChkIGluIGEucmVnaW9ucykgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gZC5zcGxpdCgiOiIpWzBdOwogICAgICAgICAgICAgICAgICAgIGJbY10gPSBiW2NdIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgYltjXSArPSBhLnJlZ2lvbnNbZF0ubnVtUGxheWVycwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChkIGluIGIpIGUoJyNyZWdpb24gb3B0aW9uW3ZhbHVlPSInICsgZCArICciXScpLnRleHQoQmFbZF0gKyAiICgiICsgYltkXSArICIgcGxheWVycykiKQogICAgICAgICAgICB9LCAianNvbiIpCiAgICAgICAgfQoKCiAgICAgICAgZnVuY3Rpb24gTWIoKSB7CiAgICAgICAgICAgIGUoIiNhZHNCb3R0b20iKS5oaWRlKCk7CiAgICAgICAgICAgIGUoIiNvdmVybGF5cyIpLmhpZGUoKTsKICAgICAgICAgICAgZSgiI3N0YXRzIikuaGlkZSgpOwogICAgICAgICAgICBlKCIjbWFpblBhbmVsIikuaGlkZSgpOwogICAgICAgICAgICBhYSA9IGphID0gITE7CiAgICAgICAgICAgIE5iKCk7CiAgICAgICAgICAgIGMuZGVzdHJveUFkKGMuYWRTbG90cy5hYSk7CiAgICAgICAgICAgIGMuZGVzdHJveUFkKGMuYWRTbG90cy5hYykKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIERhKGEpIHsKICAgICAgICAgICAgYSAmJiAoYSA9PSBHID8gZSgiLmJ0bi1uZWVkcy1zZXJ2ZXIiKS5wcm9wKCJkaXNhYmxlZCIsICExKSA6IChlKCIjcmVnaW9uIikudmFsKCkgIT0gYSAmJiBlKCIjcmVnaW9uIikudmFsKGEpLCBHID0gYy5sb2NhbFN0b3JhZ2UubG9jYXRpb24gPSBhLCBlKCIucmVnaW9uLW1lc3NhZ2UiKS5oaWRlKCksIGUoIi5yZWdpb24tbWVzc2FnZS4iICsgYSkuc2hvdygpLCBlKCIuYnRuLW5lZWRzLXNlcnZlciIpLnByb3AoImRpc2FibGVkIiwgITEpLCBnYiAmJiBRKCkpKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24geWEoYSkgewogICAgICAgICAgICBqYSB8fCBhYSB8fCAoRWEgPyBlKCIuYnRuLXNwZWN0YXRlIikucHJvcCgiZGlzYWJsZWQiLCAhMCkgOiBlKCIuYnRuLXNwZWN0YXRlIikucHJvcCgiZGlzYWJsZWQiLCAhMSksIE4gPSBudWxsLCBoYiB8fCAoZSgiI2Fkc0JvdHRvbSIpLnNob3coKSwgZSgiI2czMDB4MjUwIikuaGlkZSgpLCBlKCIjYTMwMHgyNTAiKS5zaG93KCksIGUoIiNnNzI4eDkwIikuaGlkZSgpLCBlKCIjYTcyOHg5MCIpLnNob3coKSksIGMucmVmcmVzaEFkKGhiID8gYy5hZFNsb3RzLmFjIDogYy5hZFNsb3RzLmFhKSwgaGIgPSAhMSwgMUUzID4gYSAmJiAoQiA9IDEpLCBqYSA9ICEwLCBlKCIjbWFpblBhbmVsIikuc2hvdygpLCAwIDwgYSA/IGUoIiNvdmVybGF5cyIpLmZhZGVJbihhKSA6IGUoIiNvdmVybGF5cyIpLnNob3coKSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGthKGEpIHsKICAgICAgICAgICAgZSgiI2hlbGxvQ29udGFpbmVyIikuYXR0cigiZGF0YS1nYW1lbW9kZSIsIGEpOwogICAgICAgICAgICBsYSA9IGE7CiAgICAgICAgICAgIGUoIiNnYW1lbW9kZSIpLnZhbChhKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gTmIoKSB7CiAgICAgICAgICAgIGUoIiNyZWdpb24iKS52YWwoKSA/IGMubG9jYWxTdG9yYWdlLmxvY2F0aW9uID0gZSgiI3JlZ2lvbiIpLnZhbCgpIDogYy5sb2NhbFN0b3JhZ2UubG9jYXRpb24gJiYgZSgiI3JlZ2lvbiIpLnZhbChjLmxvY2FsU3RvcmFnZS5sb2NhdGlvbik7CiAgICAgICAgICAgIGUoIiNyZWdpb24iKS52YWwoKSA/IGUoIiNsb2NhdGlvbktub3duIikuYXBwZW5kKGUoIiNyZWdpb24iKSkgOiBlKCIjbG9jYXRpb25Vbmtub3duIikuYXBwZW5kKGUoIiNyZWdpb24iKSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGliKGEpIHsKICAgICAgICAgICAgImVudl9sb2NhbCIgaW4gRW52Q29uZmlnID8gInRydWUiID09IEVudkNvbmZpZy5sb2FkX2xvY2FsX2NvbmZpZ3VyYXRpb24gPyBjLk1DLnVwZGF0ZUNvbmZpZ3VyYXRpb25JRCgiYmFzZSIpIDogYy5NQy51cGRhdGVDb25maWd1cmF0aW9uSUQoRW52Q29uZmlnLmNvbmZpZ0lEKSA6IGMuTUMudXBkYXRlQ29uZmlndXJhdGlvbklEKGEpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB3YygpIHsKICAgICAgICAgICAgImNvbmZpZ0lEIiBpbiBEID8gaWIoRC5jb25maWdJRCkgOiBlLmdldChDYSArICJnZXRMYXRlc3RJRCIsIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICBpYihhKTsKICAgICAgICAgICAgICAgIGMubG9jYWxTdG9yYWdlLmxhc3RfY29uZmlnX2lkID0gYQogICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICAgICAgaWYgKGEgPSAibGFzdF9jb25maWdfaWQiIGluIGMubG9jYWxTdG9yYWdlKSBhID0gYy5sb2NhbFN0b3JhZ2UubGFzdF9jb25maWdfaWQsIGEgPSAhKG51bGwgPT0gYSB8fCB2b2lkIDAgPT0gYSB8fCAiIiA9PT0gYSk7CiAgICAgICAgICAgICAgICBhICYmIChhID0gYy5sb2NhbFN0b3JhZ2UubGFzdF9jb25maWdfaWQsIGNvbnNvbGUubG9nKCJGYWxsYmFjayB0byBzdG9yZWQgY29uZmlnSUQ6ICIgKyBhKSwgaWIoYSkpCiAgICAgICAgICAgIH0pCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB4YygpIHsKICAgICAgICAgICAgZS5nZXQoamIgKyAiLy9nYy5hZ2FyLmlvIiwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgIHZhciBiID0gYS5zcGxpdCgiICIpOwogICAgICAgICAgICAgICAgYSA9IGJbMF07CiAgICAgICAgICAgICAgICBiID0gYlsxXSB8fCAiIjsgLTEgPT0gWyJVQSJdLmluZGV4T2YoYSkgJiYgT2IucHVzaCgidXNzciIpOwogICAgICAgICAgICAgICAgbWEuaGFzT3duUHJvcGVydHkoYSkgJiYgKCJzdHJpbmciID09IHR5cGVvZiBtYVthXSA/IEcgfHwgRGEobWFbYV0pIDogbWFbYV0uaGFzT3duUHJvcGVydHkoYikgJiYgKEcgfHwgRGEobWFbYV1bYl0pKSkKICAgICAgICAgICAgfSwgInRleHQiKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gUihhKSB7CiAgICAgICAgICAgIHJldHVybiBjLmkxOG5bYV0gfHwgYy5pMThuX2RpY3QuZW5bYV0gfHwgYQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gUGIoKSB7CiAgICAgICAgICAgIHZhciBhID0gKytrYjsKICAgICAgICAgICAgY29uc29sZS5sb2coIkZpbmQgIiArIEcgKyBsYSk7CiAgICAgICAgICAgIFFiKCk7CiAgICAgICAgICAgIGUuYWpheChDYSArICJmaW5kU2VydmVyIiwgewogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRmFpbGVkIHRvIGdldCBzZXJ2ZXIuIFdpbGwgcmV0cnkgaW4gMzAgc2Vjb25kcyIpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoUGIsIDNFNCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoYikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGIpOwogICAgICAgICAgICAgICAgICAgIGlmIChhID09IGtiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuYWxlcnQgJiYgYWxlcnQoYi5hbGVydCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYi5pcDsKICAgICAgICAgICAgICAgICAgICAgICAgImdhbWVfc2VydmVyX3BvcnQiIGluIEVudkNvbmZpZyAmJiAoZCA9IGMubG9jYXRpb24uaG9zdG5hbWUgKyAiOiIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgRW52Q29uZmlnLmdhbWVfc2VydmVyX3BvcnQpOwogICAgICAgICAgICAgICAgICAgICAgICBsYigid3MiICsgKG1iID8gInMiIDogIiIpICsgIjovLyIgKyBkLCBiLnRva2VuKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgICAgICAgICBjYWNoZTogITEsCiAgICAgICAgICAgICAgICBjcm9zc0RvbWFpbjogITAsCiAgICAgICAgICAgICAgICBkYXRhOiAoRyArIGxhIHx8ICI/IikgKyAiXG4yMjAwMDQ5NzE1IgogICAgICAgICAgICB9KQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gUSgpIHsKICAgICAgICAgICAgZ2IgJiYgRyAmJiAoZSgiI2Nvbm5lY3RpbmciKS5zaG93KCksIFBiKCkpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBRYigpIHsKICAgICAgICAgICAgaWYgKHcpIHsKICAgICAgICAgICAgICAgIHcub25vcGVuID0gbnVsbDsKICAgICAgICAgICAgICAgIHcub25tZXNzYWdlID0gbnVsbDsKICAgICAgICAgICAgICAgIHcub25jbG9zZSA9IG51bGw7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHcuY2xvc2UoKQogICAgICAgICAgICAgICAgfSBjYXRjaCAoYSkgeyB9CiAgICAgICAgICAgICAgICB3ID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsYihhLCBiKSB7CiAgICAgICAgICAgIFFiKCk7CiAgICAgICAgICAgIEQuaXAgJiYgKGEgPSAid3MiICsgKG1iID8gInMiIDogIiIpICsgIjovLyIgKyBELmlwKTsKICAgICAgICAgICAgaWYgKG51bGwgIT0gUykgewogICAgICAgICAgICAgICAgdmFyIGQgPSBTOwogICAgICAgICAgICAgICAgUyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBkKGIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1iICYmICFFbnZDb25maWcuZW52X2RldmVsb3BtZW50ICYmICFFbnZDb25maWcuZW52X2xvY2FsKSB7CiAgICAgICAgICAgICAgICB2YXIgYyA9IGEuc3BsaXQoIjoiKTsKICAgICAgICAgICAgICAgIGEgPSAid3NzOi8vaXAtIiArIGNbMV0ucmVwbGFjZSgvXC4vZywgIi0iKS5yZXBsYWNlKC9cLy9nLCAiIikgKyAiLnRlY2guYWdhci5pbzoiICsgK2NbMl0KICAgICAgICAgICAgfQogICAgICAgICAgICBFID0gW107CiAgICAgICAgICAgIHEgPSBbXTsKICAgICAgICAgICAgSyA9IHt9OwogICAgICAgICAgICBBID0gW107CiAgICAgICAgICAgIGJhID0gW107CiAgICAgICAgICAgIEMgPSBbXTsKICAgICAgICAgICAgSCA9IEkgPSBudWxsOwogICAgICAgICAgICBUID0gMDsKICAgICAgICAgICAgbmEgPSAhMTsKICAgICAgICAgICAgY29uc29sZS5sb2coIkNvbm5lY3RpbmcgdG8gIiArIGEpOwogICAgICAgICAgICB3cyA9IGE7ICAgICAgICAgICAgCiAgICAgICAgICAgIG0uY2FjaGUuc2VudEdhbWVTZXJ2ZXJMb2dpbiA9ICExOwogICAgICAgICAgICB3ID0gbmV3IFdlYlNvY2tldChhKTsKICAgICAgICAgICAgdy5iaW5hcnlUeXBlID0gImFycmF5YnVmZmVyIjsKICAgICAgICAgICAgLy8gQUdBUkJPVE9WSAogICAgICAgICAgICBpcCA9IGE7CiAgICAgICAgICAgIHJvb20gPSBiOwogICAgICAgICAgICBjaGFuZ2VHYW1lTW9kZSgpOwogICAgICAgICAgICB3Lm9ub3BlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICAgICAgRmEgPSB4ID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgICAgIG9hID0gMTIwOwogICAgICAgICAgICAgICAgR2EgPSAwOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coInNvY2tldCBvcGVuIik7CiAgICAgICAgICAgICAgICBhID0gVSg1KTsKICAgICAgICAgICAgICAgIGEuc2V0VWludDgoMCwgMjU0KTsKICAgICAgICAgICAgICAgIGEuc2V0VWludDMyKDEsIDUsICEwKTsKICAgICAgICAgICAgICAgIFYoYSk7CiAgICAgICAgICAgICAgICBhID0gVSg1KTsKICAgICAgICAgICAgICAgIGEuc2V0VWludDgoMCwgMjU1KTsKICAgICAgICAgICAgICAgIGEuc2V0VWludDMyKDEsIDIyMDAwNDk3MTUsICEwKTsKICAgICAgICAgICAgICAgIFYoYSk7CiAgICAgICAgICAgICAgICBhID0gVSgxICsgYi5sZW5ndGgpOwogICAgICAgICAgICAgICAgYS5zZXRVaW50OCgwLCA4MCk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBkID0gMDsgZCA8IGIubGVuZ3RoOyArK2QpIGEuc2V0VWludDgoZCArIDEsIGIuY2hhckNvZGVBdChkKSk7CiAgICAgICAgICAgICAgICBWKGEpOwogICAgICAgICAgICAgICAgbS5jb3JlLnByb3h5Lm9uU29ja2V0T3BlbigpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHcub25tZXNzYWdlID0geWM7CiAgICAgICAgICAgIHcub25jbG9zZSA9IHpjOwogICAgICAgICAgICB3Lm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhIYS5MKCkgKyAiIHNvY2tldCBlcnJvciIsIGFyZ3VtZW50cykKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gVShhKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0YVZpZXcobmV3IEFycmF5QnVmZmVyKGEpKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gVihhKSB7CiAgICAgICAgICAgIHcuc2VuZChhLmJ1ZmZlcikKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHpjKCkgewogICAgICAgICAgICBuYSAmJiAoSWEgPSA1MDApOwogICAgICAgICAgICBtLmNvcmUucHJveHkub25Tb2NrZXRDbG9zZWQoKTsKICAgICAgICAgICAgY29uc29sZS5sb2coSGEuTCgpICsgIiBzb2NrZXQgY2xvc2UiKTsKICAgICAgICAgICAgc2V0VGltZW91dChRLCBJYSk7CiAgICAgICAgICAgIElhICo9IDIKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHljKGEpIHsKICAgICAgICAgICAgQWMobmV3IERhdGFWaWV3KGEuZGF0YSkpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBBYyhhKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIGIoKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBiID0gIiI7IDspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEuZ2V0VWludDE2KGQsICEwKTsKICAgICAgICAgICAgICAgICAgICBkICs9IDI7CiAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT0gYykgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgYiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYgogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBkID0gMDsKICAgICAgICAgICAgaWYgKDI0MCA9PSBhLmdldFVpbnQ4KGQpKSBKYSgpOwogICAgICAgICAgICBlbHNlIHN3aXRjaCAoYS5nZXRVaW50OChkKyspKSB7CiAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgIEJjKGEsIGQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgICAgICBwYSA9IGEuZ2V0RmxvYXQzMihkLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgZCArPSA0OwogICAgICAgICAgICAgICAgICAgIHFhID0gYS5nZXRGbG9hdDMyKGQsICEwKTsKICAgICAgICAgICAgICAgICAgICBkICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgcmEgPSBhLmdldEZsb2F0MzIoZCwgITApOwogICAgICAgICAgICAgICAgICAgIGQgKz0gNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICAgICAgRSA9IFtdOwogICAgICAgICAgICAgICAgICAgIHEgPSBbXTsKICAgICAgICAgICAgICAgICAgICBLID0ge307CiAgICAgICAgICAgICAgICAgICAgQSA9IFtdOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICBxID0gW107CiAgICAgICAgICAgICAgICAgICAgRSA9IFtdOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgICBuYiA9IGEuZ2V0SW50MTYoZCwgITApOwogICAgICAgICAgICAgICAgICAgIGQgKz0gMjsKICAgICAgICAgICAgICAgICAgICBvYiA9IGEuZ2V0SW50MTYoZCwgITApOwogICAgICAgICAgICAgICAgICAgIGQgKz0gMjsKICAgICAgICAgICAgICAgICAgICBwYiB8fCAocGIgPSAhMCwgS2EgPSBuYiwgTGEgPSBvYik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICAgICAgICAgIEUucHVzaChhLmdldFVpbnQzMihkLCAhMCkpOwogICAgICAgICAgICAgICAgICAgIGQgKz0gNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNDk6CiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gSSkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgdmFyIHUgPSBhLmdldFVpbnQzMihkLCAhMCksCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBkICsgNDsKICAgICAgICAgICAgICAgICAgICBDID0gW107CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZyA9IDA7IGcgPCB1OyArK2cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBhLmdldFVpbnQzMihkLCAhMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gZCArIDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIEMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGIoKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoeHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQUdBUkJPVE9WSAogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWJvID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIGFiby5hY3Rpb24gPSA0OwogICAgICAgICAgICAgICAgICAgICAgICBhYm8ubGVhZGVyQm9hcmQgPSBDOwogICAgICAgICAgICAgICAgICAgICAgICBidC5zZW5kKEpTT04uc3RyaW5naWZ5KGFibykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBSYigpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgICAgICAgICBJID0gW107CiAgICAgICAgICAgICAgICAgICAgdSA9IGEuZ2V0VWludDMyKGQsICEwKTsKICAgICAgICAgICAgICAgICAgICBkICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gMDsgZyA8IHU7ICsrZykgSS5wdXNoKGEuZ2V0RmxvYXQzMihkLCAhMCkpLCBkICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgUmIoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNjQ6CiAgICAgICAgICAgICAgICAgICAgTWEgPSBhLmdldEZsb2F0NjQoZCwgITApOwogICAgICAgICAgICAgICAgICAgIGQgKz0gODsKICAgICAgICAgICAgICAgICAgICBOYSA9IGEuZ2V0RmxvYXQ2NChkLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgZCArPSA4OwogICAgICAgICAgICAgICAgICAgIE9hID0gYS5nZXRGbG9hdDY0KGQsICEwKTsKICAgICAgICAgICAgICAgICAgICBkICs9IDg7CiAgICAgICAgICAgICAgICAgICAgUGEgPSBhLmdldEZsb2F0NjQoZCwgITApOwogICAgICAgICAgICAgICAgICAgIG1hcENvb3JkcyhNYSwgTmEsIE9hLCBQYSk7CiAgICAgICAgICAgICAgICAgICAgZCArPSA4OwogICAgICAgICAgICAgICAgICAgIHBhID0gKE9hICsgTWEpIC8gMjsKICAgICAgICAgICAgICAgICAgICBxYSA9IChQYSArIE5hKSAvIDI7CiAgICAgICAgICAgICAgICAgICAgcmEgPSAxOwogICAgICAgICAgICAgICAgICAgIDAgPT0gcS5sZW5ndGggJiYgKHkgPSBwYSwgeiA9IHFhLCBsID0gcmEpOwogICAgICAgICAgICAgICAgICAgIGEuYnl0ZUxlbmd0aCA+IGQgJiYgKHUgPSBhLmdldFVpbnQzMihkLCAhMCksIGQgKz0gNCwgcWIgPSAhISh1ICYgMSksIHJiID0gYigpLCBjLk1DLnVwZGF0ZVNlcnZlclZlcnNpb24ocmIpLCBjb25zb2xlLmxvZygiU2VydmVyIHZlcnNpb24gIiArIHJiKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDEwMjoKICAgICAgICAgICAgICAgICAgICB1ID0gYS5idWZmZXIuc2xpY2UoZCk7CiAgICAgICAgICAgICAgICAgICAgbS5jb3JlLnByb3h5LmZvcndhcmRQcm90b01lc3NhZ2UodSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDEwNDoKICAgICAgICAgICAgICAgICAgICBjLmxvZ291dCgpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIEJjKGEsIGIpIHsKICAgICAgICAgICAgZnVuY3Rpb24gZCgpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGQgPSAiIjsgOykgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gYS5nZXRVaW50MTYoYiwgITApOwogICAgICAgICAgICAgICAgICAgIGIgKz0gMjsKICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PQogICAgICAgICAgICAgICAgICAgICAgICBjKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBkICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHUoKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBkID0gIiI7IDspIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEuZ2V0VWludDgoYisrKTsKICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PSBjKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBkICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgeCA9IERhdGUubm93KCk7CiAgICAgICAgICAgIHZhciBnID0geCAtIEZhOwogICAgICAgICAgICBGYSA9IHg7CiAgICAgICAgICAgIG9hID0gQ2MgKiBvYSArIERjICogZzsKICAgICAgICAgICAgR2EgPSBFYyAqIEdhICsgRmMgKiBNYXRoLmFicyhnIC0gb2EpOwogICAgICAgICAgICBtLmNvcmUuZGVidWcgJiYgKG0uZGVidWcudXBkYXRlQ2hhcnQoIm5ldHdvcmtVcGRhdGUiLCB4LCBnKSwgbS5kZWJ1Zy51cGRhdGVDaGFydCgicnR0TWVhbiIsIHgsIG9hKSwgbS5kZWJ1Zy51cGRhdGVDaGFydCgicnR0U0RldiIsIHgsIEdhKSk7CiAgICAgICAgICAgIG5hIHx8IChuYSA9ICEwLCBlKCIjY29ubmVjdGluZyIpLmhpZGUoKSwgU2IoKSwgUyAmJiAoUygpLCBTID0gbnVsbCkpOwogICAgICAgICAgICBzYiA9ICExOwogICAgICAgICAgICBnID0gYS5nZXRVaW50MTYoYiwgITApOwogICAgICAgICAgICBiICs9IDI7CiAgICAgICAgICAgIGZvciAodmFyIHAgPSAwOyBwIDwgZzsgKytwKSB7CiAgICAgICAgICAgICAgICB2YXIgTCA9IEtbYS5nZXRVaW50MzIoYiwgITApXSwKICAgICAgICAgICAgICAgICAgICBrID0gS1thLmdldFVpbnQzMihiICsgNCwgITApXTsKICAgICAgICAgICAgICAgIGIgKz0gODsKICAgICAgICAgICAgICAgIEwgJiYgayAmJiAoay5jYSgpLCBrLnMgPSBrLngsIGsudSA9IGsueSwgay5vID0gay5zaXplLCBrLm5hKEwueCwgTC55KSwgay5nID0gay5zaXplLCBrLlUgPSB4LCBHYyhMLCBrKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKHAgPSAwOyA7KSB7CiAgICAgICAgICAgICAgICBnID0gYS5nZXRVaW50MzIoYiwgITApOwogICAgICAgICAgICAgICAgYiArPSA0OwogICAgICAgICAgICAgICAgaWYgKDAgPT0gZykgYnJlYWs7CiAgICAgICAgICAgICAgICArK3A7CiAgICAgICAgICAgICAgICB2YXIgdGIsIEwgPSBhLmdldEludDMyKGIsICEwKTsKICAgICAgICAgICAgICAgIGIgKz0gNDsKICAgICAgICAgICAgICAgIGsgPSBhLmdldEludDMyKGIsICEwKTsKICAgICAgICAgICAgICAgIGIgKz0gNDsKICAgICAgICAgICAgICAgIHRiID0gYS5nZXRJbnQxNihiLCAhMCk7CiAgICAgICAgICAgICAgICBiICs9IDI7CiAgICAgICAgICAgICAgICB2YXIgbiA9IGEuZ2V0VWludDgoYisrKSwKICAgICAgICAgICAgICAgICAgICBmID0gYS5nZXRVaW50OChiKyspLAogICAgICAgICAgICAgICAgICAgIGggPSBhLmdldFVpbnQ4KGIrKyksCiAgICAgICAgICAgICAgICAgICAgZiA9IEhjKG4gPDwgMTYgfCBmIDw8IDggfCBoKSwKICAgICAgICAgICAgICAgICAgICBoID0gYS5nZXRVaW50OChiKyspLAogICAgICAgICAgICAgICAgICAgIGwgPSAhIShoICYgMSksCiAgICAgICAgICAgICAgICAgICAgciA9ICEhKGggJiAxNiksCiAgICAgICAgICAgICAgICAgICAgdCA9IG51bGw7CiAgICAgICAgICAgICAgICBoICYgMiAmJiAoYiArPSA0ICsgYS5nZXRVaW50MzIoYiwgITApKTsKICAgICAgICAgICAgICAgIGggJiA0ICYmICh0ID0gdSgpKTsKICAgICAgICAgICAgICAgIHZhciB2ID0gZCgpLAogICAgICAgICAgICAgICAgICAgIG4gPSBudWxsOwogICAgICAgICAgICAgICAgSy5oYXNPd25Qcm9wZXJ0eShnKSA/IChuID0gS1tnXSwgbi5UKCksIG4ucyA9IG4ueCwgbi51ID0gbi55LCBuLm8gPSBuLnNpemUsIG4uY29sb3IgPSBmKSA6IChuID0gbmV3IGNhKGcsIEwsIGssIHRiLCBmLCB2KSwgQS5wdXNoKG4pLCBLW2ddID0gbik7CiAgICAgICAgICAgICAgICBuLmMgPSBsOwogICAgICAgICAgICAgICAgbi5oID0gcjsKICAgICAgICAgICAgICAgIG4ubmEoTCwgayk7CiAgICAgICAgICAgICAgICBuLmcgPSB0YjsKICAgICAgICAgICAgICAgIG4uVSA9IHg7CiAgICAgICAgICAgICAgICBuLmVhID0gaDsKICAgICAgICAgICAgICAgIHQgJiYgKG4uQyA9IHQpOwogICAgICAgICAgICAgICAgdiAmJiBuLkEodik7IC0xICE9IEUuaW5kZXhPZihnKSAmJiAtMSA9PSBxLmluZGV4T2YobikgJiYgKHEucHVzaChuKSwgbi5JID0gITAsIDEgPT0gcS5sZW5ndGggJiYgKG4udWEgPSAhMCwgeSA9IG4ueCwgeiA9IG4ueSwgVGIoKSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm92ZXJsYXlzIikuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgRiA9IFtdLCB1YiA9IDAsIHZiID0gcVswXS5jb2xvciwgRWEgPSAhMCwgUmEgPSBEYXRlLm5vdygpLCBXID0gd2IgPSB4YiA9IDApKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEwgPSBhLmdldFVpbnQzMihiLCAhMCk7CiAgICAgICAgICAgIGIgKz0gNDsKICAgICAgICAgICAgZm9yIChwID0gMDsgcCA8IEw7IHArKykgZyA9IGEuZ2V0VWludDMyKGIsICEwKSwgYiArPSA0LCBuID0gS1tnXSwgbnVsbCAhPSBuICYmIG4uY2EoKTsKICAgICAgICAgICAgc2IgJiYgMCA9PSBxLmxlbmd0aCAmJiAoMCA9PSBjLk1DLmlzVXNlckxvZ2dlZEluKCkgPyBKYSgpIDogVWIgPSBzZXRUaW1lb3V0KEphLCAyRTMpKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gU2EoKSB7CiAgICAgICAgICAgIGlmIChkYSgpKSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IFkgLSByIC8gMiwKICAgICAgICAgICAgICAgICAgICBiID0gWiAtIHQgLyAyOwoKICAgICAgICAgICAgICAgIC8vIEFHQVJCT1RPVkgKICAgICAgICAgICAgICAgIGlmICg2NCA+IGEgKiBhICsgYiAqIGIgfHwgLjAxID4gTWF0aC5hYnMoVmIgLSB6YSkgJiYgLjAxID4gTWF0aC5hYnMoV2IgLSBBYSkgfHwgKFZiID0gemEsIFdiID0gQWEsIGEgPSBVKDEzKSwgYS5zZXRVaW50OCgwLCAxNiksIGhleShhLCB6YSwgQWEpLCB4dCkpIHsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBBR0FSQk9UT1ZICgogICAgICAgICAgICAgICAgLyogNjQgPiBhICogYSArIGIgKiBiIHx8IC4wMSA+IE1hdGguYWJzKFZiIC0KICAgICAgICAgICAgICAgICAgICAgemEpICYmIC4wMSA+IE1hdGguYWJzKFdiIC0gQWEpIHx8IChWYiA9IHphLCBXYiA9IEFhLCBhID0gVSgxMyksIGEuc2V0VWludDgoMCwgMTYpLCBhLnNldEludDMyKDEsIHphLCAhMCksIGEuc2V0SW50MzIoNSwgQWEsICEwKSwgYS5zZXRVaW50MzIoOSwgMCwgITApLCBWKGEpKQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gU2IoKSB7CiAgICAgICAgICAgIGlmIChkYSgpICYmIG5hICYmIG51bGwgIT0gTikgewogICAgICAgICAgICAgICAgdmFyIGEgPSBVKDEgKyAyICogTi5sZW5ndGgpOwogICAgICAgICAgICAgICAgLy8gQUdBUkJPVE9WSAogICAgICAgICAgICAgICAgc3RvcE1vdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoYXV0b0ZlZWRJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICBhdXRvRmVlZEludGVydmFsID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgcmVmcmVzaCgpOwogICAgICAgICAgICAgICAgLy8gQUdBUkJPVE9WSAogICAgICAgICAgICAgICAgYS5zZXRVaW50OCgwLCAwKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgTi5sZW5ndGg7ICsrYikgYS5zZXRVaW50MTYoMSArIDIgKiBiLCBOLmNoYXJDb2RlQXQoYiksICEwKTsKICAgICAgICAgICAgICAgIFYoYSk7CiAgICAgICAgICAgICAgICBOID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBlYigpIHsKICAgICAgICAgICAgU2EoKTsKICAgICAgICAgICAgWCgxNykKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIEpiKCkgewogICAgICAgICAgICBTYSgpOwogICAgICAgICAgICBYKDIxKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZGEoKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsICE9IHcgJiYgdy5yZWFkeVN0YXRlID09IHcuT1BFTgogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gWChhKSB7CiAgICAgICAgICAgIGlmIChkYSgpKSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IFUoMSk7CiAgICAgICAgICAgICAgICBiLnNldFVpbnQ4KDAsIGEpOwogICAgICAgICAgICAgICAgVihiKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBYYigpIHsKICAgICAgICAgICAgciA9IDEgKiBjLmlubmVyV2lkdGg7CiAgICAgICAgICAgIHQgPSAxICogYy5pbm5lckhlaWdodDsKICAgICAgICAgICAgeWIud2lkdGggPSBPLndpZHRoID0gcjsKICAgICAgICAgICAgeWIuaGVpZ2h0ID0gTy5oZWlnaHQgPSB0OwogICAgICAgICAgICB2YXIgYSA9IGUoIiNoZWxsb0NvbnRhaW5lciIpOwogICAgICAgICAgICBhLmNzcygidHJhbnNmb3JtIiwgIm5vbmUiKTsKICAgICAgICAgICAgdmFyIGIgPSBhLmhlaWdodCgpLAogICAgICAgICAgICAgICAgZCA9IGMuaW5uZXJIZWlnaHQ7CiAgICAgICAgICAgIDAgIT0gYiAvIDIgJSAyICYmIChiKyssIGEuaGVpZ2h0KGIpKTsKICAgICAgICAgICAgYiA+IGQgLyAxLjEgPyBhLmNzcygidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZSgiICsgZCAvIGIgLyAxLjEgKyAiKSIpIDogYS5jc3MoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoLTUwJSwgLTUwJSkiKTsKICAgICAgICAgICAgWWIoKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gWmIoKSB7CiAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICBhID0gMSAqIE1hdGgubWF4KHQgLyAxMDgwLCByIC8gMTkyMCk7CiAgICAgICAgICAgIHJldHVybiBhICo9IFAKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIEljKCkgewogICAgICAgICAgICBpZiAoMCAhPSBxLmxlbmd0aCkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgYSA9IDAsIGIgPSAwOyBiIDwgcS5sZW5ndGg7IGIrKykgYSArPSBxW2JdLnNpemU7CiAgICAgICAgICAgICAgICBsID0gKDkgKiBsICsgTWF0aC5wb3coTWF0aC5taW4oNjQgLyBhLCAxKSwgLjQpICogWmIoKSkgLyAxMAogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBZYigpIHsKICAgICAgICAgICAgdmFyIGEsIGIgPSBEYXRlLm5vdygpOwogICAgICAgICAgICArK0pjOwogICAgICAgICAgICAkYiAmJiAoKytUYSwgMTgwIDwgVGEgJiYgKFRhID0gMCkpOwogICAgICAgICAgICB4ID0KICAgICAgICAgICAgICAgIGI7CiAgICAgICAgICAgIGlmICgwIDwgcS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIEljKCk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBkID0gYSA9IDAsIGMgPSAwOyBjIDwgcS5sZW5ndGg7IGMrKykgcVtjXS5UKCksIGEgKz0gcVtjXS54IC8gcS5sZW5ndGgsIGQgKz0gcVtjXS55IC8gcS5sZW5ndGg7CiAgICAgICAgICAgICAgICBwYSA9IGE7CiAgICAgICAgICAgICAgICBxYSA9IGQ7CiAgICAgICAgICAgICAgICByYSA9IGw7CiAgICAgICAgICAgICAgICB5ID0gKHkgKyBhKSAvIDI7CiAgICAgICAgICAgICAgICB6ID0gKHogKyBkKSAvIDIKICAgICAgICAgICAgfSBlbHNlIHkgPSAoMjkgKiB5ICsgcGEpIC8gMzAsIHogPSAoMjkgKiB6ICsgcWEpIC8gMzAsIGwgPSAoOSAqIGwgKyByYSAqIFpiKCkpIC8gMTA7CiAgICAgICAgICAgIHVjKCk7CiAgICAgICAgICAgIGZiKCk7CiAgICAgICAgICAgIHpiIHx8IGYuY2xlYXJSZWN0KDAsIDAsIHIsIHQpOwogICAgICAgICAgICB6YiA/IChmLmZpbGxTdHlsZSA9IGVhID8gIiMxMTExMTEiIDogIiNGMkZCRkYiLCBmLmdsb2JhbEFscGhhID0gLjA1LCBmLmZpbGxSZWN0KDAsIDAsIHIsIHQpLCBmLmdsb2JhbEFscGhhID0gMSkgOiBLYygpOwogICAgICAgICAgICBBLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhLnNpemUgPT0gYi5zaXplID8gYS5pZCAtIGIuaWQgOiBhLnNpemUgLSBiLnNpemUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGYuc2F2ZSgpOwogICAgICAgICAgICBmLnRyYW5zbGF0ZShyIC8gMiwgdCAvIDIpOwogICAgICAgICAgICBmLnNjYWxlKGwsIGwpOwogICAgICAgICAgICBmLnRyYW5zbGF0ZSgteSwgLXopOwogICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYmEubGVuZ3RoOyBjKyspIGJhW2NdLncoZik7CiAgICAgICAgICAgIGZvciAoYyA9IDA7IGMgPAogICAgICAgICAgICAgICAgQS5sZW5ndGg7IGMrKykgQVtjXS53KGYpOwogICAgICAgICAgICBpZiAocGIpIHsKICAgICAgICAgICAgICAgIEthID0gKDMgKiBLYSArIG5iKSAvIDQ7CiAgICAgICAgICAgICAgICBMYSA9ICgzICogTGEgKyBvYikgLyA0OwogICAgICAgICAgICAgICAgZi5zYXZlKCk7CiAgICAgICAgICAgICAgICBmLnN0cm9rZVN0eWxlID0gIiNGRkFBQUEiOwogICAgICAgICAgICAgICAgZi5saW5lV2lkdGggPSAxMDsKICAgICAgICAgICAgICAgIGYubGluZUNhcCA9ICJyb3VuZCI7CiAgICAgICAgICAgICAgICBmLmxpbmVKb2luID0gInJvdW5kIjsKICAgICAgICAgICAgICAgIGYuZ2xvYmFsQWxwaGEgPSAuNTsKICAgICAgICAgICAgICAgIGYuYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgcS5sZW5ndGg7IGMrKykgZi5tb3ZlVG8ocVtjXS54LCBxW2NdLnkpLCBmLmxpbmVUbyhLYSwgTGEpOwogICAgICAgICAgICAgICAgZi5zdHJva2UoKTsKICAgICAgICAgICAgICAgIGYucmVzdG9yZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZi5yZXN0b3JlKCk7CiAgICAgICAgICAgIEggJiYgSC53aWR0aCAmJiBmLmRyYXdJbWFnZShILCByIC0gSC53aWR0aCAtIDEwLCAxMCk7CiAgICAgICAgICAgIFQgPSBNYXRoLm1heChULCBhYygpKTsKICAgICAgICAgICAgMCAhPSBUICYmIChudWxsID09IFVhICYmIChVYSA9IG5ldyBWYSgyNCwgIiNGRkZGRkYiKSksIFVhLkIoUigic2NvcmUiKSArICI6ICIgKyB+fihUIC8gMTAwKSksIGQgPSBVYS5PKCksIGEgPSBkLndpZHRoLCBmLmdsb2JhbEFscGhhID0gLjIsIGYuZmlsbFN0eWxlID0gIiMwMDAwMDAiLCBmLmZpbGxSZWN0KDEwLCB0IC0gMTAgLSAyNCAtIDEwLCBhICsgMTAsIDM0KSwKICAgICAgICAgICAgICAgIGYuZ2xvYmFsQWxwaGEgPSAxLCBmLmRyYXdJbWFnZShkLCAxNSwgdCAtIDEwIC0gMjQgLSA1KSk7CiAgICAgICAgICAgIExjKCk7CiAgICAgICAgICAgIGIgPSBEYXRlLm5vdygpIC0gYjsKICAgICAgICAgICAgYiA+IDFFMyAvIDYwID8gTSAtPSAuMDEgOiBiIDwgMUUzIC8gNjUgJiYgKE0gKz0gLjAxKTsKICAgICAgICAgICAgLjQgPiBNICYmIChNID0gLjQpOwogICAgICAgICAgICAxIDwgTSAmJiAoTSA9IDEpOwogICAgICAgICAgICBiID0geCAtIGJjOwogICAgICAgICAgICAhZGEoKSB8fCBqYSB8fCBhYSA/IChCICs9IGIgLyAyRTMsIDEgPCBCICYmIChCID0gMSkpIDogKEIgLT0gYiAvIDMwMCwgMCA+IEIgJiYgKEIgPSAwKSk7CiAgICAgICAgICAgIDAgPCBCID8gKGYuZmlsbFN0eWxlID0gIiMwMDAwMDAiLCBjYyA/IChmLmdsb2JhbEFscGhhID0gQiwgZi5maWxsUmVjdCgwLCAwLCByLCB0KSwgSi5jb21wbGV0ZSAmJiBKLndpZHRoICYmIChKLndpZHRoIC8gSi5oZWlnaHQgPCByIC8gdCA/IChiID0gciwgYSA9IEouaGVpZ2h0ICogciAvIEoud2lkdGgpIDogKGIgPSBKLndpZHRoICogdCAvIEouaGVpZ2h0LCBhID0gdCksIGYuZHJhd0ltYWdlKEosIChyIC0gYikgLyAyLCAodCAtIGEpIC8gMiwgYiwgYSksIGYuZ2xvYmFsQWxwaGEgPSAuNSAqIEIsIGYuZmlsbFJlY3QoMCwgMCwgciwgdCkpKSA6IChmLmdsb2JhbEFscGhhID0gLjUgKiBCLCBmLmZpbGxSZWN0KDAsIDAsIHIsIHQpKSwgZi5nbG9iYWxBbHBoYSA9IDEpIDogY2MgPSAhMTsKICAgICAgICAgICAgYmMgPSB4CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBLYygpIHsKICAgICAgICAgICAgZi5maWxsU3R5bGUgPQogICAgICAgICAgICAgICAgZWEgPyAiIzExMTExMSIgOiAiI0YyRkJGRiI7CiAgICAgICAgICAgIGYuZmlsbFJlY3QoMCwgMCwgciwgdCk7CiAgICAgICAgICAgIGYuc2F2ZSgpOwogICAgICAgICAgICBmLnN0cm9rZVN0eWxlID0gZWEgPyAiI0FBQUFBQSIgOiAiIzAwMDAwMCI7CiAgICAgICAgICAgIGYuZ2xvYmFsQWxwaGEgPSAuMiAqIGw7CiAgICAgICAgICAgIGZvciAodmFyIGEgPSByIC8gbCwgYiA9IHQgLyBsLCBkID0gKC15ICsgYSAvIDIpICUgNTA7IGQgPCBhOyBkICs9IDUwKSBmLmJlZ2luUGF0aCgpLCBmLm1vdmVUbyhkICogbCAtIC41LCAwKSwgZi5saW5lVG8oZCAqIGwgLSAuNSwgYiAqIGwpLCBmLnN0cm9rZSgpOwogICAgICAgICAgICBmb3IgKGQgPSAoLXogKyBiIC8gMikgJSA1MDsgZCA8IGI7IGQgKz0gNTApIGYuYmVnaW5QYXRoKCksIGYubW92ZVRvKDAsIGQgKiBsIC0gLjUpLCBmLmxpbmVUbyhhICogbCwgZCAqIGwgLSAuNSksIGYuc3Ryb2tlKCk7CiAgICAgICAgICAgIGYucmVzdG9yZSgpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBMYygpIHsKICAgICAgICAgICAgaWYgKGRjICYmIEFiLndpZHRoKSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IHIgLyA1OwogICAgICAgICAgICAgICAgZi5kcmF3SW1hZ2UoQWIsIDUsIDUsIGEsIGEpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFjKCkgewogICAgICAgICAgICBmb3IgKHZhciBhID0gMCwgYiA9IDA7IGIgPCBxLmxlbmd0aDsgYisrKSBhICs9IHFbYl0uZyAqIHFbYl0uZzsKICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFJiKCkgewogICAgICAgICAgICBIID0gbnVsbDsKICAgICAgICAgICAgaWYgKG51bGwgIT0gSSB8fCAwICE9IEMubGVuZ3RoKQogICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gSSB8fCBmYSkgewogICAgICAgICAgICAgICAgICAgIEggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IEguZ2V0Q29udGV4dCgiMmQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgYiA9IDYwLAogICAgICAgICAgICAgICAgICAgICAgICBiID0gbnVsbCA9PSBJID8gYiArIDI0ICogQy5sZW5ndGggOiBiICsgMTgwLAogICAgICAgICAgICAgICAgICAgICAgICBkID0gTWF0aC5taW4oMjAwLCAuMyAqIHIpIC8gMjAwOwogICAgICAgICAgICAgICAgICAgIEgud2lkdGggPSAyMDAgKiBkOwogICAgICAgICAgICAgICAgICAgIEguaGVpZ2h0ID0gYiAqIGQ7CiAgICAgICAgICAgICAgICAgICAgYS5zY2FsZShkLCBkKTsKICAgICAgICAgICAgICAgICAgICBhLmdsb2JhbEFscGhhID0gLjQ7CiAgICAgICAgICAgICAgICAgICAgYS5maWxsU3R5bGUgPSAiIzAwMDAwMCI7CiAgICAgICAgICAgICAgICAgICAgYS5maWxsUmVjdCgwLCAwLCAyMDAsIGIpOwogICAgICAgICAgICAgICAgICAgIGEuZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICAgICAgICAgIGEuZmlsbFN0eWxlID0gIiNGRkZGRkYiOwogICAgICAgICAgICAgICAgICAgIGQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGQgPSBSKCJsZWFkZXJib2FyZCIpOwogICAgICAgICAgICAgICAgICAgIGEuZm9udCA9ICIzMHB4IFVidW50dSI7CiAgICAgICAgICAgICAgICAgICAgYS5maWxsVGV4dChkLCAxMDAgLSBhLm1lYXN1cmVUZXh0KGQpLndpZHRoIC8gMiwgNDApOwogICAgICAgICAgICAgICAgICAgIHZhciBjLCBlOwogICAgICAgICAgICAgICAgICAgIGlmIChudWxsID09IEkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYS5mb250ID0gIjIwcHggVWJ1bnR1IiwgYiA9IDA7IGIgPCBDLmxlbmd0aDsgKytiKSBkID0gQ1tiXS5uYW1lIHx8IFIoInVubmFtZWRfY2VsbCIpLCBmYSB8fCAoZCA9IFIoInVubmFtZWRfY2VsbCIpKSwgMSA9PSBDW2JdLmlkIHx8IC0xICE9IEUuaW5kZXhPZihDW2JdLmlkKSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocVswXS5uYW1lICYmIChkID0gcVswXS5uYW1lKSwgYS5maWxsU3R5bGUgPSAiI0ZGQUFBQSIpIDogYS5maWxsU3R5bGUgPSAiI0ZGRkZGRiIsIGQgPSBiICsgMSArICIuICIgKyBkLCBlID0gYS5tZWFzdXJlVGV4dChkKS53aWR0aCwgYyA9IDcwICsgMjQgKiBiLCAyMDAgPCBlID8gYS5maWxsVGV4dChkLCAxMCwgYykgOiBhLmZpbGxUZXh0KGQsICgyMDAgLSBlKSAvIDIsIGMpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiID0gZCA9IDA7IGIgPCBJLmxlbmd0aDsgKytiKSBjID0gZCArIElbYl0gKiBNYXRoLlBJICogMiwgYS5maWxsU3R5bGUgPSBNY1tiICsgMV0sIGEuYmVnaW5QYXRoKCksIGEubW92ZVRvKDEwMCwgMTQwKSwgYS5hcmMoMTAwLCAxNDAsIDgwLCBkLCBjLCAhMSksIGEuZmlsbCgpLCBkID0gYwogICAgICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gTmMoYSkgewogICAgICAgICAgICBpZiAobnVsbCA9PSBhIHx8IDAgPT0gYS5sZW5ndGgpIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAoIiUiID09IGFbMF0pIHsKICAgICAgICAgICAgICAgIGlmICghYy5NQyB8fCAhYy5NQy5nZXRTa2luSW5mbykgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBhID0gYy5NQy5nZXRTa2luSW5mbygic2tpbl8iICsgYS5zbGljZSgxKSk7CiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBhKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIGZvciAoYSA9ICgrYS5jb2xvcikudG9TdHJpbmcoMTYpIDsgNiA+CiAgICAgICAgICAgICAgICAgICAgYS5sZW5ndGg7KSBhID0gIjAiICsgYTsKICAgICAgICAgICAgICAgIHJldHVybiAiIyIgKyBhCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGVjKGEpIHsKICAgICAgICAgICAgaWYgKG51bGwgPT0gYSB8fCAwID09IGEubGVuZ3RoKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKCFzYS5oYXNPd25Qcm9wZXJ0eShhKSkgewogICAgICAgICAgICAgICAgdmFyIGIgPSBuZXcgSW1hZ2U7CiAgICAgICAgICAgICAgICBpZiAoIjoiID09IGFbMF0pIGIuc3JjID0gYS5zbGljZSgxKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKCIlIiA9PSBhWzBdKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjLk1DIHx8ICFjLk1DLmdldFNraW5JbmZvKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGMuTUMuZ2V0U2tpbkluZm8oInNraW5fIiArIGEuc2xpY2UoMSkpOwogICAgICAgICAgICAgICAgICAgIGlmIChudWxsID09IGQpIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgIGIuc3JjID0gYy5BU1NFVFNfUk9PVCArIGQudXJsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzYVthXSA9IGIKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gMCAhPSBzYVthXS53aWR0aCAmJiBzYVthXS5jb21wbGV0ZSA/IHNhW2FdIDogbnVsbAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gQmIoYSwgYiwgZCwgYywgZSkgewogICAgICAgICAgICB0aGlzLiQgPSBhOwogICAgICAgICAgICB0aGlzLnggPSBiOwogICAgICAgICAgICB0aGlzLnkgPSBkOwogICAgICAgICAgICB0aGlzLmYgPSBjOwogICAgICAgICAgICB0aGlzLmIgPSBlCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjYShhLCBiLCBkLCBjLCBlLCBwKSB7CiAgICAgICAgICAgIHRoaXMuaWQgPSBhOwogICAgICAgICAgICB0aGlzLnMgPSB0aGlzLnggPSB0aGlzLk0gPSB0aGlzLkogPSBiOwogICAgICAgICAgICB0aGlzLnUgPSB0aGlzLnkgPSB0aGlzLk4gPSB0aGlzLksgPSBkOwogICAgICAgICAgICB0aGlzLm8gPSB0aGlzLnNpemUgPSBjOwogICAgICAgICAgICB0aGlzLmNvbG9yID0gZTsKICAgICAgICAgICAgdGhpcy5hID0gW107CiAgICAgICAgICAgIHRoaXMuYmEoKTsKICAgICAgICAgICAgdGhpcy5BKHApCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBIYyhhKSB7CiAgICAgICAgICAgIGZvciAoYSA9IGEudG9TdHJpbmcoMTYpIDsgNiA+IGEubGVuZ3RoOykgYSA9ICIwIiArIGE7CiAgICAgICAgICAgIHJldHVybiAiIyIgKyBhCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBWYShhLCBiLCBkLCBjKSB7CiAgICAgICAgICAgIGEgJiYgKHRoaXMudiA9IGEpOwogICAgICAgICAgICBiICYmICh0aGlzLlcgPSBiKTsKICAgICAgICAgICAgdGhpcy5ZID0gISFkOwogICAgICAgICAgICBjICYmICh0aGlzLlogPSBjKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gT2MoYSkgewogICAgICAgICAgICBmb3IgKHZhciBiID0gYS5sZW5ndGgsIGQsIGM7IDAgPCBiOykgYyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGIpLCBiLS0sIGQgPSBhW2JdLCBhW2JdID0gYVtjXSwgYVtjXSA9IGQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFBjKCkgewogICAgICAgICAgICBoID0gV2EKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZjKGEpIHsKICAgICAgICAgICAgaC5jb250ZXh0ID0gImdvb2dsZSIgPT0gYSA/ICJnb29nbGUiIDogImZhY2Vib29rIjsKICAgICAgICAgICAgWGEoKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gWGEoKSB7CiAgICAgICAgICAgIGMubG9jYWxTdG9yYWdlLnN0b3JlT2JqZWN0SW5mbyA9IEpTT04uc3RyaW5naWZ5KGgpOwogICAgICAgICAgICBoID0gSlNPTi5wYXJzZShjLmxvY2FsU3RvcmFnZS5zdG9yZU9iamVjdEluZm8pOwogICAgICAgICAgICBjLnN0b3JhZ2VJbmZvID0gaDsKICAgICAgICAgICAgImdvb2dsZSIgPT0gaC5jb250ZXh0ID8gKGUoIiNnUGx1c1NoYXJlIikuc2hvdygpLCBlKCIjZmJTaGFyZSIpLmhpZGUoKSkgOiAoZSgiI2dQbHVzU2hhcmUiKS5oaWRlKCksIGUoIiNmYlNoYXJlIikuc2hvdygpKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2MoYSkgewogICAgICAgICAgICBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLWhhcy1hY2NvdW50LWRhdGEiKTsKICAgICAgICAgICAgIiIgIT0gYS5kaXNwbGF5TmFtZSAmJiAoYS5uYW1lID0gYS5kaXNwbGF5TmFtZSk7CiAgICAgICAgICAgIGlmIChudWxsID09IGEubmFtZSB8fCB2b2lkIDAgPT0gYS5uYW1lKSBhLm5hbWUgPSAiIjsKICAgICAgICAgICAgdmFyIGIgPSBhLm5hbWUubGFzdEluZGV4T2YoIl8iKTsgLTEgIT0gYiAmJiAoYS5uYW1lID0gYS5uYW1lLnN1YnN0cmluZygwLCBiKSk7CiAgICAgICAgICAgIGUoIiNoZWxsb0NvbnRhaW5lciIpLmF0dHIoImRhdGEtaGFzLWFjY291bnQtZGF0YSIsICIxIik7CiAgICAgICAgICAgIGUoIiNoZWxsb0NvbnRhaW5lciIpLmF0dHIoImRhdGEtbG9nZ2VkLWluIiwgIjEiKTsKICAgICAgICAgICAgZSgiLmFnYXJpby1wcm9maWxlLXBhbmVsIC5wcm9ncmVzcy1iYXItc3RhciIpLnRleHQoYS5sZXZlbCk7CiAgICAgICAgICAgIGUoIi5hZ2FyaW8tZXhwLWJhciAucHJvZ3Jlc3MtYmFyLXRleHQiKS50ZXh0KGEueHAgKyAiLyIgKyBhLnhwTmVlZGVkICsgIiBYUCIpOwogICAgICAgICAgICBlKCIuYWdhcmlvLWV4cC1iYXIgLnByb2dyZXNzLWJhciIpLmNzcygid2lkdGgiLCAoODggKiBhLnhwIC8gYS54cE5lZWRlZCkudG9GaXhlZCgyKSArICIlIik7CiAgICAgICAgICAgIGUoIi5hZ2FyaW8tcHJvZmlsZS1uYW1lIikudGV4dChhLm5hbWUpOwogICAgICAgICAgICAiIiAhPSBhLnBpY3R1cmUgJiYgZSgiLmFnYXJpby1wcm9maWxlLXBpY3R1cmUiKS5hdHRyKCJzcmMiLCBhLnBpY3R1cmUpOwogICAgICAgICAgICBDYigpOwogICAgICAgICAgICBoLnVzZXJJbmZvLmxldmVsID0gYS5sZXZlbDsKICAgICAgICAgICAgaC51c2VySW5mby54cCA9IGEueHA7CiAgICAgICAgICAgIGgudXNlckluZm8ueHBOZWVkZWQgPSBhLnhwTmVlZGVkOwogICAgICAgICAgICBoLnVzZXJJbmZvLmRpc3BsYXlOYW1lID0gYS5uYW1lOwogICAgICAgICAgICBoLnVzZXJJbmZvLmxvZ2dlZEluID0gIjEiOwogICAgICAgICAgICBjLnVwZGF0ZVN0b3JhZ2UoKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2EoYSwgYikgewogICAgICAgICAgICB2YXIgZCA9IGE7CiAgICAgICAgICAgIGlmIChoLnVzZXJJbmZvLmxvZ2dlZEluKSB7CiAgICAgICAgICAgICAgICB2YXIgdSA9IGUoIiNoZWxsb0NvbnRhaW5lciIpLmlzKCI6dmlzaWJsZSIpICYmICIxIiA9PSBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLWhhcy1hY2NvdW50LWRhdGEiKTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IGQgfHwgdm9pZCAwID09IGQpIGQgPSBoLnVzZXJJbmZvOwogICAgICAgICAgICAgICAgaWYgKHUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZyA9ICtlKCIuYWdhcmlvLWV4cC1iYXIgLnByb2dyZXNzLWJhci10ZXh0IikuZmlyc3QoKS50ZXh0KCkuc3BsaXQoIi8iKVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgdSA9ICtlKCIuYWdhcmlvLWV4cC1iYXIgLnByb2dyZXNzLWJhci10ZXh0IikuZmlyc3QoKS50ZXh0KCkuc3BsaXQoIi8iKVsxXS5zcGxpdCgiICIpWzBdLAogICAgICAgICAgICAgICAgICAgICAgICBwID0gZSgiLmFnYXJpby1wcm9maWxlLXBhbmVsIC5wcm9ncmVzcy1iYXItc3RhciIpLmZpcnN0KCkudGV4dCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChwICE9IGQubGV2ZWwpIGdhKHsKICAgICAgICAgICAgICAgICAgICAgICAgeHA6IHUsCiAgICAgICAgICAgICAgICAgICAgICAgIHhwTmVlZGVkOiB1LAogICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogcAogICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiLmFnYXJpby1wcm9maWxlLXBhbmVsIC5wcm9ncmVzcy1iYXItc3RhciIpLnRleHQoZC5sZXZlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIi5hZ2FyaW8tZXhwLWJhciAucHJvZ3Jlc3MtYmFyIikuY3NzKCJ3aWR0aCIsICIxMDAlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIi5wcm9ncmVzcy1iYXItc3RhciIpLmFkZENsYXNzKCJhbmltYXRlZCB0YWRhIikub25lKCJ3ZWJraXRBbmltYXRpb25FbmQgbW96QW5pbWF0aW9uRW5kIE1TQW5pbWF0aW9uRW5kIG9hbmltYXRpb25lbmQgYW5pbWF0aW9uZW5kIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSgiLnByb2dyZXNzLWJhci1zdGFyIikucmVtb3ZlQ2xhc3MoImFuaW1hdGVkIHRhZGEiKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKCIuYWdhcmlvLWV4cC1iYXIgLnByb2dyZXNzLWJhci10ZXh0IikudGV4dChkLnhwTmVlZGVkICsgIi8iICsgZC54cE5lZWRlZCArICIgWFAiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4cDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4cE5lZWRlZDogZC54cE5lZWRlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogZC5sZXZlbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhKGQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB9LCAxRTMpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IChEYXRlLm5vdygpIC0gZikgLyAxRTM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IDAgPiBhID8gMCA6IDEgPCBhID8gMSA6IGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEgKiBhICogKDMgLSAyICogYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSgiLmFnYXJpby1leHAtYmFyIC5wcm9ncmVzcy1iYXItdGV4dCIpLnRleHQofn4oZyArIChkLnhwIC0gZykgKiBhKSArICIvIiArIGQueHBOZWVkZWQgKyAiIFhQIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSgiLmFnYXJpby1leHAtYmFyIC5wcm9ncmVzcy1iYXIiKS5jc3MoIndpZHRoIiwgKDg4ICogKGcgKyAoZC54cCAtIGcpICogYSkgLyBkLnhwTmVlZGVkKS50b0ZpeGVkKDIpICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiICYmIGIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxID4gYSAmJiBjLnJlcXVlc3RBbmltYXRpb25GcmFtZShrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoaykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIENiKCkgewogICAgICAgICAgICB2YXIgYTsKICAgICAgICAgICAgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgYSAmJiBhIHx8ICJub25lIiA9PSBlKCIjc2V0dGluZ3MiKS5jc3MoImRpc3BsYXkiKSAmJiAibm9uZSIgPT0gZSgiI3NvY2lhbExvZ2luQ29udGFpbmVyIikuY3NzKCJkaXNwbGF5IikpICYmIGUoIiNpbnN0cnVjdGlvbnMiKS5zaG93KCkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGhjKGEpIHsKICAgICAgICAgICAgaWYgKCJjb25uZWN0ZWQiID09IGEuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IGEuYXV0aFJlc3BvbnNlLmFjY2Vzc1Rva2VuOwogICAgICAgICAgICAgICAgbnVsbCA9PSBiIHx8ICJ1bmRlZmluZWQiID09IGIgfHwgIiIgPT0gYiA/ICgzID4gaWMgJiYgKGljKyssIGMuZmFjZWJvb2tSZWxvZ2luKCkpLCBjLmxvZ291dCgpKSA6IChjLk1DLmRvTG9naW5XaXRoRkIoYiksIG0uY2FjaGUubG9naW5faW5mbyA9IFtiLCAiZmFjZWJvb2siXSwgYy5GQi5hcGkoIi9tZS9waWN0dXJlP3dpZHRoPTE4MCZoZWlnaHQ9MTgwIiwgZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgICAgICAgICBoLnVzZXJJbmZvLnBpY3R1cmUgPSBiLmRhdGEudXJsOwogICAgICAgICAgICAgICAgICAgIGMudXBkYXRlU3RvcmFnZSgpOwogICAgICAgICAgICAgICAgICAgIGUoIi5hZ2FyaW8tcHJvZmlsZS1waWN0dXJlIikuYXR0cigic3JjIiwgYi5kYXRhLnVybCk7CiAgICAgICAgICAgICAgICAgICAgaC51c2VySW5mby5zb2NpYWxJZCA9IGEuYXV0aFJlc3BvbnNlLnVzZXJJRDsKICAgICAgICAgICAgICAgICAgICBZYSgpCiAgICAgICAgICAgICAgICB9KSwgZSgiI2hlbGxvQ29udGFpbmVyIikuYXR0cigiZGF0YS1sb2dnZWQtaW4iLCAiMSIpLCBoLmNvbnRleHQgPSAiZmFjZWJvb2siLCBoLmxvZ2luSW50ZW50ID0gIjEiLCBjLnVwZGF0ZVN0b3JhZ2UoKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gamMoYSkgewogICAgICAgICAgICBrYSgiOnBhcnR5Iik7CiAgICAgICAgICAgIGUoIiNoZWxsb0NvbnRhaW5lciIpLmF0dHIoImRhdGEtcGFydHktc3RhdGUiLCAiNCIpOwogICAgICAgICAgICBhID0gZGVjb2RlVVJJQ29tcG9uZW50KGEpLnJlcGxhY2UoLy4qIy9naW0sICIiKTsKICAgICAgICAgICAgRGIoIiMiICsgYy5lbmNvZGVVUklDb21wb25lbnQoYSkpOwogICAgICAgICAgICBlLmFqYXgoQ2EgKyAiZ2V0VG9rZW4iLCB7CiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGUoIiNoZWxsb0NvbnRhaW5lciIpLmF0dHIoImRhdGEtcGFydHktc3RhdGUiLCAiNiIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgICAgICAgICBiID0gYi5zcGxpdCgiXG4iKTsKICAgICAgICAgICAgICAgICAgICBlKCIucGFydHlUb2tlbiIpLnZhbCgiYWdhci5pby8jIiArIGMuZW5jb2RlVVJJQ29tcG9uZW50KGEpKTsKICAgICAgICAgICAgICAgICAgICBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLXBhcnR5LXN0YXRlIiwgIjUiKTsKICAgICAgICAgICAgICAgICAgICBrYSgiOnBhcnR5Iik7CiAgICAgICAgICAgICAgICAgICAgbGIoIndzOi8vIiArIGJbMF0sIGEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgICAgICAgICAgY2FjaGU6ICExLAogICAgICAgICAgICAgICAgY3Jvc3NEb21haW46ICEwLAogICAgICAgICAgICAgICAgZGF0YTogYQogICAgICAgICAgICB9KQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gRGIoYSkgewogICAgICAgICAgICBjLmhpc3RvcnkgJiYgYy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSAmJiBjLmhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCBjLmRvY3VtZW50LnRpdGxlLCBhKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gSmEoKSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dChVYik7CiAgICAgICAgICAgIG51bGwgPT0gYy5zdG9yYWdlSW5mbyAmJiBjLmNyZWF0ZURlZmF1bHRTdG9yYWdlKCk7CiAgICAgICAgICAgIEViID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgMCA+PSBSYSAmJiAoUmEgPSBFYik7CiAgICAgICAgICAgIEVhID0gITE7CiAgICAgICAgICAgIFFjKCkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIEdjKGEsIGIpIHsKICAgICAgICAgICAgdmFyIGQgPSAtMSAhPSBFLmluZGV4T2YoYS5pZCksCiAgICAgICAgICAgICAgICBjID0gLTEgIT0gRS5pbmRleE9mKGIuaWQpLAogICAgICAgICAgICAgICAgZSA9IDMwID4gYi5zaXplOwogICAgICAgICAgICBkICYmIGUgJiYgKyt1YjsKICAgICAgICAgICAgZSB8fCAhZCB8fCBjIHx8IGIuZWEgJiAzMiB8fCArK3diCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBrYyhhKSB7CiAgICAgICAgICAgIGEgPSB+fmE7CiAgICAgICAgICAgIHZhciBiID0gKGEgJSA2MCkudG9TdHJpbmcoKTsKICAgICAgICAgICAgYSA9ICh+fihhIC8gNjApKS50b1N0cmluZygpOwogICAgICAgICAgICAyID4gYi5sZW5ndGggJiYgKGIgPSAiMCIgKyBiKTsKICAgICAgICAgICAgcmV0dXJuIGEgKyAiOiIgKyBiCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBSYygpIHsKICAgICAgICAgICAgaWYgKG51bGwgPT0gQykgcmV0dXJuIDA7CiAgICAgICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgQy5sZW5ndGg7ICsrYSkKICAgICAgICAgICAgICAgIGlmICgtMSAhPSBFLmluZGV4T2YoQ1thXS5pZCkpIHJldHVybiBhICsgMTsKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFNjKCkgewogICAgICAgICAgICBlKCIuc3RhdHMtZm9vZC1lYXRlbiIpLnRleHQodWIpOwogICAgICAgICAgICBlKCIuc3RhdHMtdGltZS1hbGl2ZSIpLnRleHQoa2MoKEViIC0gUmEpIC8gMUUzKSk7CiAgICAgICAgICAgIGUoIi5zdGF0cy1sZWFkZXJib2FyZC10aW1lIikudGV4dChrYyh4YikpOwogICAgICAgICAgICBlKCIuc3RhdHMtaGlnaGVzdC1tYXNzIikudGV4dCh+fihUIC8gMTAwKSk7CiAgICAgICAgICAgIGUoIi5zdGF0cy1jZWxscy1lYXRlbiIpLnRleHQod2IpOwogICAgICAgICAgICBlKCIuc3RhdHMtdG9wLXBvc2l0aW9uIikudGV4dCgwID09IFcgPyAiOigiIDoKICAgICAgICAgICAgICAgIFcpOwogICAgICAgICAgICB2YXIgYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzdGF0c0dyYXBoIik7CiAgICAgICAgICAgIGlmIChhKSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IGEuZ2V0Q29udGV4dCgiMmQiKSwKICAgICAgICAgICAgICAgICAgICBkID0gYS53aWR0aCwKICAgICAgICAgICAgICAgICAgICBhID0gYS5oZWlnaHQ7CiAgICAgICAgICAgICAgICBiLmNsZWFyUmVjdCgwLCAwLCBkLCBhKTsKICAgICAgICAgICAgICAgIGlmICgyIDwgRi5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjID0gMjAwLCBnID0gMDsgZyA8IEYubGVuZ3RoOyBnKyspIGMgPSBNYXRoLm1heChGW2ddLCBjKTsKICAgICAgICAgICAgICAgICAgICBiLmxpbmVXaWR0aCA9IDM7CiAgICAgICAgICAgICAgICAgICAgYi5saW5lQ2FwID0gInJvdW5kIjsKICAgICAgICAgICAgICAgICAgICBiLmxpbmVKb2luID0gInJvdW5kIjsKICAgICAgICAgICAgICAgICAgICBiLnN0cm9rZVN0eWxlID0gdmI7CiAgICAgICAgICAgICAgICAgICAgYi5maWxsU3R5bGUgPSB2YjsKICAgICAgICAgICAgICAgICAgICBiLmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgIGIubW92ZVRvKDAsIGEgLSBGWzBdIC8gYyAqIChhIC0gMTApICsgMTApOwogICAgICAgICAgICAgICAgICAgIGZvciAoZyA9IDE7IGcgPCBGLmxlbmd0aDsgZyArPSBNYXRoLm1heCh+fihGLmxlbmd0aCAvIGQpLCAxKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwID0gZyAvIChGLmxlbmd0aCAtIDEpICogZCwgZiA9IFtdLCBrID0gLTIwOyAyMCA+PSBrOyArK2spIDAgPiBnICsgayB8fCBnICsgayA+PSBGLmxlbmd0aCB8fCBmLnB1c2goRltnICsga10pOwogICAgICAgICAgICAgICAgICAgICAgICBmID0gZi5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhICsgYgogICAgICAgICAgICAgICAgICAgICAgICB9KSAvIGYubGVuZ3RoIC8gYzsKICAgICAgICAgICAgICAgICAgICAgICAgYi5saW5lVG8ocCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgLSBmICogKGEgLSAxMCkgKyAxMCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYi5zdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICBiLmdsb2JhbEFscGhhID0gLjU7CiAgICAgICAgICAgICAgICAgICAgYi5saW5lVG8oZCwgYSk7CiAgICAgICAgICAgICAgICAgICAgYi5saW5lVG8oMCwgYSk7CiAgICAgICAgICAgICAgICAgICAgYi5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgYi5nbG9iYWxBbHBoYSA9IDEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gUWMoKSB7CiAgICAgICAgICAgIGphIHx8IGFhIHx8IChaYSA/IChjLnJlZnJlc2hBZChjLmFkU2xvdHMuYWIpLCBTYygpLCBhYSA9ICEwLCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGUoIiNvdmVybGF5cyIpLmZhZGVJbig1MDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBnYSgpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGUoIiNzdGF0cyIpLnNob3coKTsKICAgICAgICAgICAgICAgIHZhciBhID0gbGMoImdfcGx1c19zaGFyZV9zdGF0cyIpOwogICAgICAgICAgICAgICAgYy5maWxsU29jaWFsVmFsdWVzKGEsICJnUGx1c1NoYXJlIikKICAgICAgICAgICAgfSwgMTUwMCkpIDogeWEoNTAwKSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGxjKGEpIHsKICAgICAgICAgICAgdmFyIGIgPSBlKCIuc3RhdHMtdGltZS1hbGl2ZSIpLnRleHQoKTsKICAgICAgICAgICAgcmV0dXJuIGMucGFyc2VTdHJpbmcoYSwgIiVAIiwgW2Iuc3BsaXQoIjoiKVswXSwgYi5zcGxpdCgiOiIpWzFdLCBlKCIuc3RhdHMtaGlnaGVzdC1tYXNzIikudGV4dCgpXSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFRjKCkgewogICAgICAgICAgICBjLm9wZW4oImh0dHBzOi8vcGx1cy5nb29nbGUuY29tL3NoYXJlP3VybD13d3cuYWdhci5pbyZobD1lbi1VUyIsICJBZ2FyLmlvIiwgIndpZHRoPTQ4NCxoZWlnaHQ9NTgwLG1lbnViYXI9bm8sdG9vbGJhcj1ubyxyZXNpemFibGU9eWVzLHNjcm9sbGJhcnM9bm8sbGVmdD0iICsgKGMuc2NyZWVuWCArIGMuaW5uZXJXaWR0aCAvIDIgLSAyNDIpICsgIix0b3A9IiArIChjLmlubmVySGVpZ2h0IC0gNTgwKSAvIDIpCiAgICAgICAgfQogICAgICAgIHZhciBtYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgICAgIGlmICgidW5kZWZpbmVkIiA9PSB0eXBlb2YgY29uc29sZSB8fCAidW5kZWZpbmVkIiA9PSB0eXBlb2YgRGF0YVZpZXcgfHwgInVuZGVmaW5lZCIgPT0gdHlwZW9mIFdlYlNvY2tldCB8fCBudWxsID09IG1jIHx8IG51bGwgPT0gbWMuZ2V0Q29udGV4dCB8fCBudWxsID09IGMubG9jYWxTdG9yYWdlKSBhbGVydCgiWW91IGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCB0aGlzIGdhbWUsIHdlIHJlY29tbWVuZCB5b3UgdG8gdXNlIEZpcmVmb3ggdG8gcGxheSB0aGlzIik7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBEID0ge307CiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IGMubG9jYXRpb24uc2VhcmNoOwogICAgICAgICAgICAgICAgIj8iID09IGEuY2hhckF0KDApICYmIChhID0KICAgICAgICAgICAgICAgICAgICBhLnNsaWNlKDEpKTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGEgPSBhLnNwbGl0KCImIiksIGIgPSAwOyBiIDwgYS5sZW5ndGg7IGIrKykgewogICAgICAgICAgICAgICAgICAgIHZhciBkID0gYVtiXS5zcGxpdCgiPSIpOwogICAgICAgICAgICAgICAgICAgIERbZFswXV0gPSBkWzFdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICAgIGMucXVlcnlTdHJpbmcgPSBEOwogICAgICAgICAgICB2YXIgbmMgPSAiZmIiIGluIEQsCiAgICAgICAgICAgICAgICBVYyA9ICJtaW5pY2xpcCIgaW4gRCwKICAgICAgICAgICAgICAgIHYgPSB7CiAgICAgICAgICAgICAgICAgICAgc2tpbnNFbmFibGVkOiAiMCIsCiAgICAgICAgICAgICAgICAgICAgbmFtZXNFbmFibGVkOiAiMCIsCiAgICAgICAgICAgICAgICAgICAgbm9Db2xvcnM6ICIwIiwKICAgICAgICAgICAgICAgICAgICBibGFja1RoZW1lOiAiMCIsCiAgICAgICAgICAgICAgICAgICAgc2hvd01hc3M6ICIwIiwKICAgICAgICAgICAgICAgICAgICBzdGF0c0VuYWJsZWQ6ICIwIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFZjID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHVhKCIiLCAtMSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvYyA9ICJodHRwOiIgIT0gYy5sb2NhdGlvbi5wcm90b2NvbCwKICAgICAgICAgICAgICAgIFdjID0gIjEiID09IHRjKCksCiAgICAgICAgICAgICAgICBwYyA9ICExOwogICAgICAgICAgICBuYyB8fCBVYyB8fCAob2MgJiYgIVdjID8gKHVhKCIxIiwgMSksIGMubG9jYXRpb24uaHJlZiA9ICJodHRwOiIgKyBjLmxvY2F0aW9uLmhyZWYuc3Vic3RyaW5nKGMubG9jYXRpb24ucHJvdG9jb2wubGVuZ3RoKSwgcGMgPSAhMCkgOiB1YSgiIiwgLTEpKTsKICAgICAgICAgICAgb2MgfHwgdWEoIiIsIC0xKTsKICAgICAgICAgICAgcGMgfHwgc2V0VGltZW91dChWYywgM0UzKTsKICAgICAgICAgICAgaWYgKCFjLmFnYXJpb05vSW5pdCkgewogICAgICAgICAgICAgICAgdmFyIGpiID0gYy5sb2NhdGlvbi5wcm90b2NvbCwKICAgICAgICAgICAgICAgICAgICBtYiA9ICJodHRwczoiID09IGpiOwogICAgICAgICAgICAgICAgRC5tYXN0ZXIgJiYgKEVudkNvbmZpZy5tYXN0ZXJfdXJsID0gRC5tYXN0ZXIpOwogICAgICAgICAgICAgICAgdmFyIENhID0gamIgKyAiLy8iICsgRW52Q29uZmlnLm1hc3Rlcl91cmwgKyAiLyIsCiAgICAgICAgICAgICAgICAgICAgJGEgPSBjLm5hdmlnYXRvci51c2VyQWdlbnQ7CiAgICAgICAgICAgICAgICBpZiAoLTEgIT0gJGEuaW5kZXhPZigiQW5kcm9pZCIpKSBjLmdhICYmIGMuZ2EoInNlbmQiLCAiZXZlbnQiLCAiTW9iaWxlUmVkaXJlY3QiLCAiUGxheVN0b3JlIiksIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGMubG9jYXRpb24uaHJlZiA9ICJodHRwczovL3BsYXkuZ29vZ2xlLmNvbS9zdG9yZS9hcHBzL2RldGFpbHM/aWQ9Y29tLm1pbmljbGlwLmFnYXIuaW8iCiAgICAgICAgICAgICAgICB9LCAxRTMpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoLTEgIT0gJGEuaW5kZXhPZigiaVBob25lIikgfHwgLTEgIT0gJGEuaW5kZXhPZigiaVBhZCIpIHx8IC0xICE9ICRhLmluZGV4T2YoImlQb2QiKSkgYy5nYSAmJiBjLmdhKCJzZW5kIiwgImV2ZW50IiwgIk1vYmlsZVJlZGlyZWN0IiwgIkFwcFN0b3JlIiksIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGMubG9jYXRpb24uaHJlZiA9ICJodHRwczovL2l0dW5lcy5hcHBsZS5jb20vYXBwL2FnYXIuaW8vaWQ5OTU5OTk3MDM/bXQ9OCZhdD0xbDN2YWpwIgogICAgICAgICAgICAgICAgfSwgMUUzKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHZhciBtID0ge307CiAgICAgICAgICAgICAgICAgICAgYy5hZ2FyQXBwID0gbTsKICAgICAgICAgICAgICAgICAgICB2YXIgeWIsIGYsIE8sIHIsIHQsIGlhID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdyA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICB6ID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgRSA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBxID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIEsgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgQSA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBiYSA9IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBDID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIFkgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBaID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgemEgPSAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgQWEgPSAtMSwKICAgICAgICAgICAgICAgICAgICAgICAgSmMgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICB4ID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgYmMgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBOID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgTWEgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBOYSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIE9hID0gMUU0LAogICAgICAgICAgICAgICAgICAgICAgICBQYSA9IDFFNCwKICAgICAgICAgICAgICAgICAgICAgICAgbCA9IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIEcgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBhYiA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBmYSA9ICEwLAogICAgICAgICAgICAgICAgICAgICAgICB0YSA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICBzYiA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICBUID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgZWEgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgYmIgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgcGEgPSB5ID0gfn4oKE1hICsgT2EpIC8gMiksCiAgICAgICAgICAgICAgICAgICAgICAgIHFhID0geiA9IH5+KChOYSArIFBhKSAvIDIpLAogICAgICAgICAgICAgICAgICAgICAgICByYSA9IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIGxhID0gIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEkgPSBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBnYiA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICBwYiA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICBuYiA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG9iID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgS2EgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBMYSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIE1jID0gWyIjMzMzMzMzIiwgIiNGRjMzMzMiLCAiIzMzRkYzMyIsICIjMzMzM0ZGIl0sCiAgICAgICAgICAgICAgICAgICAgICAgIHpiID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIEZhID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgUCA9IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIEIgPSAxLAogICAgICAgICAgICAgICAgICAgICAgICBqYSA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICBrYiA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGNjID0gITAsCiAgICAgICAgICAgICAgICAgICAgICAgIHJiID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgcWIgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgSiA9IG5ldyBJbWFnZTsKICAgICAgICAgICAgICAgICAgICBKLnNyYyA9ICIvaW1nL2JhY2tncm91bmQucG5nIjsKICAgICAgICAgICAgICAgICAgICB2YXIgZGMgPSAib250b3VjaHN0YXJ0IiBpbiBjICYmIC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8QmxhY2tCZXJyeXxJRU1vYmlsZXxPcGVyYSBNaW5pL2kudGVzdChjLm5hdmlnYXRvci51c2VyQWdlbnQpLAogICAgICAgICAgICAgICAgICAgICAgICBBYiA9IG5ldyBJbWFnZTsKICAgICAgICAgICAgICAgICAgICBBYi5zcmMgPSAiL2ltZy9zcGxpdC5wbmciOwogICAgICAgICAgICAgICAgICAgIHZhciB2YSA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICB3YSA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICB4YSA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICBjYiA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICBGYiwgR2I7CiAgICAgICAgICAgICAgICAgICAgImdhbWVwYWQiIGluIEQgJiYgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYiAmJiAoWSA9IGRiLmhhKFksIEZiKSwgWiA9IGRiLmhhKFosIEdiKSkKICAgICAgICAgICAgICAgICAgICB9LCAyNSk7CiAgICAgICAgICAgICAgICAgICAgYy5nYW1lcGFkQXhpc1VwZGF0ZSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gLjEgPiBiICogYjsKICAgICAgICAgICAgICAgICAgICAgICAgMCA9PSBhICYmIChkID8gRmIgPSByIC8gMiA6IChGYiA9IChiICsgMSkgLyAyICogciwgY2IgPSAhMCkpOwogICAgICAgICAgICAgICAgICAgICAgICAxID09IGEgJiYgKGQgPyBHYiA9IHQgLyAyIDogKEdiID0gKGIgKyAxKSAvIDIgKiB0LCBjYiA9ICEwKSkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGMuYWdhcmlvSW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZ2IgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgeGMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbS5jb3JlLmluaXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBjLmxvY2FsU3RvcmFnZS5zZXR0aW5ncyAmJiAodiA9IEpTT04ucGFyc2UoYy5sb2NhbFN0b3JhZ2Uuc2V0dGluZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmIgPSB2LnNob3dNYXNzLCBlYSA9IHYuYmxhY2tUaGVtZSwgZmEgPSB2Lm5hbWVzRW5hYmxlZCwgdGEgPSB2Lm5vQ29sb3JzLCBaYSA9IHYuc3RhdHNFbmFibGVkLCBhYiA9IHYuc2tpbnNFbmFibGVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiI3Nob3dNYXNzIikucHJvcCgiY2hlY2tlZCIsIHYuc2hvd01hc3MpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjbm9Ta2lucyIpLnByb3AoImNoZWNrZWQiLCAhdi5za2luc0VuYWJsZWQpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjc2tpcFN0YXRzIikucHJvcCgiY2hlY2tlZCIsICF2LnN0YXRzRW5hYmxlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNub0NvbG9ycyIpLnByb3AoImNoZWNrZWQiLCB2Lm5vQ29sb3JzKTsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiI25vTmFtZXMiKS5wcm9wKCJjaGVja2VkIiwgIXYubmFtZXNFbmFibGVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiI2RhcmtUaGVtZSIpLnByb3AoImNoZWNrZWQiLCB2LmJsYWNrVGhlbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBMYigpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRJbnRlcnZhbChMYiwgMThFNCk7CiAgICAgICAgICAgICAgICAgICAgICAgIE8gPSB5YiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjYW52YXMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBPICYmIChmID0gTy5nZXRDb250ZXh0KCIyZCIpLCBPLm9ubW91c2Vkb3duID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gYS5jbGllbnRYIC0gKDUgKyByIC8gNSAvIDIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYS5jbGllbnRZIC0gKDUgKyByIC8gNSAvIDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnNxcnQoYiAqIGIgKyBkICogZCkgPD0gciAvIDUgLyAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGViKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFkgPSAxICogYS5jbGllbnRYOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgWiA9IDEgKiBhLmNsaWVudFk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2EoKQogICAgICAgICAgICAgICAgICAgICAgICB9LCBPLm9ubW91c2Vtb3ZlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBZID0gMSAqIGEuY2xpZW50WDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFogPSAxICogYS5jbGllbnRZOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmIoKQogICAgICAgICAgICAgICAgICAgICAgICB9LCBPLm9ubW91c2V1cCA9IGZ1bmN0aW9uICgpIHsgfSwgL2ZpcmVmb3gvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpID8gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NTW91c2VTY3JvbGwiLCBLYiwgITEpIDogZG9jdW1lbnQuYm9keS5vbm1vdXNld2hlZWwgPSBLYiwgYy5vbmJsdXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBYKDE5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhhID0gd2EgPSB2YSA9ICExCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGMub25yZXNpemUgPSBYYiwgYy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUocWMpLCBzZXRJbnRlcnZhbChTYSwgNDApLCBHICYmIGUoIiNyZWdpb24iKS52YWwoRyksIE5iKCksIERhKGUoIiNyZWdpb24iKS52YWwoKSksIDAgPT0ga2IgJiYgRyAmJiBRKCksIHlhKDApLCBYYigpLCBjLmxvY2F0aW9uLmhhc2ggJiYgNiA8PSBjLmxvY2F0aW9uLmhhc2gubGVuZ3RoICYmIGpjKGMubG9jYXRpb24uaGFzaCkpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB2YXIgQmEgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGMuc2V0TmljayA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuZ2EgJiYgYy5nYSgic2VuZCIsICJldmVudCIsICJOaWNrIiwgYS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgTWIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgTiA9IGE7CiAgICAgICAgICAgICAgICAgICAgICAgIFNiKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICB2LnNraW5zRW5hYmxlZCA9IGFiOwogICAgICAgICAgICAgICAgICAgICAgICB2Lm5hbWVzRW5hYmxlZCA9IGZhOwogICAgICAgICAgICAgICAgICAgICAgICB2Lm5vQ29sb3JzID0gdGE7CiAgICAgICAgICAgICAgICAgICAgICAgIHYuYmxhY2tUaGVtZSA9IGVhOwogICAgICAgICAgICAgICAgICAgICAgICB2LnNob3dNYXNzID0gYmI7CiAgICAgICAgICAgICAgICAgICAgICAgIHYuc3RhdHNFbmFibGVkID0gWmE7CiAgICAgICAgICAgICAgICAgICAgICAgIGMubG9jYWxTdG9yYWdlLnNldHRpbmdzID0gSlNPTi5zdHJpbmdpZnkodik7CiAgICAgICAgICAgICAgICAgICAgICAgIEliKCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGMuc2V0U2tpbnMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBhYiA9IGEKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGMuc2V0TmFtZXMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBmYSA9IGEKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGMuc2V0RGFya1RoZW1lID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWEgPSBhCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLnNldENvbG9ycyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhID0gYQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5zZXRTaG93TWFzcyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJiID0gYQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5zcGVjdGF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTiA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIEliKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIFgoMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIE1iKCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGMuc2V0UmVnaW9uID0gRGE7CiAgICAgICAgICAgICAgICAgICAgdmFyIGhiID0gITA7CiAgICAgICAgICAgICAgICAgICAgYy5zZXRHYW1lTW9kZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEgIT0gbGEgJiYgKCI6cGFydHkiID09IGxhICYmIGUoIiNoZWxsb0NvbnRhaW5lciIpLmF0dHIoImRhdGEtcGFydHktc3RhdGUiLCAiMCIpLCBrYShhKSwgIjpwYXJ0eSIgIT0gYSAmJiBRKCkpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLnNldEFjaWQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICB6YiA9IGEKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHZhciBYYyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNraXBEcmF3OiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVkaWN0aW9uTW9kaWZpZXI6IDEuMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5pbml0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5hY2NvdW50LmluaXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uZ29vZ2xlLnZhKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmZhLmluaXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkID0gImRlYnVnIiBpbiBjLnF1ZXJ5U3RyaW5nKSAmJiBtLmRlYnVnLnNob3dEZWJ1ZygpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGEuYmluZCA9IGZ1bmN0aW9uIChhLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKGIpLmJpbmQoYSwgZCkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYS51bmJpbmQgPSBmdW5jdGlvbiAoYSwgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZShiKS51bmJpbmQoYSwgZCkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYS50cmlnZ2VyID0gZnVuY3Rpb24gKGEsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoYikudHJpZ2dlcihhLCBkKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLl9fZGVmaW5lR2V0dGVyX18oImRlYnVnIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuX19kZWZpbmVTZXR0ZXJfXygiZGVidWciLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQgPSBhCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBhLl9fZGVmaW5lR2V0dGVyX18oInByb3h5IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMuTUMKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuX19kZWZpbmVHZXR0ZXJfXygiY29uZmlnIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHUKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICAgICAgfSh7fSk7CiAgICAgICAgICAgICAgICAgICAgbS5jb3JlID0gWGM7CiAgICAgICAgICAgICAgICAgICAgbS5jYWNoZSA9IHt9OwogICAgICAgICAgICAgICAgICAgIHZhciBZYyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGIoYSwgYiwgZCwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGEgKyAiQ2FudmFzIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gZSgiPGNhbnZhcz4iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5hcHBlbmQoZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gbmV3IFNtb290aGllQ2hhcnQoZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGcgPSAwOyBnIDwgYi5sZW5ndGg7IGcrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1ID0gYltnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IF8uZXh0ZW5kKGgsIGNbZ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuYWRkVGltZVNlcmllcyh1LCBmKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5zdHJlYW1Ubyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZChhKSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZChhLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrW2FdID0gYygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYihhLCBba1thXV0sIGQsIFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlU3R5bGU6ICJyZ2JhKDAsIDI1NSwgMCwgMSkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxTdHlsZTogInJnYmEoMCwgMjU1LCAwLCAwLjIpIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lV2lkdGg6IDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dKQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBjKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBUaW1lU2VyaWVzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLYTogITEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAsIGYgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlU3R5bGU6ICJyZ2JhKDAsIDI1NSwgMCwgMSkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxTdHlsZTogInJnYmEoMCwgMjU1LCAwLCAwLjIpIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lV2lkdGg6IDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGEuc2hvd0RlYnVnID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyB8fCAocCA9IGUoIiNkZWJ1Zy1vdmVybGF5IiksIGQoIm5ldHdvcmtVcGRhdGUiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIm5ldHdvcmsgdXBkYXRlcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluVmFsdWU6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4VmFsdWU6IDEyMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGQoImZwcyIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiZnBzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5WYWx1ZTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhWYWx1ZTogMTIwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgay5ydHRTRGV2ID0gYygpLCBrLnJ0dE1lYW4gPSBjKCksIGIoInJ0dE1lYW4iLCBbay5ydHRTRGV2LCBrLnJ0dE1lYW5dLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogInJ0dCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluVmFsdWU6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4VmFsdWU6IDEyMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VTdHlsZTogInJnYmEoMjU1LCAwLCAwLCAxKSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbFN0eWxlOiAicmdiYSgwLCAyNTUsIDAsIDAuMikiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVXaWR0aDogMgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVN0eWxlOiAicmdiYSgwLCAyNTUsIDAsIDEpIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsU3R5bGU6ICJyZ2JhKDAsIDI1NSwgMCwgMCkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVXaWR0aDogMgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0pLCBnID0gITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5jb3JlLmRlYnVnID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLnNob3coKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLmhpZGVEZWJ1ZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5jb3JlLmRlYnVnID0gITEKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYS51cGRhdGVDaGFydCA9IGZ1bmN0aW9uIChhLCBiLCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnICYmIGEgaW4gayAmJiBrW2FdLmFwcGVuZChiLCBkKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLl9fZGVmaW5lR2V0dGVyX18oInNob3dQcmVkaWN0aW9uIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuX19kZWZpbmVTZXR0ZXJfXygic2hvd1ByZWRpY3Rpb24iLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYgPSBhCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgICAgIH0oe30pOwogICAgICAgICAgICAgICAgICAgIG0uZGVidWcgPSBZYzsKICAgICAgICAgICAgICAgICAgICB2YXIgbWEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEFGOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBBWDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEFMOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgRFo6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBBUzogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEFEOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQU86ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBBSTogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBBRzogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBBUjogIkJSLUJyYXppbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIEFNOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBBVzogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBBVTogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEFUOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQVo6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJTOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJIOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBCRDogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgQkI6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgQlk6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBCRTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJaOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJKOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQk06ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgQlQ6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJPOiAiQlItQnJhemlsIiwKICAgICAgICAgICAgICAgICAgICAgICAgQlE6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgQkE6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBCVzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJSOiAiQlItQnJhemlsIiwKICAgICAgICAgICAgICAgICAgICAgICAgSU86ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFZHOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJOOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBCRzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJGOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQkk6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBLSDogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ006ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBDQTogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBDVjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEtZOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIENGOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgVEQ6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBDTDogIkJSLUJyYXppbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIENOOiAiQ04tQ2hpbmEiLAogICAgICAgICAgICAgICAgICAgICAgICBDWDogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ0M6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIENPOiAiQlItQnJhemlsIiwKICAgICAgICAgICAgICAgICAgICAgICAgS006ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBDRDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIENHOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ0s6ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBDUjogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBDSTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEhSOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ1U6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ1c6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ1k6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIENaOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgREs6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBESjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIERNOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIERPOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEVDOiAiQlItQnJhemlsIiwKICAgICAgICAgICAgICAgICAgICAgICAgRUc6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBTVjogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBHUTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEVSOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgRUU6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBFVDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEZPOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgRks6ICJCUi1CcmF6aWwiLAogICAgICAgICAgICAgICAgICAgICAgICBGSjogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEZJOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgRlI6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBHRjogIkJSLUJyYXppbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBGOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgR0E6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBHTTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdFOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBERTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdIOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgR0k6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBHUjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdMOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdEOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdQOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdVOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgR1Q6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgR0c6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBHTjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEdXOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgR1k6ICJCUi1CcmF6aWwiLAogICAgICAgICAgICAgICAgICAgICAgICBIVDogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBWQTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEhOOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEhLOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBIVTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIElTOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgSU46ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIElEOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBJUjogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgSVE6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIElFOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgSU06ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBJTDogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgSVQ6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBKTTogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBKUDogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgSkU6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBKTzogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgS1o6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIEtFOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgS0k6ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBLUDogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgS1I6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIEtXOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBLRzogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgTEE6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIExWOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTEI6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIExTOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTFI6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBMWTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIExJOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTFQ6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBMVTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1POiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBNSzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1HOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTVc6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBNWTogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgTVY6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1MOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTVQ6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBNSDogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1ROiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1SOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTVU6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBZVDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1YOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIEZNOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgTUQ6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBNQzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1OOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBNRTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1TOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1BOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTVo6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBNTTogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgTkE6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBOUjogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIE5QOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBOTDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE5DOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgTlo6ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBOSTogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBORTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE5HOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgTlU6ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBORjogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1QOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgTk86ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBPTTogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgUEs6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBXOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgUFM6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBBOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBHOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgUFk6ICJCUi1CcmF6aWwiLAogICAgICAgICAgICAgICAgICAgICAgICBQRTogIkJSLUJyYXppbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBIOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBQTjogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBMOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgUFQ6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBQUjogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBRQTogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgUkU6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBSTzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFJVOiAiUlUtUnVzc2lhIiwKICAgICAgICAgICAgICAgICAgICAgICAgUlc6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBCTDogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBTSDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEtOOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIExDOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIE1GOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBNOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFZDOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFdTOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgU006ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBTVDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNBOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgU046ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBSUzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNDOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgU0w6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBTRzogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgU1g6ICJVUy1BdGxhbnRhIiwKICAgICAgICAgICAgICAgICAgICAgICAgU0s6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBTSTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNCOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgU086ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBaQTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNTOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgRVM6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBMSzogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgU0Q6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBTUjogIkJSLUJyYXppbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFNKOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgU1o6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBTRTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIENIOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgU1k6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBUVzogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgVEo6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRaOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgVEg6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRMOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBURzogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRLOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgVE86ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBUVDogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBUTjogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRSOiAiVEstVHVya2V5IiwKICAgICAgICAgICAgICAgICAgICAgICAgVE06ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRDOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRWOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgVUc6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBVQTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIEFFOiAiRVUtTG9uZG9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgR0I6ICJFVS1Mb25kb24iLAogICAgICAgICAgICAgICAgICAgICAgICBVUzogIlVTLUF0bGFudGEiLAogICAgICAgICAgICAgICAgICAgICAgICBVTTogIlNHLVNpbmdhcG9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFZJOiAiVVMtQXRsYW50YSIsCiAgICAgICAgICAgICAgICAgICAgICAgIFVZOiAiQlItQnJhemlsIiwKICAgICAgICAgICAgICAgICAgICAgICAgVVo6ICJKUC1Ub2t5byIsCiAgICAgICAgICAgICAgICAgICAgICAgIFZVOiAiU0ctU2luZ2Fwb3JlIiwKICAgICAgICAgICAgICAgICAgICAgICAgVkU6ICJCUi1CcmF6aWwiLAogICAgICAgICAgICAgICAgICAgICAgICBWTjogIkpQLVRva3lvIiwKICAgICAgICAgICAgICAgICAgICAgICAgV0Y6ICJTRy1TaW5nYXBvcmUiLAogICAgICAgICAgICAgICAgICAgICAgICBFSDogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFlFOiAiSlAtVG9reW8iLAogICAgICAgICAgICAgICAgICAgICAgICBaTTogIkVVLUxvbmRvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIFpXOiAiRVUtTG9uZG9uIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG9hID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgR2EgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBTID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgVWI7CiAgICAgICAgICAgICAgICAgICAgYy5jb25uZWN0ID0gbGI7CiAgICAgICAgICAgICAgICAgICAgdmFyIElhID0gNTAwLAogICAgICAgICAgICAgICAgICAgICAgICBDYyA9IC44NzUsCiAgICAgICAgICAgICAgICAgICAgICAgIEVjID0gLjc1LAogICAgICAgICAgICAgICAgICAgICAgICBGYyA9IC4yNSwKICAgICAgICAgICAgICAgICAgICAgICAgRGMgPSAuMTI1LAogICAgICAgICAgICAgICAgICAgICAgICBWYiA9IC0xLAogICAgICAgICAgICAgICAgICAgICAgICBXYiA9IC0xOwogICAgICAgICAgICAgICAgICAgIGMuc2VuZE1pdG9zaXMgPSBlYjsKICAgICAgICAgICAgICAgICAgICBjLnNlbmRFamVjdCA9IEpiOwogICAgICAgICAgICAgICAgICAgIG0ubmV0d29ya2luZyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEubG9naW5SZWFsbSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdHOiAiZ29vZ2xlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZCOiAiZmFjZWJvb2siCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGEuc2VuZE1lc3NhZ2UgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGEuYnl0ZVZpZXc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gVSgxICsgYS5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnNldFVpbnQ4KDAsIDEwMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgZC5sZW5ndGg7ICsrYykgYS5zZXRVaW50OCgxICsgYywgZFtjXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRUb2tlbihkKTsvL0FHQVJCT1RPVkgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVihhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICB9KHt9KTsKICAgICAgICAgICAgICAgICAgICB2YXIgSCA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIE0gPSAxLAogICAgICAgICAgICAgICAgICAgICAgICBVYSA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHJjID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgcWMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IERhdGUubm93KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IDFFMyAvIDYwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnJlcXVlc3RBbmltYXRpb25GcmFtZShxYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gZCAtIGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgPiBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBkIC0gZSAlIGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIWRhKCkgfHwgMjQwID4gZyAtIEZhIHx8ICFtLmNvcmUuY29uZmlnLnNraXBEcmF3ID8gWWIoKSA6IGNvbnNvbGUud2FybigiU2tpcHBpbmcgZHJhdyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBaYygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYyA9IDFFMyAvIGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uZGVidWcudXBkYXRlQ2hhcnQoImZwcyIsIGQsIHJjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSgpLAogICAgICAgICAgICAgICAgICAgICAgICBoYSA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBPYiA9ICJwb2xhbmQ7dXNhO2NoaW5hO3J1c3NpYTtjYW5hZGE7YXVzdHJhbGlhO3NwYWluO2JyYXppbDtnZXJtYW55O3VrcmFpbmU7ZnJhbmNlO3N3ZWRlbjtjaGFwbGluO25vcnRoIGtvcmVhO3NvdXRoIGtvcmVhO2phcGFuO3VuaXRlZCBraW5nZG9tO2VhcnRoO2dyZWVjZTtsYXR2aWE7bGl0aHVhbmlhO2VzdG9uaWE7ZmlubGFuZDtub3J3YXk7Y2lhO21hbGRpdmFzO2F1c3RyaWE7bmlnZXJpYTtyZWRkaXQ7eWFyYW5haWthO2NvbmZlZGVyYXRlOzlnYWc7aW5kaWFuYTs0Y2hhbjtpdGFseTtidWxnYXJpYTt0dW1ibHI7MmNoLmhrO2hvbmcga29uZztwb3J0dWdhbDtqYW1haWNhO2dlcm1hbiBlbXBpcmU7bWV4aWNvO3NhbmlrO3N3aXR6ZXJsYW5kO2Nyb2F0aWE7Y2hpbGU7aW5kb25lc2lhO2JhbmdsYWRlc2g7dGhhaWxhbmQ7aXJhbjtpcmFxO3BlcnU7bW9vbjtib3Rzd2FuYTtib3NuaWE7bmV0aGVybGFuZHM7ZXVyb3BlYW4gdW5pb247dGFpd2FuO3Bha2lzdGFuO2h1bmdhcnk7c2F0YW5pc3Q7cWluZyBkeW5hc3R5O21hdHJpYXJjaHk7cGF0cmlhcmNoeTtmZW1pbmlzbTtpcmVsYW5kO3RleGFzO2ZhY2VwdW5jaDtwcm9kb3RhO2NhbWJvZGlhO3N0ZWFtO3BpY2NvbG87ZWE7aW5kaWE7a2M7ZGVubWFyaztxdWViZWM7YXl5IGxtYW87c2VhbGFuZDtiYWl0O3RzYXJpc3QgcnVzc2lhO29yaWdpbjt2aW5lc2F1Y2U7c3RhbGluO2JlbGdpdW07bHV4ZW1ib3VyZztzdHVzc3k7cHJ1c3NpYTs4Y2g7YXJnZW50aW5hO3Njb3RsYW5kO3Npcjtyb21hbmlhO3dvamFrO2RvZ2U7bmFzYTtieXphbnRpdW07aW1wZXJpYWwgamFwYW47ZnJlbmNoIGtpbmdkb207c29tYWxpYTt0dXJrZXk7bWFycztwb2tlcmZhY2U7ODtpcnM7cmVjZWl0YSBmZWRlcmFsO2ZhY2Vib29rO3B1dGluO21lcmtlbDt0c2lwcmFzO29iYW1hO2tpbSBqb25nLXVuO2RpbG1hO2hvbGxhbmRlO2Jlcmx1c2Nvbmk7Y2FtZXJvbjtjbGludG9uO2hpbGxhcnk7dmVuZXp1ZWxhO2JsYXR0ZXI7Y2hhdmV6O2N1YmE7ZmlkZWw7bWVya2VsO3BhbGluO3F1ZWVuO2JvcmlzO2J1c2g7dHJ1bXAiLnNwbGl0KCI7IiksCiAgICAgICAgICAgICAgICAgICAgICAgICRjID0gIjg7bmFzYTtwdXRpbjttZXJrZWw7dHNpcHJhcztvYmFtYTtraW0gam9uZy11bjtkaWxtYTtob2xsYW5kZTtiZXJsdXNjb25pO2NhbWVyb247Y2xpbnRvbjtoaWxsYXJ5O2JsYXR0ZXI7Y2hhdmV6O2ZpZGVsO21lcmtlbDtwYWxpbjtxdWVlbjtib3JpcztidXNoO3RydW1wIi5zcGxpdCgiOyIpLAogICAgICAgICAgICAgICAgICAgICAgICBzYSA9IHt9OwogICAgICAgICAgICAgICAgICAgIEJiLnByb3RvdHlwZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgZjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgYjogMAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdmFyIFRhID0gLTEsCiAgICAgICAgICAgICAgICAgICAgICAgICRiID0gITE7CiAgICAgICAgICAgICAgICAgICAgY2EucHJvdG90eXBlID0gewogICAgICAgICAgICAgICAgICAgICAgICBpZDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgYTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgaTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgUzogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgczogMCwKICAgICAgICAgICAgICAgICAgICAgICAgdTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgbzogMCwKICAgICAgICAgICAgICAgICAgICAgICAgamE6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGthOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBnOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBNOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBOOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBKOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBLOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBlYTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgVTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgcmE6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIEc6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBjOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgaDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIFY6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBkYTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgQzogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgaWE6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHVhOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgSTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCBBLmxlbmd0aDsgYSsrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBW2FdID09IHRoaXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQS5zcGxpY2UoYSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIEtbdGhpcy5pZF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gcS5pbmRleE9mKHRoaXMpOyAtMSAhPSBhICYmIChzYiA9ICEwLCBxLnNwbGljZShhLCAxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gRS5pbmRleE9mKHRoaXMuaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BR0FSQk9UT1ZICiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLTEgIT0gYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEUuc3BsaWNlKGEsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZU15QmFsbCh0aGlzLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQUdBUkJPVE9WSAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5HID0gITA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwIDwgdGhpcy5kYSAmJiBiYS5wdXNoKHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG06IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heCh+figuMyAqIHRoaXMuc2l6ZSksIDI0KQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBBOiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubmFtZSA9IGEpIG51bGwgPT0gdGhpcy5pID8gdGhpcy5pID0gbmV3IFZhKHRoaXMubSgpLCAiI0ZGRkZGRiIsICEwLCAiIzAwMDAwMCIpIDogdGhpcy5pLlAodGhpcy5tKCkpLCB0aGlzLmkuQih0aGlzLm5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGJhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBhID0gdGhpcy5IKCkgOyB0aGlzLmEubGVuZ3RoID4gYTspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IH5+KE1hdGgucmFuZG9tKCkgKiB0aGlzLmEubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmEuc3BsaWNlKGIsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDAgPT0gdGhpcy5hLmxlbmd0aCAmJiAwIDwgYSAmJiB0aGlzLmEucHVzaChuZXcgQmIodGhpcywgdGhpcy54LCB0aGlzLnksIHRoaXMuc2l6ZSwgTWF0aC5yYW5kb20oKSAtIC41KSkgOyB0aGlzLmEubGVuZ3RoIDwgYTspIGIgPSB+fihNYXRoLnJhbmRvbSgpICogdGhpcy5hLmxlbmd0aCksIGIgPSB0aGlzLmFbYl0sIHRoaXMuYS5wdXNoKG5ldyBCYih0aGlzLCBiLngsIGIueSwgYi5mLCBiLmIpKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBIOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IDEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMjAgPiB0aGlzLnNpemUgJiYgKGEgPSAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYyAmJiAoYSA9IDMwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5zaXplOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jIHx8IChiICo9IGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiAqPSBNOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIH5+TWF0aC5tYXgoYiwgYSkKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgQmE6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYmEoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGEgPSB0aGlzLmEsIGIgPSBhLmxlbmd0aCwgZCA9IHRoaXMsIGMgPSB0aGlzLmMgPyAwIDogKHRoaXMuaWQgLyAxRTMgKyB4IC8gMUU0KSAlICgyICogTWF0aC5QSSksIGUgPSAwLCBwID0gMDsgcCA8IGI7ICsrcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gYVsocCAtIDEgKyBiKSAlIGJdLmIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBhWyhwICsgMSkgJSBiXS5iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gYVtwXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLmIgKz0gKE1hdGgucmFuZG9tKCkgLSAuNSkgKiAodGhpcy5oID8gMyA6IDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguYiAqPSAuNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMCA8IGguYiAmJiAoaC5iID0gMTApOyAtMTAgPiBoLmIgJiYgKGguYiA9IC0xMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5iID0gKGYgKyBrICsgOCAqIGguYikgLyAxMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGguZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGFbKHAgLSAxICsgYikgJSBiXS5mLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID0gYVsocCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxKSAlIGJdLmY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDE1IDwgdGhpcy5zaXplICYmIG51bGwgIT0gaWEgJiYgMjAgPCB0aGlzLnNpemUgKiBsICYmIDAgPCB0aGlzLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBRYSA9ICExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGgueCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEgPSBoLnk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlhLkVhKG0gLSA1LCBxIC0gNSwgMTAsIDEwLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS4kICE9IGQgJiYgMjUgPiAobSAtIGEueCkgKiAobSAtIGEueCkgKyAocSAtIGEueSkgKiAocSAtIGEueSkgJiYgKFFhID0gITApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhUWEgJiYgKGgueCA8IE1hIHx8IGgueSA8IE5hIHx8IGgueCA+IE9hIHx8IGgueSA+IFBhKSAmJiAoUWEgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFhICYmICgwIDwgaC5iICYmIChoLmIgPSAwKSwgLS1oLmIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gKz0gaC5iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPiBuICYmIChuID0gMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IHRoaXMuaCA/ICgxOSAqIG4gKyB0aGlzLnNpemUpIC8gMjAgOiAoMTIgKiBuICsgdGhpcy5zaXplKSAvIDEzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguZiA9IChmICsgayArIDggKiBuKSAvIDEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSAyICogTWF0aC5QSSAvIGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IGguZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmMgJiYgMCA9PSBwICUgMiAmJiAoayArPSA1KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLnggPSB0aGlzLnggKyBNYXRoLmNvcyhmICogcCArIGMpICogazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLnkgPSB0aGlzLnkgKyBNYXRoLnNpbihmICogcCArIGMpICogazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gTWF0aC5tYXgoZSwgaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaWEgPSBlCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG5hOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5NID0gYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuTiA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLkogPSBhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5LID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qYSA9IGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmthID0gYgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBUOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA+PSB0aGlzLmlkKSByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gZGIucGEoKHggLSB0aGlzLlUpIC8gMTIwLCAwLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLkcgJiYgMSA8PSBhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBiYS5pbmRleE9mKHRoaXMpOyAtMSAhPSBiICYmIGJhLnNwbGljZShiLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy54ID0gYSAqICh0aGlzLmphIC0gdGhpcy5zKSArIHRoaXMuczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueSA9IGEgKiAodGhpcy5rYSAtIHRoaXMudSkgKyB0aGlzLnU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNpemUgPSBhICogKHRoaXMuZyAtIHRoaXMubykgKyB0aGlzLm87CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuMDEgPiBNYXRoLmFicyh0aGlzLnNpemUgLSB0aGlzLmcpICYmICh0aGlzLnNpemUgPSB0aGlzLmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgUjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgPj0gdGhpcy5pZCA/ICEwIDogdGhpcy54ICsgdGhpcy5zaXplICsgNDAgPCB5IC0gciAvIDIgLyBsIHx8IHRoaXMueSArIHRoaXMuc2l6ZSArIDQwIDwgeiAtIHQgLyAyIC8gbCB8fCB0aGlzLnggLSB0aGlzLnNpemUgLSA0MCA+IHkgKyByIC8gMiAvIGwgfHwgdGhpcy55IC0gdGhpcy5zaXplIC0gNDAgPiB6ICsgdCAvIDIgLyBsID8gITEgOiAhMAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBxYTogZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5IKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLm1vdmVUbyh0aGlzLmFbMF0ueCwgdGhpcy5hWzBdLnkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9IDE7IGQgPD0gYjsgKytkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBkICUgYjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmxpbmVUbyh0aGlzLmFbY10ueCwgdGhpcy5hW2NdLnkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNsb3NlUGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5zdHJva2UoKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB3OiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuUigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyt0aGlzLmRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gMCA8IHRoaXMuaWQgJiYgIXRoaXMuYyAmJiAhdGhpcy5oICYmIC40ID4gbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA1ID4gdGhpcy5IKCkgJiYgMCA8IHRoaXMuaWQgJiYgKGIgPSAhMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuViAmJiAhYikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCB0aGlzLmEubGVuZ3RoOyBkKyspIHRoaXMuYVtkXS5mID0gdGhpcy5zaXplOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuViA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yYSA9IHg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMuVCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuRyAmJiAoYS5nbG9iYWxBbHBoYSAqPSAxIC0gZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5saW5lV2lkdGggPSAxMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmxpbmVDYXAgPSAicm91bmQiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEubGluZUpvaW4gPSB0aGlzLmMgPyAibWl0ZXIiIDogInJvdW5kIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMubmFtZS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHRoaXMuY29sb3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGggPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmggfHwgIWFiIHx8IHFiIHx8ICgtMSAhPSBPYi5pbmRleE9mKGUpID8gKGhhLmhhc093blByb3BlcnR5KGUpIHx8IChoYVtlXSA9IG5ldyBJbWFnZSwgaGFbZV0uc3JjID0gYy5BU1NFVFNfUk9PVCArICJza2lucy8iICsgZSArICIucG5nIiksIGcgPSAwICE9IGhhW2VdLndpZHRoICYmIGhhW2VdLmNvbXBsZXRlID8gaGFbZV0gOiBudWxsKSA6IGcgPSBudWxsLCBudWxsICE9IGcgPyAtMSAhPSAkYy5pbmRleE9mKGUpICYmIChkID0gITApIDogKHRoaXMuSSAmJiAiJXN0YXJiYWxsIiA9PSB0aGlzLkMgJiYgInNoZW5yb24iID09IGUgJiYgNyA8PSBxLmxlbmd0aCAmJiAoJGIgPSBkID0gITAsIHAgPSBlYygiJXN0YXJiYWxsMSIpKSwgZyA9IGVjKHRoaXMuQyksIG51bGwgIT0gZyAmJiAoaCA9ICEwLCBmID0gTmModGhpcy5DKSB8fCBmKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0uY29yZS5kZWJ1ZyAmJiBtLmRlYnVnLnNob3dQcmVkaWN0aW9uICYmIHRoaXMuSSAmJiAoYS5zdHJva2VTdHlsZSA9ICIjMDAwMEZGIiwgYS5iZWdpblBhdGgoKSwgYS5hcmModGhpcy5NLCB0aGlzLk4sIHRoaXMuc2l6ZSArIDUsIDAsIDIgKiBNYXRoLlBJLCAhMSksIGEuY2xvc2VQYXRoKCksIGEuc3Ryb2tlKCksIGEuc3Ryb2tlU3R5bGUgPSAiIzAwRkYwMCIsIGEuYmVnaW5QYXRoKCksIGEuYXJjKHRoaXMuSiwgdGhpcy5LLCB0aGlzLnNpemUgKyA1LCAwLCAyICogTWF0aC5QSSwgITEpLCBhLmNsb3NlUGF0aCgpLCBhLnN0cm9rZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YSAmJiAhcWIgPyAoYS5maWxsU3R5bGUgPSAiI0ZGRkZGRiIsIGEuc3Ryb2tlU3R5bGUgPSAiI0FBQUFBQSIpIDogKGEuZmlsbFN0eWxlID0gZiwgYS5zdHJva2VTdHlsZSA9IGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPyAoYS5iZWdpblBhdGgoKSwgYS5hcmModGhpcy54LCB0aGlzLnksIHRoaXMuc2l6ZSArIDUsIDAsIDIgKiBNYXRoLlBJLCAhMSksIGEuY2xvc2VQYXRoKCkpIDogKHRoaXMuQmEoKSwgdGhpcy5xYShhKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCB8fCBhLmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9IGcgJiYgKHRoaXMubGEoYSwgZyksIG51bGwgIT0gcCAmJiB0aGlzLmxhKGEsIHAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGE6IE1hdGguc2luKC4wMTc0ICogVGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0YSB8fCAxNSA8IHRoaXMuc2l6ZSkgJiYgIWIgJiYgKGEuc3Ryb2tlU3R5bGUgPSAiIzAwMDAwMCIsIGEuZ2xvYmFsQWxwaGEgKj0gLjEsIGEuc3Ryb2tlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSAtMSAhPSBxLmluZGV4T2YodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IH5+dGhpcy55OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgIT0gdGhpcy5pZCAmJiAoZmEgfHwgZSkgJiYgdGhpcy5uYW1lICYmIHRoaXMuaSAmJiAhZCAmJiAoZyA9IHRoaXMuaSwgZy5CKHRoaXMubmFtZSksIGcuUCh0aGlzLm0oKSksIGQgPSAwID49IHRoaXMuaWQgPyAxIDogTWF0aC5jZWlsKDEwICogbCkgLyAxMCwgZy5tYShkKSwgZyA9IGcuTygpLCBwID0gTWF0aC5jZWlsKGcud2lkdGggLyBkKSwgZiA9IE1hdGguY2VpbChnLmhlaWdodCAvIGQpLCBhLmRyYXdJbWFnZShnLCB+fnRoaXMueCAtIH5+KHAgLyAyKSwgYiAtIH5+KGYgLyAyKSwgcCwgZiksIGIgKz0gZy5oZWlnaHQgLyAyIC8gZCArIDQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgPCB0aGlzLmlkICYmIGJiICYmIChlIHx8IDAgPT0gcS5sZW5ndGggJiYgKCF0aGlzLmMgfHwgdGhpcy5oKSAmJiAyMCA8IHRoaXMuc2l6ZSkgJiYgKG51bGwgPT0gdGhpcy5TICYmICh0aGlzLlMgPSBuZXcgVmEodGhpcy5tKCkgLyAyLCAiI0ZGRkZGRiIsICEwLCAiIzAwMDAwMCIpKSwgZSA9IHRoaXMuUywgZS5QKHRoaXMubSgpIC8gMiksIGUuQih+fih0aGlzLnNpemUgKiB0aGlzLnNpemUgLyAxMDApKSwgZCA9IE1hdGguY2VpbCgxMCAqIGwpIC8gMTAsIGUubWEoZCksIGcgPSBlLk8oKSwgcCA9IE1hdGguY2VpbChnLndpZHRoIC8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCksIGYgPSBNYXRoLmNlaWwoZy5oZWlnaHQgLyBkKSwgYS5kcmF3SW1hZ2UoZywgfn50aGlzLnggLSB+fihwIC8gMiksIGIgLSB+fihmIC8gMiksIHAsIGYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLnJlc3RvcmUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBsYTogZnVuY3Rpb24gKGEsIGIsIGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuc2F2ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5jbGlwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IE1hdGgubWF4KHRoaXMuc2l6ZSwgdGhpcy5pYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9IGQgJiYgbnVsbCAhPSBkLmFscGhhICYmIChhLmdsb2JhbEFscGhhID0gZC5hbHBoYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmRyYXdJbWFnZShiLCB0aGlzLnggLSBjIC0gNSwgdGhpcy55IC0gYyAtIDUsIDIgKiBjICsgMTAsIDIgKiBjICsgMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5yZXN0b3JlKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdmFyIGRiID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYihhLCBiLCBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA8IGIgPyBiIDogYSA+IGMgPyBjIDogYQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGEuaGEgPSBmdW5jdGlvbiAoYSwgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gYiguNSwgMCwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSArIGUgKiAoYyAtIGEpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGEucGEgPSBiOwogICAgICAgICAgICAgICAgICAgICAgICBhLmZpeGVkID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gTWF0aC5wb3coMTAsIGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIH5+KGEgKiBjKSAvIGMKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICB9KHt9KTsKICAgICAgICAgICAgICAgICAgICBjLk1hdGhzID0gZGI7CiAgICAgICAgICAgICAgICAgICAgdmFyIEhhID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYS5MID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBEYXRlLCBjID0gW2EuZ2V0TW9udGgoKSArIDEsIGEuZ2V0RGF0ZSgpLCBhLmdldEZ1bGxZZWFyKCldLCBhID0gW2EuZ2V0SG91cnMoKSwgYS5nZXRNaW51dGVzKCksIGEuZ2V0U2Vjb25kcygpXSwgZSA9IDE7IDMgPiBlOyBlKyspIDEwID4gYVtlXSAmJiAoYVtlXSA9ICIwIiArIGFbZV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJbIiArIGMuam9pbigiLyIpICsgIiAiICsgYS5qb2luKCI6IikgKyAiXSIKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICAgICAgICB9KHt9KTsKICAgICAgICAgICAgICAgICAgICBjLlV0aWxzID0gSGE7CiAgICAgICAgICAgICAgICAgICAgVmEucHJvdG90eXBlID0gewogICAgICAgICAgICAgICAgICAgICAgICBGOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgVzogIiMwMDAwMDAiLAogICAgICAgICAgICAgICAgICAgICAgICBZOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgWjogIiMwMDAwMDAiLAogICAgICAgICAgICAgICAgICAgICAgICB2OiAxNiwKICAgICAgICAgICAgICAgICAgICAgICAgajogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgWDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgbDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIEQ6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIFA6IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnYgIT0gYSAmJiAodGhpcy52ID0gYSwgdGhpcy5sID0gITApCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG1hOiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5EICE9IGEgJiYgKHRoaXMuRCA9IGEsIHRoaXMubCA9ICEwKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBCOiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSAhPSB0aGlzLkYgJiYgKHRoaXMuRiA9IGEsIHRoaXMubCA9ICEwKQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBPOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsID09IHRoaXMuaiAmJiAodGhpcy5qID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIiksIHRoaXMuWCA9IHRoaXMuai5nZXRDb250ZXh0KCIyZCIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmwgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuaiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IHRoaXMuWCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuRiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHRoaXMuRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXMudiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGcgKyAicHggVWJ1bnR1IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmZvbnQgPSBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoID0gfn4oLjIgKiBnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLndpZHRoID0gKGIubWVhc3VyZVRleHQoYykud2lkdGggKyA2KSAqIGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5oZWlnaHQgPSAoZyArIGgpICogZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmZvbnQgPSBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc2NhbGUoZSwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5nbG9iYWxBbHBoYSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5saW5lV2lkdGggPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc3Ryb2tlU3R5bGUgPSB0aGlzLlo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5maWxsU3R5bGUgPSB0aGlzLlc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ZICYmIGIuc3Ryb2tlVGV4dChjLCAzLCBnIC0gaCAvIDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuZmlsbFRleHQoYywgMywgZyAtIGggLyAyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuagogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBEYXRlLm5vdyB8fCAoRGF0ZS5ub3cgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobmV3IERhdGUpLmdldFRpbWUoKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGEgPSBbIm1zIiwgIm1veiIsICJ3ZWJraXQiLCAibyJdLCBiID0gMDsgYiA8IGEubGVuZ3RoICYmICFjLnJlcXVlc3RBbmltYXRpb25GcmFtZTsgKytiKSBjLnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGNbYVtiXSArICJSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiXSwgYy5jYW5jZWxBbmltYXRpb25GcmFtZSA9IGNbYVtiXSArICJDYW5jZWxBbmltYXRpb25GcmFtZSJdIHx8IGNbYVtiXSArICJDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiXTsKICAgICAgICAgICAgICAgICAgICAgICAgYy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgKGMucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGEsIDFFMyAvIDYwKQogICAgICAgICAgICAgICAgICAgICAgICB9LCBjLmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChhKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHZjID0gewogICAgICAgICAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA8IGUgJiYgKGEgPSBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID4gZiAmJiAoYSA9IGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB+figoYSAtIGUpIC8gMzIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYyhhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA8IGcgJiYgKGEgPSBnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID4gaCAmJiAoYSA9IGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB+figoYSAtIGcpIC8gMzIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGEuemEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGEuQWEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IGEueGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGEueWEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgayA9IH5+KChmIC0gZSkgLyAzMikgKyAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0gPSB+figoaCAtIGcpIC8gMzIpICsgMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gQXJyYXkoayAqIG0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YTogZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYihhLngpICsgYyhhLnkpICogazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCA9PSBuW2VdID8gbltlXSA9IGEgOiBBcnJheS5pc0FycmF5KG5bZV0pID8gbltlXS5wdXNoKGEpIDogbltlXSA9IFtuW2VdLCBhXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRWE6IGZ1bmN0aW9uIChhLCBlLCBnLCBmLCBoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwID0gYihhKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSBjKGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gYihhICsgZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBjKGUgKyBmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPiBwIHx8IHAgPj0gayB8fCAwID4gdSB8fCB1ID49IG0pIGRlYnVnZ2VyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgdSA8PSBlOyArK3UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGYgPSBwOyBmIDw9IGE7ICsrZikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZyA9IG5bZiArIHUgKiBrXSwgbnVsbCAhPSBnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGwgPSAwOyBsIDwgZy5sZW5ndGg7IGwrKykgaChnW2xdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBoKGcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgVGIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IG5ldyBjYSgwLCAwLCAwLCAzMiwgIiNFRDFDMjQiLCAiIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi53aWR0aCA9IDMyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5oZWlnaHQgPSAzMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gYi5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwIDwgcS5sZW5ndGggJiYgKGEuY29sb3IgPSBxWzBdLmNvbG9yLCBhLkEocVswXS5uYW1lKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5jbGVhclJlY3QoMCwgMCwgMzIsIDMyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnRyYW5zbGF0ZSgxNiwgMTYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuc2NhbGUoLjQsIC40KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLncoYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5yZXN0b3JlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZmF2aWNvbiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gZS5jbG9uZU5vZGUoITApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGcuc2V0QXR0cmlidXRlKCJocmVmIiwgYi50b0RhdGFVUkwoImltYWdlL3BuZyIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGcsIGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0oKTsKICAgICAgICAgICAgICAgICAgICBlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgVGIoKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHZhciBXYSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFByb3ZpZGVyOiAiZmFjZWJvb2siLAogICAgICAgICAgICAgICAgICAgICAgICBsb2dpbkludGVudDogIjAiLAogICAgICAgICAgICAgICAgICAgICAgICB1c2VySW5mbzogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc29jaWFsVG9rZW46IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbkV4cGlyZXM6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHA6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeHBOZWVkZWQ6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWN0dXJlOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlZEluOiAiMCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2NpYWxJZDogIiIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBjLmRlZmF1bHRTdCA9IFdhOwogICAgICAgICAgICAgICAgICAgIGMuc3RvcmFnZUluZm8gPSBoOwogICAgICAgICAgICAgICAgICAgIGMuY3JlYXRlRGVmYXVsdFN0b3JhZ2UgPSBQYzsKICAgICAgICAgICAgICAgICAgICBjLnVwZGF0ZVN0b3JhZ2UgPSBYYTsKICAgICAgICAgICAgICAgICAgICBlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSBjLmxvY2FsU3RvcmFnZS5zdG9yZU9iamVjdEluZm8gJiYgKGggPSBKU09OLnBhcnNlKGMubG9jYWxTdG9yYWdlLnN0b3JlT2JqZWN0SW5mbykpOwogICAgICAgICAgICAgICAgICAgICAgICAiMSIgPT0gaC5sb2dpbkludGVudCAmJiBmYyhoLmNvbnRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAiIiA9PSBoLnVzZXJJbmZvLm5hbWUgJiYgIiIgPT0gaC51c2VySW5mby5kaXNwbGF5TmFtZSB8fCBnYyhoLnVzZXJJbmZvKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGMuY2hlY2tMb2dpblN0YXR1cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIjEiID09IGgubG9naW5JbnRlbnQgJiYgKFlhKCksIGZjKGguY29udGV4dCkpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB2YXIgWWEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuTUMuc2V0UHJvZmlsZVBpY3R1cmUoaC51c2VySW5mby5waWN0dXJlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYy5NQy5zZXRTb2NpYWxJZChoLnVzZXJJbmZvLnNvY2lhbElkKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBXYTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGMubG9jYWxTdG9yYWdlLnN0b3JlT2JqZWN0SW5mbzsKICAgICAgICAgICAgICAgICAgICAgICAgYy5sb2NhbFN0b3JhZ2Uuc3RvcmVPYmplY3RJbmZvID0gSlNPTi5zdHJpbmdpZnkoV2EpOwogICAgICAgICAgICAgICAgICAgICAgICBYYSgpOwogICAgICAgICAgICAgICAgICAgICAgICBzYygpOwogICAgICAgICAgICAgICAgICAgICAgICBtLmNhY2hlLnNlbnRHYW1lU2VydmVyTG9naW4gPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG0uY2FjaGUubG9naW5faW5mbzsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiI2hlbGxvQ29udGFpbmVyIikuYXR0cigiZGF0YS1sb2dnZWQtaW4iLCAiMCIpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLWhhcy1hY2NvdW50LWRhdGEiLCAiMCIpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIudGltZXIiKS50ZXh0KCIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiI2dQbHVzU2hhcmUiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNmYlNoYXJlIikuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjdXNlci1pZC10YWciKS50ZXh0KCIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgUSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjLk1DLmRvTG9nb3V0KCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGMudG9nZ2xlU29jaWFsTG9naW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNzb2NpYWxMb2dpbkNvbnRhaW5lciIpLnRvZ2dsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjc2V0dGluZ3MiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNpbnN0cnVjdGlvbnMiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIENiKCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGMudG9nZ2xlU2V0dGluZ3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNzZXR0aW5ncyIpLnRvZ2dsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjc29jaWFsTG9naW5Db250YWluZXIiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNpbnN0cnVjdGlvbnMiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIENiKCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIG0uYWNjb3VudCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGIoKSB7IH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGQoYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coSGEuTCgpICsgIiBnb3QgdXNlciBsb2dpbiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gZiB8fCBmLmlkICE9IGIuaWQpIGYgPSBiLCBudWxsICE9IGMuc3NhX2pzb24gJiYgKGMuc3NhX2pzb24uYXBwbGljYXRpb25Vc2VySWQgPSAiIiArIGIuaWQsIGMuc3NhX2pzb24uY3VzdG9tX3VzZXJfaWQgPSAiIiArIGIuaWQpLCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgU1NBX0NPUkUgJiYgU1NBX0NPUkUuc3RhcnQoKSwgZSgiI29mZmVyd2FsbElmcmFtZSIpLmF0dHIoInNyYyIsICJodHRwOi8vd3d3LnN1cGVyc29uaWNhZHMuY29tL2RlbGl2ZXJ5L3BhbmVsLnBocD9hcHBsaWNhdGlvbktleT0iICsgRW52Q29uZmlnLnN1cGVyc29uaWNfYXBwX2tleSArICImYXBwbGljYXRpb25Vc2VySWQ9IiArIGIuaWQgKyAiJmN1c3RvbV91c2VyX2lkPSIgKyBiLmlkICsgIiZhcHBsaWNhdGlvblVzZXJJZFNpZ25hdHVyZT1vcHRpb25hbCIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBhLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmNvcmUuYmluZCgidXNlcl9sb2dpbiIsIGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5jb3JlLmJpbmQoInVzZXJfbG9nb3V0IiwgYikKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5zZXRVc2VyRGF0YSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYyhhKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLnNldEFjY291bnREYXRhID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gZSgiI2hlbGxvQ29udGFpbmVyIikuYXR0cigiZGF0YS1oYXMtYWNjb3VudC1kYXRhIiwgIjEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgudXNlckluZm8ueHAgPSBhLnhwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaC51c2VySW5mby54cE5lZWRlZCA9IGEueHBOZWVkZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLnVzZXJJbmZvLmxldmVsID0gYS5sZXZlbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFhhKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjICYmIGIgPyBnYShhKSA6IChlKCIuYWdhcmlvLXByb2ZpbGUtcGFuZWwgLnByb2dyZXNzLWJhci1zdGFyIikudGV4dChhLmxldmVsKSwgZSgiLmFnYXJpby1leHAtYmFyIC5wcm9ncmVzcy1iYXItdGV4dCIpLnRleHQoYS54cCArICIvIiArIGEueHBOZWVkZWQgKyAiIFhQIiksIGUoIi5hZ2FyaW8tZXhwLWJhciAucHJvZ3Jlc3MtYmFyIikuY3NzKCJ3aWR0aCIsICg4OCAqIGEueHAgLyBhLnhwTmVlZGVkKS50b0ZpeGVkKDIpICsgIiUiKSkKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5HYSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYShhKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgICAgIH0oe30pOwogICAgICAgICAgICAgICAgICAgIHZhciBpYyA9IDA7CiAgICAgICAgICAgICAgICAgICAgYy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgPT0gYy5GQiA/IGFsZXJ0KCJZb3Ugc2VlbSB0byBoYXZlIHNvbWV0aGluZyBibG9ja2luZyBGYWNlYm9vayBvbiB5b3VyIGJyb3dzZXIsIHBsZWFzZSBjaGVjayBmb3IgYW55IGV4dGVuc2lvbnMiKSA6IChoLmxvZ2luSW50ZW50ID0gIjEiLCBjLnVwZGF0ZVN0b3JhZ2UoKSwgYy5GQi5sb2dpbihmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhjKGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICJwdWJsaWNfcHJvZmlsZSwgZW1haWwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjLkZCLmluaXQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwSWQ6IEVudkNvbmZpZy5mYl9hcHBfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWU6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeGZibWw6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAhMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246ICJ2Mi4yIgogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgKCIxIiA9PSBjLnN0b3JhZ2VJbmZvLmxvZ2luSW50ZW50ICYmICJmYWNlYm9vayIgPT0gYy5zdG9yYWdlSW5mby5jb250ZXh0IHx8IG5jKSAmJiBjLkZCLmdldExvZ2luU3RhdHVzKGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY29ubmVjdGVkIiA9PT0gYi5zdGF0dXMgPyBoYyhiKSA6ICJub3RfYXV0aG9yaXplZCIgPT09IGIuc3RhdHVzID8gKGMubG9nb3V0KCksIGEoKSkgOiBjLmxvZ291dCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjLmZhY2Vib29rUmVsb2dpbiA9IGE7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuZmFjZWJvb2tMb2dpbiA9IGEKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHZhciBIYiA9ICExOwogICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBiKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEudHlwZSA9ICJ0ZXh0L2phdmFzY3JpcHQiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5hc3luYyA9ICEwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5zcmMgPSAiLy9hcGlzLmdvb2dsZS5jb20vanMvY2xpZW50OnBsYXRmb3JtLmpzP29ubG9hZD1nYXBpQXN5bmNJbml0IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLCBiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSAhMAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gITE7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuZ2FwaUFzeW5jSW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoZCkudHJpZ2dlcigiaW5pdGlhbGl6ZWQiKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLmdvb2dsZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2E6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5nYXBpLmNsaWVudC5sb2FkKCJwbHVzIiwgInYxIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZmV0Y2hpbmcgbWUgcHJvZmlsZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYXBpLmNsaWVudC5wbHVzLnBlb3BsZS5nZXQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiAibWUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmV4ZWN1dGUoZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIoYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLkRhID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgfHwgYigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnYXBpID8gYSgpIDogZShkKS5iaW5kKCJpbml0aWFsaXplZCIsIGEpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgICAgICAgfSkobSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYihhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLk1DLmRvTG9naW5XaXRoR1BsdXMoYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLmNhY2hlLmxvZ2luX2luZm8gPSBbYSwgImdvb2dsZSJdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGQoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaC51c2VySW5mby5waWN0dXJlID0gYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoIi5hZ2FyaW8tcHJvZmlsZS1waWN0dXJlIikuYXR0cigic3JjIiwgYSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudF9pZDogRW52Q29uZmlnLmdwbHVzX2NsaWVudF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfcG9saWN5OiAic2luZ2xlX2hvc3Rfb3JpZ2luIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZTogInByb2ZpbGUgZW1haWwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBhLmZhID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2E6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBoICYmICIxIiA9PSBoLmxvZ2luSW50ZW50ICYmICJnb29nbGUiID09IGguY29udGV4dDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtLkRhKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5nYXBpLnl0c3Vic2NyaWJlLmdvKCJhZ2FyWW91dHViZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLmdhcGkubG9hZCgiYXV0aDIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gYy5nYXBpLmF1dGgyLmluaXQoZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmF0dGFjaENsaWNrSGFuZGxlcihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ3BsdXNMb2dpbiIpLCB7fSwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZ29vZ2xlVXNlciA6ICIgKyBhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZmFpbGVkIHRvIGxvZ2luIGluIGdvb2dsZSBwbHVzOiAiLCBKU09OLnN0cmluZ2lmeShhLCB2b2lkIDAsIDIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmN1cnJlbnRVc2VyLmxpc3RlbihfLmJpbmQoYS5DYSwgYSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiAmJiAxID09IGYuaXNTaWduZWRJbi5nZXQoKSAmJiBmLnNpZ25JbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYTogZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZiAmJiBhICYmIGYuaXNTaWduZWRJbi5nZXQoKSAmJiAhSGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGIgPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaC5sb2dpbkludGVudCA9ICIxIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBhLmdldEF1dGhSZXNwb25zZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGUuYWNjZXNzX3Rva2VuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLm9hID0gZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImxvZ2dlZEluIHdpdGggRyshIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsID0gYS5nZXRCYXNpY1Byb2ZpbGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGwuZ2V0SW1hZ2VVcmwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAwID09IGEgPyBtLmdvb2dsZS5zYShlLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5yZXN1bHQuaXNQbHVzVXNlciA/IChhICYmIGQoYS5pbWFnZS51cmwpLCBiKGcpLCBhICYmIChoLnVzZXJJbmZvLnBpY3R1cmUgPSBhLmltYWdlLnVybCksIGgudXNlckluZm8uc29jaWFsSWQgPSBsLmdldElkKCksIFlhKCkpIDogKGFsZXJ0KCJQbGVhc2UgYWRkIEdvb2dsZSsgdG8geW91ciBHb29nbGUgYWNjb3VudCBhbmQgdHJ5IGFnYWluLlxuT3IgeW91IGNhbiBsb2dpbiB3aXRoIGFub3RoZXIgYWNjb3VudC4iKSwgYy5sb2dvdXQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiAoZChhKSwgaC51c2VySW5mby5waWN0dXJlID0gYSwgaC51c2VySW5mby5zb2NpYWxJZCA9IGwuZ2V0SWQoKSwgWWEoKSwgYihnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguY29udGV4dCA9ICJnb29nbGUiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLnVwZGF0ZVN0b3JhZ2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgJiYgKGYuc2lnbk91dCgpLCBIYiA9ICExKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgICAgIH0obSk7CiAgICAgICAgICAgICAgICAgICAgYy5ncGx1c01vZHVsZSA9IGFkOwogICAgICAgICAgICAgICAgICAgIHZhciBzYyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbS5mYS53YSgpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLmxvZ291dEdvb2dsZVBsdXMgPSBzYzsKICAgICAgICAgICAgICAgICAgICB2YXIgWmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGEoYSwgYiwgYywgZCwgZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBiLmdldENvbnRleHQoIjJkIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGIud2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gYi5oZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmNvbG9yID0gZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuQShjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuc2l6ZSA9IGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYudHJhbnNsYXRlKGcgLyAyLCBiIC8gMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLncoZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLnJlc3RvcmUoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSBuZXcgY2EoLTEsIDAsIDAsIDMyLCAiIzViYzBkZSIsICIiKSwgYyA9IG5ldyBjYSgtMSwgMCwgMCwgMzIsICIjNWJjMGRlIiwgIiIpLCBmID0gIiMwNzkxZmYgIzVhMDdmZiAjZmYwN2ZlICNmZmE1MDcgI2ZmMDc3NCAjMDc3ZmZmICMzYWZmMDcgI2ZmMDdlZCAjMDdhOGZmICNmZjA3NmUgIzNmZmYwNyAjZmYwNzM0ICMwN2ZmMjAgI2ZmMDdhMiAjZmY4MjA3ICMwN2ZmMGUiLnNwbGl0KCIgIiksIGcgPSBbXSwgaCA9IDA7IGggPCBmLmxlbmd0aDsgKytoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbCA9IGggLyBmLmxlbmd0aCAqIDEyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAzMCAqIE1hdGguc3FydChoIC8gZi5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZy5wdXNoKG5ldyBjYSgtMSwgTWF0aC5jb3MobCkgKiBrLCBNYXRoLnNpbihsKSAqIGssIDEwLCBmW2hdLCAiIikpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgT2MoZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIG0uZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbS53aWR0aCA9IG0uaGVpZ2h0ID0gNzA7CiAgICAgICAgICAgICAgICAgICAgICAgIGEoYywgbSwgIiIsIDI2LCAiI2ViYzBkZSIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSgiLmNlbGwtc3Bpbm5lciIpLmZpbHRlcigiOnZpc2libGUiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGUodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmID0gdGhpcy53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IHRoaXMuaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gdGhpcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguY2xlYXJSZWN0KDAsIDAsIGYsIGcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGguc2F2ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgudHJhbnNsYXRlKGYgLyAyLCBnIC8gMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IDEwID4gazsgKytrKSBoLmRyYXdJbWFnZShtLCAoLjEgKiBkICsgODAgKiBrKSAlIChmICsgMTQwKSAtIGYgLyAyIC0gNzAgLSAzNSwgZyAvIDIgKiBNYXRoLnNpbigoLjAwMSAqIGQgKyBrKSAlIE1hdGguUEkgKiAyKSAtIDM1LCA3MCwgNzApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGgucmVzdG9yZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjID0gYy5hdHRyKCJkYXRhLWl0ciIpKSAmJiAoYyA9IFIoYykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEoYiwgdGhpcywgYyB8fCAiIiwgK2UodGhpcykuYXR0cigiZGF0YS1zaXplIiksICIjNWJjMGRlIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSgiI3N0YXRzUGVsbGV0cyIpLmZpbHRlcigiOnZpc2libGUiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy53aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q29udGV4dCgiMmQiKS5jbGVhclJlY3QoMCwgMCwgYiwgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IGcubGVuZ3RoOyBiKyspIGEoZ1tiXSwgdGhpcywgIiIsIGdbYl0uc2l6ZSwgZ1tiXS5jb2xvcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KCk7CiAgICAgICAgICAgICAgICAgICAgYy5jcmVhdGVQYXJ0eSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAga2EoIjpwYXJ0eSIpOwogICAgICAgICAgICAgICAgICAgICAgICBTID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERiKCIvIyIgKyBjLmVuY29kZVVSSUNvbXBvbmVudChhKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlKCIucGFydHlUb2tlbiIpLnZhbCgiYWdhci5pby8jIiArIGMuZW5jb2RlVVJJQ29tcG9uZW50KGEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUoIiNoZWxsb0NvbnRhaW5lciIpLmF0dHIoImRhdGEtcGFydHktc3RhdGUiLCAiMSIpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIFEoKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5qb2luUGFydHkgPSBqYzsKICAgICAgICAgICAgICAgICAgICBjLmNhbmNlbFBhcnR5ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBEYigiLyIpOwogICAgICAgICAgICAgICAgICAgICAgICBlKCIjaGVsbG9Db250YWluZXIiKS5hdHRyKCJkYXRhLXBhcnR5LXN0YXRlIiwgIjAiKTsKICAgICAgICAgICAgICAgICAgICAgICAga2EoIiIpOwogICAgICAgICAgICAgICAgICAgICAgICBRKCkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHZhciBGID0gW10sCiAgICAgICAgICAgICAgICAgICAgICAgIHViID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgdmIgPSAiIzAwMDAwMCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFhID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIEVhID0gITEsCiAgICAgICAgICAgICAgICAgICAgICAgIFJhID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgRWIgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICB4YiA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHdiID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgVyA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIFphID0gITA7CiAgICAgICAgICAgICAgICAgICAgYy5vblBsYXllckRlYXRoID0gSmE7CiAgICAgICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBFYSAmJiBGLnB1c2goYWMoKSAvIDEwMCkKICAgICAgICAgICAgICAgICAgICB9LCAxRTMgLyA2MCk7CiAgICAgICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IFJjKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIDAgIT0gYSAmJiAoKyt4YiwgMCA9PSBXICYmIChXID0gYSksIFcgPSBNYXRoLm1pbihXLCBhKSkKICAgICAgICAgICAgICAgICAgICB9LCAxRTMpOwogICAgICAgICAgICAgICAgICAgIGMuY2xvc2VTdGF0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWEgPSAhMTsKICAgICAgICAgICAgICAgICAgICAgICAgZSgiI3N0YXRzIikuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjLmRlc3Ryb3lBZChjLmFkU2xvdHMuYWIpOwogICAgICAgICAgICAgICAgICAgICAgICB5YSgwKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5zZXRTa2lwU3RhdHMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBaYSA9ICFhCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLmdldFN0YXRzU3RyaW5nID0gbGM7CiAgICAgICAgICAgICAgICAgICAgYy5nUGx1c1NoYXJlID0gVGM7CiAgICAgICAgICAgICAgICAgICAgYy50d2l0dGVyU2hhcmVTdGF0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBjLmdldFN0YXRzU3RyaW5nKCJ0dF9zaGFyZV9zdGF0cyIpOwogICAgICAgICAgICAgICAgICAgICAgICBjLm9wZW4oImh0dHBzOi8vdHdpdHRlci5jb20vaW50ZW50L3R3ZWV0P3RleHQ9IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLCAiQWdhci5pbyIsICJ3aWR0aD02NjAsaGVpZ2h0PTMxMCxtZW51YmFyPW5vLHRvb2xiYXI9bm8scmVzaXphYmxlPXllcyxzY3JvbGxiYXJzPW5vLGxlZnQ9IiArIChjLnNjcmVlblggKyBjLmlubmVyV2lkdGggLyAyIC0gMzMwKSArICIsdG9wPSIgKyAoYy5pbm5lckhlaWdodCAtIDMxMCkgLyAyKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYy5mYlNoYXJlU3RhdHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gYy5nZXRTdGF0c1N0cmluZygiZmJfbWF0Y2hyZXN1bHRzX3N1YnRpdGxlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuRkIudWkoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAiZmVlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAiaWZyYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFIoImZiX21hdGNocmVzdWx0c190aXRsZSIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbjogUigiZmJfbWF0Y2hyZXN1bHRzX2Rlc2NyaXB0aW9uIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6ICJodHRwOi8vYWdhci5pbyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBKYTogImh0dHA6Ly9zdGF0aWMyLm1pbmljbGlwY2RuLmNvbS9tb2JpbGUvYWdhci9BZ2FyLmlvX21hdGNocmVzdWx0c19mYl8xMjAweDYzMC5wbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAicGxheSBub3chIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rOiAiaHR0cDovL2FnYXIuaW8iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjLmZpbGxTb2NpYWxWYWx1ZXMgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICAgICAgICAxID09IGMuaXNDaHJvbWUgJiYgImdvb2dsZSIgPT0gYy5zdG9yYWdlSW5mby5jb250ZXh0ICYmIGMuZ2FwaS5pbnRlcmFjdGl2ZXBvc3QucmVuZGVyKGIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnR1cmw6IEVudkNvbmZpZy5nYW1lX3VybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudGlkOiBFbnZDb25maWcuZ3BsdXNfY2xpZW50X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llcG9saWN5OiAiaHR0cDovL2FnYXIuaW8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlZmlsbHRleHQ6IGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsdG9hY3Rpb25sYWJlbDogIkJFQVQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbHRvYWN0aW9udXJsOiBFbnZDb25maWcuZ2FtZV91cmwKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAiTUFzeW5jSW5pdCIgaW4gYyAmJiBjLk1Bc3luY0luaXQoKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE9SSUdJTkFMIFNDUklQVAogICAgICAgICAgICB2YXIgd2luZG8gPSBjOwogICAgICAgICAgICB2YXIgc3RvcE1vdmUgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIGF1dG9GZWVkSW50ZXJ2YWwgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHZhciBhdXRvU3BsaXRJbnRlcnZhbCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIHNlbmRCdWZmZXIgPSBWOwogICAgICAgICAgICB2YXIgc2VuZFZhbCA9IFg7CiAgICAgICAgICAgIC8vQUdBUkJPVE9WSCBtb2RpZiBJYiBwb3VyIGxhIG3DqXRob2RlIHF1aSBmYWl0IGxlcyBvbmtleXVwIG9ua2V5ZG93bgogICAgICAgICAgICBJYiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHdpbmRvLm9ua2V5dXAgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgIDMyID09IGEua2V5Q29kZSAmJiAodmEgPSAhMSk7CiAgICAgICAgICAgICAgICAgICAgODcgPT0gYS5rZXlDb2RlICYmICh4YSA9ICExKTsKICAgICAgICAgICAgICAgICAgICA4MSA9PSBhLmtleUNvZGUgJiYgd2EgJiYgKFgoMTkpLCB3YSA9ICExKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2luZG8ub25rZXlkb3duID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygna2V5RG93bicsIGEpOwogICAgICAgICAgICAgICAgICAgIGlmIChhLmtleUNvZGUgPT0gNjkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VtaXQgc3BsaXQgIScpOwogICAgICAgICAgICAgICAgICAgICAgICBzb2NrZXQuZW1pdCgnc3BsaXQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY2xpZW50X3V1aWQiOiAxMAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGEua2V5Q29kZSA9PSA4MikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZW1pdCBmZWVkICEnKTsKICAgICAgICAgICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2ZlZWQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY2xpZW50X3V1aWQiOiAxMAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgMzIgIT0gYS5rZXlDb2RlIHx8IHZhIHx8ICgibmljayIgIT0gYS50YXJnZXQuaWQgJiYgYS5wcmV2ZW50RGVmYXVsdCgpLCBlYigpLCB2YSA9ICEwKTsKICAgICAgICAgICAgICAgICAgICA4MSA9PSBhLmtleUNvZGUgJiYgKFgoMTgpLCB3YSA9ICEwKTsKICAgICAgICAgICAgICAgICAgICA4NyAhPSBhLmtleUNvZGUgfHwgeGEgfHwgKEpiKCksIHhhID0gITApOwogICAgICAgICAgICAgICAgICAgIDI3ID09IGEua2V5Q29kZSAmJiAoYS5wcmV2ZW50RGVmYXVsdCgpLCB5YSgzMDApLCBlKCIjb2ZlcndhbGxDb250YWluZXIiKS5pcygiOnZpc2libGUiKSAmJiBjLmNsb3NlT2ZmZXJ3YWxsKCksIGUoIiN2aWRlb0NvbnRhaW5lciIpLmlzKCI6dmlzaWJsZSIpICYmIGMuY2xvc2VWaWRlb0NvbnRhaW5lcigpKQogICAgICAgICAgICAgICAgICAgIGlmIChhLmtleUNvZGUgPT0gODgpIHsvLyB4CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCd4JyxidCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnNoaWZ0S2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnQgIT0gdW5kZWZpbmVkICYmIGJ0LnJlYWR5U3RhdGUgPT0gV2ViU29ja2V0Lk9QRU4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnQuc2VuZChKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogMTkgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ0ICE9IHVuZGVmaW5lZCAmJiBidC5yZWFkeVN0YXRlID09IFdlYlNvY2tldC5PUEVOKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ0LnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246IDE1IH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS5rZXlDb2RlID09IDY3KSB7Ly8gYwogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnYycpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnQgIT0gdW5kZWZpbmVkICYmIGJ0LnJlYWR5U3RhdGUgPT0gV2ViU29ja2V0Lk9QRU4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidC5zZW5kKEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOiAxNiB9KSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhLmtleUNvZGUgPT0gODYpIHsvLyB2CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdjJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidCAhPSB1bmRlZmluZWQgJiYgYnQucmVhZHlTdGF0ZSA9PSBXZWJTb2NrZXQuT1BFTikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ0LnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246IDE3IH0pKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGEua2V5Q29kZSA9PSA2Nikgey8vIGIKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2MnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ0ICE9IHVuZGVmaW5lZCAmJiBidC5yZWFkeVN0YXRlID09IFdlYlNvY2tldC5PUEVOKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnQuc2VuZChKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogMTggfSkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS5rZXlDb2RlID09IDgzICYmICJuaWNrIiAhPSBhLnRhcmdldC5pZCkgey8vIHMKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3MnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dG9GZWVkSW50ZXJ2YWwgPT0gdW5kZWZpbmVkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b0ZlZWRJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kVmFsKDIxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChhdXRvRmVlZEludGVydmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9GZWVkSW50ZXJ2YWwgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaCgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYS5rZXlDb2RlID09IDMyICYmIGEuc2hpZnRLZXkgJiYgIm5pY2siICE9IGEudGFyZ2V0LmlkKSB7Ly8gcwogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnc3BhY2UnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG51bWJlciA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRvU3BsaXRJbnRlcnZhbCA9PSB1bmRlZmluZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvU3BsaXRJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kVmFsKDE3KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVtYmVyID09IDcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChhdXRvU3BsaXRJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9TcGxpdEludGVydmFsID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXIgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChhdXRvU3BsaXRJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvU3BsaXRJbnRlcnZhbCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhLmtleUNvZGUgPT0gNjggJiYgIm5pY2siICE9IGEudGFyZ2V0LmlkKSB7Ly8gRAogICAgICAgICAgICAgICAgICAgICAgICBzdG9wTW92ZSA9ICFzdG9wTW92ZTsKICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnU1RPUE1PVkUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogY29uc29sZS5sb2coJ0x0JyxMdCk7IGNvbnNvbGUubG9nKCdFdCcsRXQpOyBjb25zb2xlLmxvZygnVHQnLFR0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICogY29uc29sZS5sb2coJ3d0Jyx3dCk7IGNvbnNvbGUubG9nKCdQdCcsUHQpOyBjb25zb2xlLmxvZygnQ3QnLEN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2goKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGEua2V5Q29kZSA9PSA2OSAmJiAibmljayIgIT0gYS50YXJnZXQuaWQpIHsvLyBFCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4dCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ0LnNlbmQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhLmtleUNvZGUgPT0gNzAgJiYgIm5pY2siICE9IGEudGFyZ2V0LmlkKSB7Ly8gRgogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhxKTsvL0FHQVJCT1RPVkggcGFzIG91YmxpZXIgbW9kaWYgcQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBidCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIGlwID0gdW5kZWZpbmVkOwogICAgICAgICAgICB2YXIgcm9vbSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIHNvY2tldCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIG9wZW5Tb2NrZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBidCAmJiBidC5jbG9zZSgpOwogICAgICAgICAgICAgICAgLy9idCA9IG5ldyBXZWJTb2NrZXQoIndzOi8vbG9jYWxob3N0OjE4NDEiKTsKICAgICAgICAgICAgICAgIC8vYnQgPSBuZXcgV2ViU29ja2V0KCJ3czovL3NlcnZlci5hZ2FyYm90Lm92aDo5MCIpOwogICAgICAgICAgICAgICAgYnQgPSBuZXcgV2ViU29ja2V0KCJ3czovLzE3OC4yNTQuMjIuNzI6ODA4MSIpOwogICAgICAgICAgICAgICAgc29ja2V0ID0gaW8uY29ubmVjdCgnd3M6Ly8xNzguMjU0LjIyLjcyOjgwODEnKTsKICAgICAgICAgICAgICAgIHNvY2tldC5vbigndGVzdCcsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25pY2UsIHdvcmtpbmcnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBidC5iaW5hcnlUeXBlID0gImFycmF5YnVmZmVyIjsKICAgICAgICAgICAgICAgIGJ0Lm9ub3BlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB4dCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgY2hhbmdlR2FtZU1vZGUoKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBidC5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdELUJvdHMuY29tIDogVEhFIFNFTlRFTkNFIEJFRk9SRSBJUyBUSEUgUkVBU09OIFdIWSBZT1UgSEFWRSBUUk9VQkxFUyBDT05ORUNUSU5HJywgZSwgJ2Nvbm5lY3Rpb24gZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICBzZXRJbmZvcygnRC1Cb3RzLmNvbSA6IENvbm5leGlvbiBlcnJvciwgY2hlY2sgRjEyID4gY29uc29sZSB0byBoYXZlIG1vcmUgaW5mb3MnKTsKICAgICAgICAgICAgICAgICAgICBzZXRUeHQoZ2V0SW5mb3MoKSk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYnQub25tZXNzYWdlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodC5kYXRhLnN0YXJ0c1dpdGgoJ3BpbmcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHQuZGF0YS5zcGxpdCgnfCcpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucGluZyA9IGRhdGFbMV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGluZycpICE9IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwaW5nJykuaW5uZXJIVE1MID0gd2luZG93LnBpbmc7CgogICAgICAgICAgICAgICAgICAgICAgICBidC5zZW5kKCdwb25nJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdCA9IEpTT04ucGFyc2UodC5kYXRhKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cubGFzdE1lc3NhZ2UgPSB0OwogICAgICAgICAgICAgICAgICAgIHJlZnJlc2goKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBidC5vbmNsb3NlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdXRUJTT0NLRVQgVE8gQk9UIFNFUlZFUiBDTE9TRUQnLCAnY29kZSA6ICcsIGUuY29kZSwgJ3JlYXNvbicsIGUucmVhc29uKTsKICAgICAgICAgICAgICAgICAgICAvKnZhciBpbmZvcyA9IGdldEluZm9zKCk7CiAgICAgICAgICAgICAgICAgICAgaWYoaW5mb3MuY2xvc2VNZXNzID09IHVuZGVmaW5lZCB8fCBpbmZvcy5jbG9zZU1lc3MgPT0gdHJ1ZSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldEluZm9zKCdDb25uZWN0aW9uIGNsb3NlZCcsdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFR4dChnZXRJbmZvcygpKTsKICAgICAgICAgICAgICAgICAgICB9Ki8KICAgICAgICAgICAgICAgICAgICB4dCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIHNlbmRUb2tlbiA9IGZ1bmN0aW9uICh1aW50YXJyYXkpIHsKICAgICAgICAgICAgICAgIGlmICh4dCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3NlbmRUb2tlbicsIHVpbnRhcnJheSwgdWludGFycmF5Lmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgYSA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoMSArIHVpbnRhcnJheS5sZW5ndGgpKTsKICAgICAgICAgICAgICAgICAgICBhLnNldFVpbnQ4KDAsIDEwMik7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCB1aW50YXJyYXkubGVuZ3RoOyArK2MpIGEuc2V0VWludDgoMSArIGMsIHVpbnRhcnJheVtjXSk7CiAgICAgICAgICAgICAgICAgICAgYnQuc2VuZChhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGNoYW5nZUdhbWVNb2RlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKHh0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSB7fTsKICAgICAgICAgICAgICAgICAgICBlLmFjdGlvbiA9IDE7CiAgICAgICAgICAgICAgICAgICAgLy9BR0FSQk9UT1ZIIG5lIHBhcyBvdWJsaWVyIGNoYW5nZXIgw6dhCiAgICAgICAgICAgICAgICAgICAgZS50YXJnZXRSZWdpb24gPSBHICsgbGE7CiAgICAgICAgICAgICAgICAgICAgZS50YXJnZXRJcCA9IGlwOwogICAgICAgICAgICAgICAgICAgIGUudGFyZ2V0Um9vbSA9IHJvb207CgogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZW5kaW5nJywgZSk7CiAgICAgICAgICAgICAgICAgICAgYnQuc2VuZChKU09OLnN0cmluZ2lmeShlKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZWZyZXNoKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHh0ID0gZmFsc2U7CiAgICAgICAgICAgIG9wZW5Tb2NrZXQoKTsKICAgICAgICAgICAgdmFyIHNldFR4dCA9IGZ1bmN0aW9uIChpbmZvcykgewogICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtaW5pb25zIikgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygndGltZW91dCcsaW5mb3MpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRUeHQoaW5mb3MpOwogICAgICAgICAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtaW5pb25zIikuaW5uZXJIVE1MID0gaW5mb3MudHh0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgc2V0SW5mb3MgPSBmdW5jdGlvbiAodHh0LCBjbG9zZU1lc3MpIHsKICAgICAgICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0eHQiKTsKICAgICAgICAgICAgICAgIGlmIChlbCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgICAgICBlbC5pZCA9ICd0eHQnOwogICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlLmNzc1RleHQgPSAiZGlzcGxheTpub25lOyI7CiAgICAgICAgICAgICAgICAgICAgZWwuaW5uZXJUZXh0ID0gSlNPTi5zdHJpbmdpZnkoeyB0eHQ6ICcnLCBjbG9zZU1lc3M6IHRydWUgfSk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgb2JqID0gSlNPTi5wYXJzZShlbC5pbm5lclRleHQpOwogICAgICAgICAgICAgICAgaWYgKHR4dCAhPSB1bmRlZmluZWQpCiAgICAgICAgICAgICAgICAgICAgb2JqLnR4dCA9IHR4dDsKICAgICAgICAgICAgICAgIGlmIChjbG9zZU1lc3MgIT0gdW5kZWZpbmVkKQogICAgICAgICAgICAgICAgICAgIG9iai5jbG9zZU1lc3MgPSBjbG9zZU1lc3M7CiAgICAgICAgICAgICAgICBlbC5pbm5lclRleHQgPSBKU09OLnN0cmluZ2lmeShvYmopOwogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgZ2V0SW5mb3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidHh0Iik7CiAgICAgICAgICAgICAgICBpZiAoZWwgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICAgICAgZWwuaWQgPSAndHh0JzsKICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5jc3NUZXh0ID0gImRpc3BsYXk6bm9uZTsiOwogICAgICAgICAgICAgICAgICAgIGVsLmlubmVyVGV4dCA9IEpTT04uc3RyaW5naWZ5KHsgdHh0OiAnJywgY2xvc2VNZXNzOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZWwuaW5uZXJUZXh0KTsKICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGVsLmlubmVyVGV4dCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciByZWZyZXNoID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSB3aW5kb3cubGFzdE1lc3NhZ2U7CiAgICAgICAgICAgICAgICBpZiAodCA9PSB1bmRlZmluZWQpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKHJvb20gIT0gdW5kZWZpbmVkICYmIHJvb20ubGVuZ3RoID4gMTApIHsKICAgICAgICAgICAgICAgICAgICBzZXRJbmZvcygnQk9UUyBPTkxZIFdPUksgSU4gUEFSVFkgTU9ERScpOwogICAgICAgICAgICAgICAgICAgIHNldFR4dChnZXRJbmZvcygpKTsKICAgICAgICAgICAgICAgICAgICBzaG93UmVtYWluaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHQubm9wZSkgewogICAgICAgICAgICAgICAgICAgIHNldEluZm9zKCc8YSBocmVmPSJodHRwOi8vYWdhcmJvdC5vdmgiIHRhcmdldD0iX2JsYW5jIj5ObyBwbGFuIGFjdGl2ZSAmZ3Q7IGFnYXJib3Qub3ZoIChkaWQgeW91IHJlZnJlc2ggSVAgPyk8L2E+JywgZmFsc2UpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0LmFscmVhZHlDb25uZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgICBzZXRJbmZvcygnQWxyZWFkeSBvbiBhbm90aGVyIGdhbWUgKHJlZnJlc2ggcGFnZSknLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHQuc3BlY2lhbCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnc2V0dGluZyBzcGVjaWFsJyk7CiAgICAgICAgICAgICAgICAgICAgc2V0SW5mb3ModC5zcGVjaWFsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5leHBpcmUgPSB0LmV4cGlyZTsKICAgICAgICAgICAgICAgICAgICB2YXIgZXhwaXJlID0gbmV3IERhdGUodC5leHBpcmUpOwogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdleHBpcmUgJyx0LmV4cGlyZSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGJvdHNBdmFpbGFibGUgPSB0LmJvdHNBdmFpbGFibGU7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFib3RzQXZhaWxhYmxlKQogICAgICAgICAgICAgICAgICAgICAgICBzZXRJbmZvcygnTm8gYm90cyBhdmFpbGFibGUuLi4gcmV0cnlpbmcnKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVkIEZGMzMzMwogICAgICAgICAgICAgICAgICAgICAgICAvLyBncmVlbiAzM0ZGMzMKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR4dCA9ICdCb3RzICc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LmpvaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuY3VycmVudEJvdHMgPT0gdC5tYXhCb3RzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSAnPHNwYW4gc3R5bGU9ImNvbG9yOiMzM0ZGMzMiPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9ICc8c3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9IHQuY3VycmVudEJvdHMgKyAiIC8gIiArIHQubWF4Qm90cyArICc8L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eHQgKz0gJ3dhaXRpbmcgZm9yIHlvdSB0byBjbGljayBwbGF5JzsKCiAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSAnIC0gVGltZSBsZWZ0IDxzcGFuIGlkPSJjb3VudGRvd24iPjwvc3Bhbj4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9ICcgLSAnOwogICAgICAgICAgICAgICAgICAgICAgICB0eHQgKz0gJyBQaW5nIDogPHNwYW4gaWQ9InBpbmciPicgKyAod2luZG93LnBpbmcgfHwgJz8nKSArICc8L3NwYW4+IDxici8+JzsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRvRmVlZEludGVydmFsID09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSAnPHNwYW4gc3R5bGU9ImNvbG9yOiNGRjMzMzMiPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSAnPHNwYW4gc3R5bGU9ImNvbG9yOiMzM0ZGMzMiPic7CiAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSAnQVVUTy1GRUVEIChTKTwvc3Bhbj4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9ICcgLSAnOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0b3BNb3ZlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9ICc8c3BhbiBzdHlsZT0iY29sb3I6IzMzRkYzMyI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9ICc8c3BhbiBzdHlsZT0iY29sb3I6I0ZGMzMzMyI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9ICdTVE9QLU1PVkUgKEQpPC9zcGFuPic7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5hbGdvID09IDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eHQgKz0gJyBNT0RFIChFKSA9IDxzcGFuIHN0eWxlPSJjb2xvcjojMkU5QkJGIj5FQVQgUEVMTEVUUzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0LmFsZ28gPT0gMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSAnIE1PREUgKEUpID0gPHNwYW4gc3R5bGU9ImNvbG9yOiNFODY2RTgiPlJVTjwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0LmFsZ28gPT0gMykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSAnIE1PREUgKEUpID0gPHNwYW4gc3R5bGU9ImNvbG9yOiM0M0RFMkYiPkNPTUUgVE8gTUVIPC9zcGFuPic7CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGVyY2VudCA9ICh0LmVhdHMgLyB0LnNwYXducyAqIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihwZXJjZW50KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnQgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9ICc8YnIgLz5FZmZpY2llbmN5IDogPHNwYW4gdGl0bGU9ImVhdGVuL3NwYXduZWQ9ZWZmaWNpZW5jeSUiPicgKyB0LmVhdHMgKyAnLycgKyB0LnNwYXducyArICcgID0gJyArIHBlcmNlbnQudG9GaXhlZCgyKSArICclPC9zcGFuPic7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5wYXJ0eUZ1bGwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eHQgKz0gJzxiciAvPlBhcnR5IHByb2JhYmx5IGZ1bGwnOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0LmpvaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHh0ICs9ICc8YnIgLz5Kb2luIHRoZSBnYW1lIGFuZCB0aGUgYm90cyB3aWxsIGNvbm5lY3QgKCc7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvb20gPT0gdW5kZWZpbmVkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSAnPz8/JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eHQgKz0gKHJvb20ubGVuZ3RoIDwgMTAgPyAnUEFSVFknIDogJ0ZGQSBOT1QgV09SS0lORycpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSAnKSc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCgogICAgICAgICAgICAgICAgICAgICAgICBzZXRJbmZvcygnPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTogeC1zbWFsbDsiPicgKyB0eHQgKyAnPC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNldFR4dChnZXRJbmZvcygpKTsKICAgICAgICAgICAgICAgIHNob3dSZW1haW5pbmcoKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIF9zZWNvbmQgPSAxMDAwOwogICAgICAgICAgICB2YXIgX21pbnV0ZSA9IF9zZWNvbmQgKiA2MDsKICAgICAgICAgICAgdmFyIF9ob3VyID0gX21pbnV0ZSAqIDYwOwogICAgICAgICAgICB2YXIgX2RheSA9IF9ob3VyICogMjQ7CiAgICAgICAgICAgIGZ1bmN0aW9uIHNob3dSZW1haW5pbmcoKSB7CiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvdW50ZG93bicpID09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmV4cGlyZSA9PSB1bmRlZmluZWQgfHwgd2luZG93LmV4cGlyZSA9PSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gbmV3IERhdGUod2luZG93LmV4cGlyZSkgLSBub3c7CiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy9jbGVhckludGVydmFsKHRpbWVyKTsKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdTRU5EIFRISVMgVE8gTkVFTCcsbmV3IERhdGUoKSxub3csbmV3IERhdGUod2luZG93LmV4cGlyZSksZGlzdGFuY2UpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb3VudGRvd24nKS5pbm5lckhUTUwgPSAnRVhQSVJFRCEnOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBkYXlzID0gTWF0aC5mbG9vcihkaXN0YW5jZSAvIF9kYXkpOwogICAgICAgICAgICAgICAgdmFyIGhvdXJzID0gTWF0aC5mbG9vcigoZGlzdGFuY2UgJSBfZGF5KSAvIF9ob3VyKTsKICAgICAgICAgICAgICAgIHZhciBtaW51dGVzID0gTWF0aC5mbG9vcigoZGlzdGFuY2UgJSBfaG91cikgLyBfbWludXRlKTsKICAgICAgICAgICAgICAgIHZhciBzZWNvbmRzID0gTWF0aC5mbG9vcigoZGlzdGFuY2UgJSBfbWludXRlKSAvIF9zZWNvbmQpOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb3VudGRvd24nKS5pbm5lckhUTUwgPSBkYXlzICsgJ2RheXMgJzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb3VudGRvd24nKS5pbm5lckhUTUwgKz0gaG91cnMgKyAnaHJzICc7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY291bnRkb3duJykuaW5uZXJIVE1MICs9IG1pbnV0ZXMgKyAnbWlucyAnOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvdW50ZG93bicpLmlubmVySFRNTCArPSBzZWNvbmRzICsgJ3NlY3MnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB0aW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsvLyBBR0FSQk9UT1ZICiAgICAgICAgICAgICAgICBzaG93UmVtYWluaW5nKCk7CiAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICBmdW5jdGlvbiBnb3ROZXdCYWxsKGlkKSB7CiAgICAgICAgICAgICAgICB2YXIgYmFsbCA9IG51bGw7CiAgICAgICAgICAgICAgICBmb3IgKGluZGV4IGluIHEpIHsvL0FHQVJCT1RPVkggcGFzIG91YmxpZXIgbW9kaWYgcQogICAgICAgICAgICAgICAgICAgIHZhciBiID0gcVtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGIuaWQgPT0gaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYmFsbCA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoeHQpCiAgICAgICAgICAgICAgICAgICAgYnQuc2VuZChKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICdpZCc6IGlkLAogICAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTkVXQkFMTCcsIGlkLCBiYWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiByZW1vdmVNeUJhbGwoaWQpIHsKICAgICAgICAgICAgICAgIGlmICh4dCkKICAgICAgICAgICAgICAgICAgICBidC5zZW5kKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAxMiwKICAgICAgICAgICAgICAgICAgICAgICAgJ2lkJzogaWQsCiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1JFTU9WRSBCQUxMJywgaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGhleFRvUmdiKGhleCkgewogICAgICAgICAgICAgICAgLy8gRXhwYW5kIHNob3J0aGFuZCBmb3JtIChlLmcuICIwM0YiKSB0byBmdWxsIGZvcm0gKGUuZy4gIjAwMzNGRiIpCiAgICAgICAgICAgICAgICB2YXIgc2hvcnRoYW5kUmVnZXggPSAvXiM/KFthLWZcZF0pKFthLWZcZF0pKFthLWZcZF0pJC9pOwogICAgICAgICAgICAgICAgaGV4ID0gaGV4LnJlcGxhY2Uoc2hvcnRoYW5kUmVnZXgsIGZ1bmN0aW9uIChtLCByLCBnLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIgKyByICsgZyArIGcgKyBiICsgYjsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSAvXiM/KFthLWZcZF17Mn0pKFthLWZcZF17Mn0pKFthLWZcZF17Mn0pJC9pLmV4ZWMoaGV4KTsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQgPyB7CiAgICAgICAgICAgICAgICAgICAgcjogcGFyc2VJbnQocmVzdWx0WzFdLCAxNiksCiAgICAgICAgICAgICAgICAgICAgZzogcGFyc2VJbnQocmVzdWx0WzJdLCAxNiksCiAgICAgICAgICAgICAgICAgICAgYjogcGFyc2VJbnQocmVzdWx0WzNdLCAxNikKICAgICAgICAgICAgICAgIH0gOiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1hcENvb3JkcyhtaW54LCBtaW55LCBtYXh4LCBtYXh5KSB7CiAgICAgICAgICAgICAgICB2YXIgYWIgPSBuZXcgQXJyYXlCdWZmZXIoMTcpOwogICAgICAgICAgICAgICAgdmFyIGR2ID0gbmV3IERhdGFWaWV3KGFiKTsKICAgICAgICAgICAgICAgIGR2LnNldEludDgoMCwgMyk7CiAgICAgICAgICAgICAgICBkdi5zZXRGbG9hdDMyKDEsIG1pbngpOwogICAgICAgICAgICAgICAgZHYuc2V0RmxvYXQzMig1LCBtaW55KTsKICAgICAgICAgICAgICAgIGR2LnNldEZsb2F0MzIoOSwgbWF4eCk7CiAgICAgICAgICAgICAgICBkdi5zZXRGbG9hdDMyKDEzLCBtYXh5KTsKICAgICAgICAgICAgICAgIGlmICh4dCkKICAgICAgICAgICAgICAgICAgICBidC5zZW5kKGFiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgb2Zmc2V0WCA9IDA7CiAgICAgICAgICAgIHZhciBvZmZzZXRZID0gMDsKICAgICAgICAgICAgZnVuY3Rpb24gbWFwQ29vcmRzKG1pbl94LCBtaW5feSwgbWF4X3gsIG1heF95KSB7CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdtYXAnLG1heF94LW1pbl94KTsKICAgICAgICAgICAgICAgIGlmIChtYXhfeCAtIG1pbl94ID4gMTQwMDApIHsKICAgICAgICAgICAgICAgICAgICBvZmZzZXRYID0gbWluX3g7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0WSA9IG1pbl95OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGhleShidWYsIHgsIHkpIHsKICAgICAgICAgICAgICAgIGlmIChzdG9wTW92ZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBtaWRYID0gMDsKICAgICAgICAgICAgICAgICAgICB2YXIgbWlkWSA9IDA7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1pblggPSAwOwogICAgICAgICAgICAgICAgICAgIHZhciBtaW5ZID0gMDsKICAgICAgICAgICAgICAgICAgICB2YXIgbWF4WCA9IDA7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1heFkgPSAwOwogICAgICAgICAgICAgICAgICAgIGZvciAoaW5kZXggaW4gcSkgey8vQUdBUkJPVE9WSCBwYXMgb3VibGllciBtb2RpZiBxCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiYWxsID0gcVtpbmRleF07Ly9BR0FSQk9UT1ZIIHBhcyBvdWJsaWVyIG1vZGlmIHEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heFggPSBiYWxsLng7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5YID0gYmFsbC54OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4WSA9IGJhbGwueTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pblkgPSBiYWxsLnk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgYmFsbC54KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pblggPSBNYXRoLm1pbihtaW5YLCBiYWxsLngpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4WSA9IE1hdGgubWF4KG1heFksIGJhbGwueSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5ZID0gTWF0aC5taW4obWluWSwgYmFsbC55KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBtaWRYID0gKG1pblggKyBtYXhYKSAvIDI7CiAgICAgICAgICAgICAgICAgICAgbWlkWSA9IChtaW5ZICsgbWF4WSkgLyAyOwogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdyZXBsYWNlJyx4LHksICdwYXIgJyxtaWRYLG1pZFkpOwoKICAgICAgICAgICAgICAgICAgICBidWYuc2V0SW50MzIoMSwgbWlkWCwgITApOwogICAgICAgICAgICAgICAgICAgIGJ1Zi5zZXRJbnQzMig1LCBtaWRZLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgYnVmLnNldFVpbnQzMig5LCAwLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgc2VuZEJ1ZmZlcihidWYpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYnVmLnNldEludDMyKDEsIHgsICEwKTsKICAgICAgICAgICAgICAgICAgICBidWYuc2V0SW50MzIoNSwgeSwgITApOwogICAgICAgICAgICAgICAgICAgIGJ1Zi5zZXRVaW50MzIoOSwgMCwgITApOwogICAgICAgICAgICAgICAgICAgIHNlbmRCdWZmZXIoYnVmKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vQUdBUkJPVE9WSCBjaGFuZ2VyIGF1c3NpIMOnYSBzaSBtZXAgZGUgc2NyaXB0CiAgICAgICAgICAgICAgICAvL3ggLyB2YSA9IChYIC0gdCAvIDIpIC8gbCArIHk7CiAgICAgICAgICAgICAgICAvL3kgLyB3YSA9IChZIC0gdSAvIDIpIC8gbCArIHoKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ0NBTENVTCBYID0gJyxYLHQsbCx5LCd0ZXN0JywoWCAtIHQgLyAyKSAvIGwpOwogICAgICAgICAgICAgICAgdmFyIGFiID0gbmV3IEFycmF5QnVmZmVyKDEgKyA0ICsgNCArIDQgKyA0ICsgcS5sZW5ndGggKiA0ICogNCArIDMpOwogICAgICAgICAgICAgICAgdmFyIGR2ID0gbmV3IERhdGFWaWV3KGFiKTsKICAgICAgICAgICAgICAgIHZhciBvZmZzZXQgPSAwOwogICAgICAgICAgICAgICAgZHYuc2V0SW50OChvZmZzZXQsIDIpOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDE7CiAgICAgICAgICAgICAgICBkdi5zZXRGbG9hdDMyKG9mZnNldCwgeCAtIG9mZnNldFgpOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgICAgICAgICAgICBkdi5zZXRGbG9hdDMyKG9mZnNldCwgeSAtIG9mZnNldFkpOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDQ7CgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzb2NrZXQuZW1pdCgncG9zJywgewogICAgICAgICAgICAgICAgICAgICd5JzogeSAtIG9mZnNldFksCiAgICAgICAgICAgICAgICAgICAgJ3gnOiB4IC0gb2Zmc2V0WCwKICAgICAgICAgICAgICAgICAgICAnY2xpZW50X3V1aWQnOiAxMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChmaXJzdCkgewogICAgICAgICAgICAgICAgICAgIGZpcnN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnZW1pdHRlZCBwb3M6IHggLSAnICsgeCArICcgLCB5IC0gJyArIHkpOwogICAgICAgICAgICAgICAgLyogTWEgPSBhLmdldEZsb2F0NjQoZCwgITApOwogICAgICAgICAgICAgICAgICAgIGQgKz0gODsKICAgICAgICAgICAgICAgICAgICBOYSA9IGEuZ2V0RmxvYXQ2NChkLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgZCArPSA4OwogICAgICAgICAgICAgICAgICAgIE9hID0gYS5nZXRGbG9hdDY0KGQsICEwKTsKICAgICAgICAgICAgICAgICAgICBkICs9IDg7CiAgICAgICAgICAgICAgICAgICAgUGEgPSBhLmdldEZsb2F0NjQoZCwgITApOwogICAgICAgICAgICAgICAgICAgIGQgKz0gODsKICAgICAgICAgICAgICAgICAgICBwYSA9IChPYSArIE1hKSAvIDI7CiAgICAgICAgICAgICAgICAgICAgcWEgPSAoUGEgKyBOYSkgLyAyOyovCiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdDRU5URVI/JyxwYSxxYSk7CiAgICAgICAgICAgICAgICBkdi5zZXRGbG9hdDMyKG9mZnNldCwgcGEpOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgICAgICAgICAgICBkdi5zZXRGbG9hdDMyKG9mZnNldCwgcWEpOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDQ7CgogICAgICAgICAgICAgICAgdmFyIGJhbGwgPSBxWzBdOwogICAgICAgICAgICAgICAgaWYgKGJhbGwgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHZhciByZ2IgPSBoZXhUb1JnYihiYWxsLmNvbG9yLnN1YnN0cigxKSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRlY0NvbG9yID0gKHJnYi5yIDw8IDE2KSArIChyZ2IuZyA8PCA4KSArIHJnYi5iOwogICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ3JnYicscmdiLGRlY0NvbG9yLCdiYWxsaWQnLGJhbGwuaWQpOwogICAgICAgICAgICAgICAgICAgIGR2LnNldFVpbnQ4KG9mZnNldCwgcmdiLnIpOwogICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSAxOwogICAgICAgICAgICAgICAgICAgIGR2LnNldFVpbnQ4KG9mZnNldCwgcmdiLmcpOwogICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSAxOwogICAgICAgICAgICAgICAgICAgIGR2LnNldFVpbnQ4KG9mZnNldCwgcmdiLmIpOwogICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSAxOwogICAgICAgICAgICAgICAgICAgIGZvciAoaW5kZXggaW4gcSkgey8vQUdBUkJPVE9WSCBwYXMgb3VibGllciBtb2RpZiBxCiAgICAgICAgICAgICAgICAgICAgICAgIGJhbGwgPSBxW2luZGV4XTsvL0FHQVJCT1RPVkggcGFzIG91YmxpZXIgbW9kaWYgcQogICAgICAgICAgICAgICAgICAgICAgICBkdi5zZXRVaW50MzIob2Zmc2V0LCBiYWxsLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGR2LnNldEZsb2F0MzIob2Zmc2V0LCBiYWxsLngpOwogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgKz0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgZHYuc2V0RmxvYXQzMihvZmZzZXQsIGJhbGwueSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSA0OwogICAgICAgICAgICAgICAgICAgICAgICBkdi5zZXRJbnQzMihvZmZzZXQsIGJhbGwuc2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSA0OwogICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdjb2xvcicsYmFsbC5jb2xvcik7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoeHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGJ0LnNlbmQoYWIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ21vdXNlIGluICcseCx5LCd0ZXN0Jyx4LXdpbmRvdy5tYXAubWluWCx5LXdpbmRvdy5tYXAubWluWSwnbWFwJyx3aW5kb3cubWFwKTsKCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBiYXNlU2V0TmljayA9IHdpbmRvLnNldE5pY2s7CiAgICAgICAgICAgIGludGVydmFsX2lkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAod3MgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICByZXR1cm47ICAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChsYXN0X3dzICE9PSB3cykgewogICAgICAgICAgICAgICAgICAgIGxhc3Rfd3MgPSB3czsKICAgICAgICAgICAgICAgICAgICBzb2NrZXQuZW1pdCgicGFydHkiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJpcCI6IHdzICwKICAgICAgICAgICAgICAgICAgICAgICAgImNsaWVudF91dWlkIjogMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICJwYXNzd29yZCI6ICJrb3RqYSIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgIHdpbmRvLnNldE5pY2sgPSBmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgYmFzZVNldE5pY2sobik7CiAgICAgICAgICAgICAgICBpZiAoeHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHt9OwogICAgICAgICAgICAgICAgICAgIGUuYWN0aW9uID0gMzsKICAgICAgICAgICAgICAgICAgICBlLnBsYXllck5hbWUgPSBuOwogICAgICAgICAgICAgICAgICAgIGJ0LnNlbmQoSlNPTi5zdHJpbmdpZnkoZSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEVORCBDVVNUT00KICAgICAgICB9CgoKICAgIH0pKHdpbmRvdywgd2luZG93LmpRdWVyeSk7Cg==';

var removed = false;

var d = function(a) {
	if (a.src.indexOf('main_out.js') >= 0) {
		window.ok = true;
		a.parentNode.removeChild(a);
		removed = true;
		console.log('AGARBOT - removed their script');
		var b = document.createElement('script');
		b.innerHTML = window.atob(engine);
		document.head.appendChild(b)
		console.log('AGARBOTDEBUG - added ours');
	}
};
var observer = new window.WebKitMutationObserver(function(b) {
	b.forEach(function(a) {
		for (var i = 0; i < a.addedNodes.length; ++i) {
			try {
				d(a.addedNodes[i]);
			} catch (e) {
			}
		}
	});
});
observer.observe(window.document, {
	subtree : true,
	childList : true,
	attribute : false
});
window.onload = function() {
	$("span[data-itr=option_show_mass]").prev()[0].checked = true;
	// setShowMass(true);
	var a = document.getElementById('gamemode').getElementsByTagName('option');
	if (a.length > 0) {
		for (var i = 0; i < a.length; i++) {
			if (a[i].getAttribute('data-itr') != 'party') {
				a[i].innerHTML += ' (Bots not working)';
			}
		}
	}
	if (!document.contains(document.getElementById('minions'))) {
		var b = document.createElement('div');
		b.id = 'minions';
		b.style.cssText = "position: absolute;top: 10px;left: 10px;padding: 0 8px;font-family: 'Ubuntu';color: green;background-color: rgba(55, 143, 206, 0.3);border-radius: 15px;z-index:9999";
		if (window.infos == undefined)
			window.infos = 'D-Bots.com : connecting... (try to refresh your page)';
		b.innerHTML = window.infos;
		document.body.appendChild(b);
		/*
		 * setTimeout(function(){ b.innerHTML = ''; },15000);
		 */
	}
	$("span[data-itr=instructions_w]")
			.append(
					'<br /><span style="font-size=xx-large;color:red;font-weight:bold">BOT INFO:</span><br />No plan active ? Check that you have correctly updated your IP ?<br />Press <b>C</b> to eject mass from your bot<br />Press <b>X</b> to split your bot (<b>Shift+X</b> fastSplit bots)<br />Press <b>S</b> to auto feed<br />Press <b>D</b> to stop moving<br />Press <b>Shift+space</b> to fast split<br />Features : Infinite zoom<br />')
			.append(
					'<span style="color:red">FFA WITH BOTS IS NOT WORKING</span><br />You need to enter the game for the bots to connect,if the bot isn\'t working try to refresh the page<br /><br /><a href="http://agarbot.ovh">AgarBot.ovh</a> Disclaimer : <br />Remember that we have no link of any sort with agar.io and the bots can suddenly stop working if agar.io update its game. We will try our best to have our bot solution working and we won\'t refund you if its not. If you encounter any problem come to our <a href="http://chat.agarbot.ovh" target="_blank">chat.agarbot.ovh</a>');
	$('#openfl-overlay').remove()
};
